
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.5.4">
    
    
      
        <title>Variable Time Curves - pyastrobee</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.80dcb947.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#546d78">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue-grey" data-md-color-accent="pink">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#module-pyastrobeetrajectoriesvariable_time_curves" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="pyastrobee" class="md-header__button md-logo" aria-label="pyastrobee" data-md-component="logo">
      
  <img src="../../../../images/favicon_large.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            pyastrobee
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Variable Time Curves
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/danielpmorton/pyastrobee" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    pyastrobee
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="pyastrobee" class="md-nav__button md-logo" aria-label="pyastrobee" data-md-component="logo">
      
  <img src="../../../../images/favicon_large.png" alt="logo">

    </a>
    pyastrobee
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/danielpmorton/pyastrobee" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    pyastrobee
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/additional_installs/" class="md-nav__link">
        Additional Installs
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/bag_dynamics/" class="md-nav__link">
        Bag Dynamics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/getting_started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/loading_iss_meshes/" class="md-nav__link">
        Loading Iss Meshes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/meshing/" class="md-nav__link">
        Meshing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/nasa_sim/" class="md-nav__link">
        Nasa Sim
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/pybullet_tips/" class="md-nav__link">
        Pybullet Tips
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/references/" class="md-nav__link">
        References
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/retexturing/" class="md-nav__link">
        Retexturing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/testing/" class="md-nav__link">
        Testing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/tet_meshing/" class="md-nav__link">
        Tet Meshing
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13" type="checkbox" id="__nav_13" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_13">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_13">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13_1" type="checkbox" id="__nav_13_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_13_1">
          Pyastrobee
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Pyastrobee" data-md-level="2">
        <label class="md-nav__title" for="__nav_13_1">
          <span class="md-nav__icon md-icon"></span>
          Pyastrobee
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13_1_2" type="checkbox" id="__nav_13_1_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_13_1_2">
          Config
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Config" data-md-level="3">
        <label class="md-nav__title" for="__nav_13_1_2">
          <span class="md-nav__icon md-icon"></span>
          Config
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../config/astrobee_geom/" class="md-nav__link">
        Astrobee Geom
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../config/astrobee_motion/" class="md-nav__link">
        Astrobee Motion
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../config/astrobee_transforms/" class="md-nav__link">
        Astrobee Transforms
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../config/bag_properties/" class="md-nav__link">
        Bag Properties
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../config/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../config/iss_paths/" class="md-nav__link">
        Iss Paths
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../config/iss_safe_boxes/" class="md-nav__link">
        Iss Safe Boxes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13_1_3" type="checkbox" id="__nav_13_1_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_13_1_3">
          Control
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Control" data-md-level="3">
        <label class="md-nav__title" for="__nav_13_1_3">
          <span class="md-nav__icon md-icon"></span>
          Control
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../control/constraint_controller/" class="md-nav__link">
        Constraint Controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../control/force_torque_control/" class="md-nav__link">
        Force Torque Control
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../control/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../control/keyboard_controller/" class="md-nav__link">
        Keyboard Controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../control/metrics/" class="md-nav__link">
        Metrics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../control/multi_robot/" class="md-nav__link">
        Multi Robot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../control/sampling_mpc/" class="md-nav__link">
        Sampling Mpc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../control/sampling_mpc_multithreaded/" class="md-nav__link">
        Sampling Mpc Multithreaded
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13_1_4" type="checkbox" id="__nav_13_1_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_13_1_4">
          Core
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Core" data-md-level="3">
        <label class="md-nav__title" for="__nav_13_1_4">
          <span class="md-nav__icon md-icon"></span>
          Core
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/abstract_bag/" class="md-nav__link">
        Abstract Bag
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/astrobee/" class="md-nav__link">
        Astrobee
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/composite_bag/" class="md-nav__link">
        Composite Bag
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/constraint_bag/" class="md-nav__link">
        Constraint Bag
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/deformable_bag/" class="md-nav__link">
        Deformable Bag
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/environments/" class="md-nav__link">
        Environments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/hybrid_bag/" class="md-nav__link">
        Hybrid Bag
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/iss/" class="md-nav__link">
        Iss
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/rigid_bag/" class="md-nav__link">
        Rigid Bag
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13_1_5" type="checkbox" id="__nav_13_1_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_13_1_5">
          Trajectories
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Trajectories" data-md-level="3">
        <label class="md-nav__title" for="__nav_13_1_5">
          <span class="md-nav__icon md-icon"></span>
          Trajectories
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../arm_planner/" class="md-nav__link">
        Arm Planner
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../bezier/" class="md-nav__link">
        Bezier
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../bezier_slerp/" class="md-nav__link">
        Bezier Slerp
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../box_paths/" class="md-nav__link">
        Box Paths
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../curve_utils/" class="md-nav__link">
        Curve Utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../decasteljau_slerp/" class="md-nav__link">
        Decasteljau Slerp
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../face_forward/" class="md-nav__link">
        Face Forward
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../multi_robot_trajs/" class="md-nav__link">
        Multi Robot Trajs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../planner/" class="md-nav__link">
        Planner
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../polynomials/" class="md-nav__link">
        Polynomials
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../quaternion_interpolation/" class="md-nav__link">
        Quaternion Interpolation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sampling/" class="md-nav__link">
        Sampling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../simple_trajectories/" class="md-nav__link">
        Simple Trajectories
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../splines/" class="md-nav__link">
        Splines
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../timing/" class="md-nav__link">
        Timing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../trajectory/" class="md-nav__link">
        Trajectory
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Variable Time Curves
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Variable Time Curves
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#variables" class="md-nav__link">
    Variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#free_final_time_bezier" class="md-nav__link">
    free_final_time_bezier
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#free_final_time_spline" class="md-nav__link">
    free_final_time_spline
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#left_quadratic_fit_search" class="md-nav__link">
    left_quadratic_fit_search
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13_1_6" type="checkbox" id="__nav_13_1_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_13_1_6">
          Utils
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Utils" data-md-level="3">
        <label class="md-nav__title" for="__nav_13_1_6">
          <span class="md-nav__icon md-icon"></span>
          Utils
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/algos/" class="md-nav__link">
        Algos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/bag_frame/" class="md-nav__link">
        Bag Frame
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/boxes/" class="md-nav__link">
        Boxes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/bullet_utils/" class="md-nav__link">
        Bullet Utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/debug_visualizer/" class="md-nav__link">
        Debug Visualizer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/dynamics/" class="md-nav__link">
        Dynamics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/errors/" class="md-nav__link">
        Errors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/math_utils/" class="md-nav__link">
        Math Utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/mesh_utils/" class="md-nav__link">
        Mesh Utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/poses/" class="md-nav__link">
        Poses
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/python_utils/" class="md-nav__link">
        Python Utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/quaternion_derivatives/" class="md-nav__link">
        Quaternion Derivatives
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/quaternions/" class="md-nav__link">
        Quaternions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/rotations/" class="md-nav__link">
        Rotations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/transformations/" class="md-nav__link">
        Transformations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/video_concatenation/" class="md-nav__link">
        Video Concatenation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#variables" class="md-nav__link">
    Variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#free_final_time_bezier" class="md-nav__link">
    free_final_time_bezier
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#free_final_time_spline" class="md-nav__link">
    free_final_time_spline
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#left_quadratic_fit_search" class="md-nav__link">
    left_quadratic_fit_search
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/danielpmorton/pyastrobee/edit/main/reference/pyastrobee/trajectories/variable_time_curves.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="module-pyastrobeetrajectoriesvariable_time_curves">Module pyastrobee.trajectories.variable_time_curves</h1>
<p>Generating trajectories with a free final time</p>
<p>We optimize using the following cost function: (integral of jerk l2 norm) + (time weight parameter) * (total duration)</p>
<p>The weighting on the time component of this cost can be adjusted based on what component matters more. In general,
a value of 1e-4 appears to put the two components of the cost (jerk and time) on the same order of magnitude</p>
<p>Notes on the search method for the duration:
- We know that the jerk function is a quadratic, and if we add an affine factor based on the total duration
  of the trajectory, it will still be a quadratic. So, a version of quadratic fit search will work well here
- Depending on the weighting of this affine time component, the cost may look very linear. Even if this is the
  case, the search method as implemented will work well, because we will continually approach the boundary
  of feasibility until we stop within some tolerance
- Speaking of this feasibility boundary, this is the main difference between the implemented method and standard
  quadratic fit search. There is some T such that the trajectory is no longer feasible, given the constraints
  on velocity/accel/BCs..., and so in general, we want to solve for a T which is small, yet feasible. So, this
  search method incorporates this knowledge of this infeasible region for small time intervals.
- Ideally, we'd just be able to plug this into CVXPY (since it should just be a quadratic program with some
  constraints anyways). However, I tried a bunch of formulations of the constraints and it didn't seem to be
  convex or DCP (often leading to either quadratic forms of two variables, or equality constraints on convex
  functions). Maybe there is a better formulation out there...</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="ss">&quot;&quot;&quot;Generating trajectories with a free final time</span>

<span class="ss">We optimize using the following cost function: (integral of jerk l2 norm) + (time weight parameter) * (total duration)</span>

<span class="ss">The weighting on the time component of this cost can be adjusted based on what component matters more. In general,</span>

<span class="ss">a value of 1e-4 appears to put the two components of the cost (jerk and time) on the same order of magnitude</span>

<span class="ss">Notes on the search method for the duration:</span>

<span class="ss">- We know that the jerk function is a quadratic, and if we add an affine factor based on the total duration</span>

<span class="ss">  of the trajectory, it will still be a quadratic. So, a version of quadratic fit search will work well here</span>

<span class="ss">- Depending on the weighting of this affine time component, the cost may look very linear. Even if this is the</span>

<span class="ss">  case, the search method as implemented will work well, because we will continually approach the boundary</span>

<span class="ss">  of feasibility until we stop within some tolerance</span>

<span class="ss">- Speaking of this feasibility boundary, this is the main difference between the implemented method and standard</span>

<span class="ss">  quadratic fit search. There is some T such that the trajectory is no longer feasible, given the constraints</span>

<span class="ss">  on velocity/accel/BCs..., and so in general, we want to solve for a T which is small, yet feasible. So, this</span>

<span class="ss">  search method incorporates this knowledge of this infeasible region for small time intervals.</span>

<span class="ss">- Ideally, we&#39;d just be able to plug this into CVXPY (since it should just be a quadratic program with some</span>

<span class="ss">  constraints anyways). However, I tried a bunch of formulations of the constraints and it didn&#39;t seem to be</span>

<span class="ss">  convex or DCP (often leading to either quadratic forms of two variables, or equality constraints on convex</span>

<span class="ss">  functions). Maybe there is a better formulation out there...</span>

<span class="ss">&quot;&quot;&quot;</span>

<span class="k">from</span><span class="w"> </span><span class="n">typing</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">Optional</span><span class="p">,</span><span class="w"> </span><span class="n">Callable</span><span class="p">,</span><span class="w"> </span><span class="ow">Any</span>

<span class="n">import</span><span class="w"> </span><span class="n">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">np</span>

<span class="n">import</span><span class="w"> </span><span class="n">numpy</span><span class="p">.</span><span class="n">typing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">npt</span>

<span class="n">import</span><span class="w"> </span><span class="n">pybullet</span>

<span class="n">import</span><span class="w"> </span><span class="n">matplotlib</span><span class="p">.</span><span class="n">pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">plt</span>

<span class="k">from</span><span class="w"> </span><span class="n">pyastrobee</span><span class="p">.</span><span class="n">trajectories</span><span class="p">.</span><span class="n">trajectory</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">plot_traj_constraints</span>

<span class="k">from</span><span class="w"> </span><span class="n">pyastrobee</span><span class="p">.</span><span class="n">trajectories</span><span class="p">.</span><span class="n">bezier</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">BezierCurve</span><span class="p">,</span><span class="w"> </span><span class="n">bezier_trajectory</span>

<span class="k">from</span><span class="w"> </span><span class="n">pyastrobee</span><span class="p">.</span><span class="n">trajectories</span><span class="p">.</span><span class="n">splines</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="p">(</span>

<span class="w">    </span><span class="n">CompositeBezierCurve</span><span class="p">,</span>

<span class="w">    </span><span class="n">spline_trajectory_with_retiming</span><span class="p">,</span>

<span class="p">)</span>

<span class="k">from</span><span class="w"> </span><span class="n">pyastrobee</span><span class="p">.</span><span class="n">trajectories</span><span class="p">.</span><span class="n">curve_utils</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">traj_from_curve</span>

<span class="k">from</span><span class="w"> </span><span class="n">pyastrobee</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">boxes</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">Box</span>

<span class="k">from</span><span class="w"> </span><span class="n">pyastrobee</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">debug_visualizer</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">animate_path</span>

<span class="k">from</span><span class="w"> </span><span class="n">pyastrobee</span><span class="p">.</span><span class="n">config</span><span class="p">.</span><span class="n">astrobee_motion</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">LINEAR_SPEED_LIMIT</span><span class="p">,</span><span class="w"> </span><span class="n">LINEAR_ACCEL_LIMIT</span>

<span class="k">from</span><span class="w"> </span><span class="n">pyastrobee</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">errors</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">OptimizationError</span>

<span class="n">def</span><span class="w"> </span><span class="n">left_quadratic_fit_search</span><span class="p">(</span>

<span class="w">    </span><span class="nl">f</span><span class="p">:</span><span class="w"> </span><span class="n">Callable</span><span class="o">[</span><span class="n">[float</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="nc">float</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">tuple</span><span class="o">[</span><span class="n">float, Any</span><span class="o">]</span><span class="err">]</span><span class="p">,</span>

<span class="w">    </span><span class="nl">x_init</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="p">,</span>

<span class="w">    </span><span class="nl">dx_tol</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="p">,</span>

<span class="w">    </span><span class="nl">max_iters</span><span class="p">:</span><span class="w"> </span><span class="nc">int</span><span class="p">,</span>

<span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">tuple</span><span class="o">[</span><span class="n">float, float, list[Any</span><span class="o">]</span><span class="err">]:</span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;A modified version of quadratic fit search that assumes we have an infeasible region for small x (x &gt;= 0)</span>

<span class="ss">    See Algorithms for Optimization (Kochenderfer), Algorithm 3.4 for quadratic fit search</span>

<span class="ss">    Args:</span>

<span class="ss">        f (Callable[[float], float  |  tuple[float, Any]]): Univariate function to optimize, callable as f(x).</span>

<span class="ss">            The return must have the cost of the evaluation as the first output. Any additional outputs will be stored</span>

<span class="ss">            and the best will be returned at the end of the search</span>

<span class="ss">        x_init (float): Initial location to start the search</span>

<span class="ss">        dx_tol (float): Stopping tolerance on evaluation points: Terminate if the percent change between consecutive</span>

<span class="ss">            evaluation points is less than this tolerance</span>

<span class="ss">        max_iters (int): Maximum iterations of the algorithm (if the stopping tolerance is not achieved)</span>

<span class="ss">    Raises:</span>

<span class="ss">        OptimizationError: If no feasible solution is found in max_iters iterations</span>

<span class="ss">    Returns:</span>

<span class="ss">        tuple[float, float, list[Any]]:</span>

<span class="ss">            float: Best evaluation point x</span>

<span class="ss">            float: Cost of the function evaluation at the best x value</span>

<span class="ss">            list[Any]: Additional outputs of the function being optimized at the best x value. Empty list if there</span>

<span class="ss">                are no additional outputs</span>

<span class="ss">    &quot;&quot;&quot;</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">Mutable</span><span class="w"> </span><span class="n">dicts</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">keep</span><span class="w"> </span><span class="n">track</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">optimization</span><span class="w"> </span><span class="n">process</span>

<span class="w">    </span><span class="n">best</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;x&quot;</span><span class="err">:</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;cost&quot;</span><span class="err">:</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">inf</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;out&quot;</span><span class="err">:</span><span class="w"> </span><span class="err">[]}</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">init</span>

<span class="w">    </span><span class="nf">log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;iters&quot;</span><span class="err">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;feasibility_bound&quot;</span><span class="err">:</span><span class="w"> </span><span class="mi">0</span><span class="err">}</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">init</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="k">Create</span><span class="w"> </span><span class="n">wrapper</span><span class="w"> </span><span class="n">around</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">outputs</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="k">Return</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">solely</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">evaluation</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">outputs</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">dictionaries</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">needed</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">_f</span><span class="p">(</span><span class="nl">x</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">float</span><span class="err">:</span>

<span class="w">        </span><span class="n">fx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="w">        </span><span class="nf">log</span><span class="o">[</span><span class="n">&quot;iters&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">fx</span><span class="p">,</span><span class="w"> </span><span class="n">tuple</span><span class="p">)</span><span class="err">:</span>

<span class="w">            </span><span class="n">cost</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="k">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fx</span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="k">Out</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">packed</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">list</span>

<span class="w">        </span><span class="k">else</span><span class="err">:</span>

<span class="w">            </span><span class="n">cost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fx</span>

<span class="w">            </span><span class="k">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">[]</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">Check</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">best</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">far</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">so</span><span class="p">,</span><span class="w"> </span><span class="k">update</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">best</span><span class="o">[</span><span class="n">&quot;cost&quot;</span><span class="o">]</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="nl">inf</span><span class="p">:</span>

<span class="w">            </span><span class="n">best</span><span class="o">[</span><span class="n">&quot;x&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span>

<span class="w">            </span><span class="n">best</span><span class="o">[</span><span class="n">&quot;cost&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cost</span>

<span class="w">            </span><span class="n">best</span><span class="o">[</span><span class="n">&quot;out&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">out</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">cost</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">Find</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">quadratic</span><span class="w"> </span><span class="n">fit</span><span class="w"> </span><span class="k">search</span><span class="w"> </span><span class="k">interval</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="n">given</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="k">search</span><span class="w"> </span><span class="n">location</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">assumes</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">positive</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">infeasible</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="n">occurs</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">too</span><span class="w"> </span><span class="n">small</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">_find_init_interval_from_guess</span><span class="p">(</span><span class="nl">x</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="p">)</span><span class="err">:</span>

<span class="w">        </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span>

<span class="w">        </span><span class="n">yb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_f</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">yb</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="nl">inf</span><span class="p">:</span>

<span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="n">yb</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">inf</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nf">log</span><span class="o">[</span><span class="n">&quot;iters&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">max_iters</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="err">:</span>

<span class="w">                </span><span class="nf">log</span><span class="o">[</span><span class="n">&quot;feasibility_bound&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="nf">log</span><span class="o">[</span><span class="n">&quot;feasibility_bound&quot;</span><span class="o">]</span><span class="p">)</span>

<span class="w">                </span><span class="n">b</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mi">2</span>

<span class="w">                </span><span class="n">yb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_f</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

<span class="w">        </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nf">log</span><span class="o">[</span><span class="n">&quot;feasibility_bound&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span>

<span class="w">        </span><span class="n">ya</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_f</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">ya</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="nl">inf</span><span class="p">:</span>

<span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="n">ya</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">inf</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nf">log</span><span class="o">[</span><span class="n">&quot;iters&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">max_iters</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="err">:</span>

<span class="w">                </span><span class="nf">log</span><span class="o">[</span><span class="n">&quot;feasibility_bound&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="nf">log</span><span class="o">[</span><span class="n">&quot;feasibility_bound&quot;</span><span class="o">]</span><span class="p">)</span>

<span class="w">                </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span>

<span class="w">                </span><span class="n">ya</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_f</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">know</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">valid</span>

<span class="w">        </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">a</span><span class="p">)</span>

<span class="w">        </span><span class="n">yc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_f</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">ya</span><span class="p">,</span><span class="w"> </span><span class="n">yb</span><span class="p">,</span><span class="w"> </span><span class="n">yc</span>

<span class="w">    </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">ya</span><span class="p">,</span><span class="w"> </span><span class="n">yb</span><span class="p">,</span><span class="w"> </span><span class="n">yc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_find_init_interval_from_guess</span><span class="p">(</span><span class="n">x_init</span><span class="p">)</span>

<span class="w">    </span><span class="n">x_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">init</span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="nf">log</span><span class="o">[</span><span class="n">&quot;iters&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">max_iters</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="err">:</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Quadratic</span><span class="w"> </span><span class="n">fit</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="k">search</span><span class="w"> </span><span class="n">location</span>

<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>

<span class="w">            </span><span class="mf">0.5</span>

<span class="w">            </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">ya</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">yb</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">yc</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

<span class="w">            </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">ya</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">yb</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">yc</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">b</span><span class="p">))</span>

<span class="w">        </span><span class="p">)</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Handle</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">fit</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">known</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">infeasible</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nf">log</span><span class="o">[</span><span class="n">&quot;feasibility_bound&quot;</span><span class="o">]</span><span class="err">:</span>

<span class="w">            </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nf">log</span><span class="o">[</span><span class="n">&quot;feasibility_bound&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span>

<span class="w">        </span><span class="n">yx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">yx</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="nl">inf</span><span class="p">:</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">Infeasible</span>

<span class="w">            </span><span class="nf">log</span><span class="o">[</span><span class="n">&quot;feasibility_bound&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="nf">log</span><span class="o">[</span><span class="n">&quot;feasibility_bound&quot;</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>

<span class="w">        </span><span class="k">else</span><span class="err">:</span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="n">Standard</span><span class="w"> </span><span class="n">quadratic</span><span class="w"> </span><span class="n">fit</span><span class="w"> </span><span class="k">update</span><span class="p">,</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">extra</span><span class="w"> </span><span class="n">cases</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">between</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">c</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nl">a</span><span class="p">:</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">yx</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nl">ya</span><span class="p">:</span>

<span class="w">                    </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">ya</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">yx</span>

<span class="w">            </span><span class="n">elif</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nl">c</span><span class="p">:</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nl">b</span><span class="p">:</span>

<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="n">yx</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nl">yb</span><span class="p">:</span>

<span class="w">                        </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">yc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">yx</span>

<span class="w">                    </span><span class="k">else</span><span class="err">:</span>

<span class="w">                        </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">ya</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">yb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">yb</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">yx</span>

<span class="w">                </span><span class="n">elif</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nl">b</span><span class="p">:</span>

<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="n">yx</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nl">yb</span><span class="p">:</span>

<span class="w">                        </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">ya</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">yx</span>

<span class="w">                    </span><span class="k">else</span><span class="err">:</span>

<span class="w">                        </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">yc</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">yb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">yb</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">yx</span>

<span class="w">            </span><span class="k">else</span><span class="err">:</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">c</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">yx</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nl">yc</span><span class="p">:</span>

<span class="w">                    </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">yc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">yx</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Termination</span><span class="w"> </span><span class="nl">criteria</span><span class="p">:</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">evaluation</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="k">update</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">shrunk</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">within</span><span class="w"> </span><span class="ow">some</span><span class="w"> </span><span class="n">tolerance</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">x_prev</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nf">abs</span><span class="p">((</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x_prev</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">x_prev</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nl">dx_tol</span><span class="p">:</span>

<span class="w">            </span><span class="k">break</span>

<span class="w">        </span><span class="n">x_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">best</span><span class="o">[</span><span class="n">&quot;x&quot;</span><span class="o">]</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">        </span><span class="n">raise</span><span class="w"> </span><span class="n">OptimizationError</span><span class="p">(</span><span class="ss">&quot;Unable to find a feasible solution&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">best</span><span class="o">[</span><span class="n">&quot;x&quot;</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">best</span><span class="o">[</span><span class="n">&quot;cost&quot;</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">best</span><span class="o">[</span><span class="n">&quot;out&quot;</span><span class="o">]</span>

<span class="n">def</span><span class="w"> </span><span class="n">free_final_time_bezier</span><span class="p">(</span>

<span class="w">    </span><span class="nl">p0</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">    </span><span class="nl">pf</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">    </span><span class="nl">t0</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="p">,</span>

<span class="w">    </span><span class="nl">tf_init</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="p">,</span>

<span class="w">    </span><span class="nl">n_control_pts</span><span class="p">:</span><span class="w"> </span><span class="nc">int</span><span class="p">,</span>

<span class="w">    </span><span class="nl">v0</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">npt.ArrayLike</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="nl">vf</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">npt.ArrayLike</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="nl">a0</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">npt.ArrayLike</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="nl">af</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">npt.ArrayLike</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="nl">box</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Box</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="nl">v_max</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">float</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="nl">a_max</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">float</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="nl">time_weight</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e-4</span><span class="p">,</span>

<span class="w">    </span><span class="nl">timing_rtol</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.01</span><span class="p">,</span>

<span class="w">    </span><span class="nl">max_iters</span><span class="p">:</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span>

<span class="w">    </span><span class="nl">debug</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">False</span><span class="p">,</span>

<span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">BezierCurve</span><span class="p">:</span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;Optimize a Bezier curve trajectory to balance minimizing jerk with minimizing the total duration</span>

<span class="ss">    Args:</span>

<span class="ss">        p0 (npt.ArrayLike): Initial position, shape (3,)</span>

<span class="ss">        pf (npt.ArrayLike): Final position, shape (3,)</span>

<span class="ss">        t0 (float): Starting time</span>

<span class="ss">        tf_init (float): Initial estimate of the final time</span>

<span class="ss">        n_control_pts (int): Number of control points for the Bezier curve. Must be &gt;= to the number of constraints,</span>

<span class="ss">            and should not be too large (&gt;15ish) as this can reduce optimization performance. 6-10 is usually good</span>

<span class="ss">        v0 (Optional[npt.ArrayLike]): Initial velocity, shape (3,). Defaults to None (unconstrained)</span>

<span class="ss">        vf (Optional[npt.ArrayLike]): Final velocity, shape (3,). Defaults to None (unconstrained)</span>

<span class="ss">        a0 (Optional[npt.ArrayLike]): Initial acceleration, shape (3,). Defaults to None (unconstrained)</span>

<span class="ss">        af (Optional[npt.ArrayLike]): Final acceleration, shape (3,). Defaults to None (unconstrained)</span>

<span class="ss">        box (Optional[Box]): Box constraint on (lower, upper) position bounds. Defaults to None (unconstrained)</span>

<span class="ss">        v_max (Optional[float]): Maximum L2 norm of the velocity. Defaults to None (unconstrained)</span>

<span class="ss">        a_max (Optional[float]): Maximum L2 norm of the acceleration. Defaults to None (unconstrained)</span>

<span class="ss">        time_weight (float, optional): Objective function weight corresponding to a linear penalty on the duration.</span>

<span class="ss">            Defaults to 1e-4. (this was observed to give duration roughly the same weighting as jerk)</span>

<span class="ss">        timing_rtol (float, optional): Tolerance on the free-final-time optimization. Defaults to 0.01</span>

<span class="ss">            (within 1% of the optimal time)</span>

<span class="ss">        max_iters (int, optional): Maximum number of iterations for the free-final-time optimization. Defaults to 15.</span>

<span class="ss">        debug (bool, optional): Whether to print/plot details on the free-final-time optimization. Defaults to False.</span>

<span class="ss">    Returns:</span>

<span class="ss">        BezierCurve: The optimal curve</span>

<span class="ss">    &quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">curve_kwargs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dict</span><span class="p">(</span>

<span class="w">        </span><span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span>

<span class="w">        </span><span class="n">pf</span><span class="o">=</span><span class="n">pf</span><span class="p">,</span>

<span class="w">        </span><span class="n">t0</span><span class="o">=</span><span class="n">t0</span><span class="p">,</span>

<span class="w">        </span><span class="n">tf</span><span class="o">=</span><span class="n">tf_init</span><span class="p">,</span>

<span class="w">        </span><span class="n">n_control_pts</span><span class="o">=</span><span class="n">n_control_pts</span><span class="p">,</span>

<span class="w">        </span><span class="n">v0</span><span class="o">=</span><span class="n">v0</span><span class="p">,</span>

<span class="w">        </span><span class="n">vf</span><span class="o">=</span><span class="n">vf</span><span class="p">,</span>

<span class="w">        </span><span class="n">a0</span><span class="o">=</span><span class="n">a0</span><span class="p">,</span>

<span class="w">        </span><span class="n">af</span><span class="o">=</span><span class="n">af</span><span class="p">,</span>

<span class="w">        </span><span class="n">box</span><span class="o">=</span><span class="n">box</span><span class="p">,</span>

<span class="w">        </span><span class="n">v_max</span><span class="o">=</span><span class="n">v_max</span><span class="p">,</span>

<span class="w">        </span><span class="n">a_max</span><span class="o">=</span><span class="n">a_max</span><span class="p">,</span>

<span class="w">        </span><span class="n">time_weight</span><span class="o">=</span><span class="n">time_weight</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nl">debug</span><span class="p">:</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Keep</span><span class="w"> </span><span class="n">track</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">costs</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="nc">time</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">plot</span><span class="w"> </span><span class="n">afterwards</span>

<span class="w">        </span><span class="nl">costs_log</span><span class="p">:</span><span class="w"> </span><span class="n">dict</span><span class="o">[</span><span class="n">float, float</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{}</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">Wrapper</span><span class="w"> </span><span class="n">around</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">bezier</span><span class="w"> </span><span class="n">trajectory</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">pop</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">quadratic</span><span class="w"> </span><span class="n">fit</span><span class="w"> </span><span class="k">search</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="k">method</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">expected</span><span class="w"> </span><span class="n">inputs</span><span class="o">/</span><span class="n">outputs</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">can</span><span class="s1">&#39;t solve for the curve</span>

<span class="s1">    # e.g. time as the input, and output the cost and the solved curve</span>

<span class="s1">    def _curve_wrapper(t: float) -&gt; tuple[float, BezierCurve]:</span>

<span class="s1">        kwargs = curve_kwargs | {&quot;tf&quot;: t}</span>

<span class="s1">        print(&quot;Evaluating time: &quot;, t)</span>

<span class="s1">        try:</span>

<span class="s1">            curve, cost = bezier_trajectory(**kwargs)</span>

<span class="s1">        except OptimizationError:</span>

<span class="s1">            curve, cost = None, np.inf</span>

<span class="s1">        if debug:</span>

<span class="s1">            # Print info on the breakdown of the cost between jerk and time</span>

<span class="s1">            print(</span>

<span class="s1">                &quot;Cost: &quot;,</span>

<span class="s1">                cost,</span>

<span class="s1">                &quot; Jerk: &quot;,</span>

<span class="s1">                cost - time_weight * t,</span>

<span class="s1">                &quot; Time: &quot;,</span>

<span class="s1">                time_weight * t,</span>

<span class="s1">            )</span>

<span class="s1">            costs_log[t] = cost</span>

<span class="s1">        # The quadratic search assumes that cost is the first output</span>

<span class="s1">        return cost, curve</span>

<span class="s1">    t, cost, output = left_quadratic_fit_search(</span>

<span class="s1">        _curve_wrapper, tf_init, timing_rtol, max_iters</span>

<span class="s1">    )</span>

<span class="s1">    best_curve = output[0]</span>

<span class="s1">    if debug:</span>

<span class="s1">        print(&quot;Optimal time: &quot;, t, &quot; yields cost: &quot;, cost)</span>

<span class="s1">        _plot_optimization_data(costs_log)</span>

<span class="s1">    return best_curve</span>

<span class="s1">def free_final_time_spline(</span>

<span class="s1">    p0: npt.ArrayLike,</span>

<span class="s1">    pf: npt.ArrayLike,</span>

<span class="s1">    t0: float,</span>

<span class="s1">    tf_init: float,</span>

<span class="s1">    pts_per_curve: int,</span>

<span class="s1">    boxes: list[Box],</span>

<span class="s1">    initial_durations: npt.ArrayLike,</span>

<span class="s1">    v0: Optional[npt.ArrayLike] = None,</span>

<span class="s1">    vf: Optional[npt.ArrayLike] = None,</span>

<span class="s1">    a0: Optional[npt.ArrayLike] = None,</span>

<span class="s1">    af: Optional[npt.ArrayLike] = None,</span>

<span class="s1">    v_max: Optional[float] = None,</span>

<span class="s1">    a_max: Optional[float] = None,</span>

<span class="s1">    kappa_min: float = 1e-2,</span>

<span class="s1">    omega: float = 3,</span>

<span class="s1">    max_retiming_iters: int = 10,</span>

<span class="s1">    time_weight: float = 1e-4,</span>

<span class="s1">    timing_rtol: float = 0.01,</span>

<span class="s1">    max_iters: int = 15,</span>

<span class="s1">    debug: bool = False,</span>

<span class="s1">) -&gt; CompositeBezierCurve:</span>

<span class="s1">    &quot;&quot;&quot;Optimize a spline trajectory to balance minimizing jerk with minimizing the total duration</span>

<span class="s1">    Args:</span>

<span class="s1">        p0 (npt.ArrayLike): Initial position, shape (3,)</span>

<span class="s1">        pf (npt.ArrayLike): Final position, shape (3,)</span>

<span class="s1">        t0 (float): Starting time</span>

<span class="s1">        tf_init (float): Initial estimate of the final time</span>

<span class="s1">        pts_per_curve (int): Number of control points per Bezier curve. Generally, should be around 6-10</span>

<span class="s1">        boxes (list[Box]): Sequential list of safe box regions pass through</span>

<span class="s1">        initial_durations (npt.ArrayLike): Initial estimate of the durations for each segment of the trajectory. These</span>

<span class="s1">            will be refined during the retiming process. Shape (num_boxes,)</span>

<span class="s1">        v0 (Optional[npt.ArrayLike]): Initial velocity, shape (3,). Defaults to None (unconstrained)</span>

<span class="s1">        vf (Optional[npt.ArrayLike]): Final velocity, shape (3,). Defaults to None (unconstrained)</span>

<span class="s1">        a0 (Optional[npt.ArrayLike]): Initial acceleration, shape (3,). Defaults to None (unconstrained)</span>

<span class="s1">        af (Optional[npt.ArrayLike]): Final acceleration, shape (3,). Defaults to None (unconstrained)</span>

<span class="s1">        v_max (Optional[float]): Maximum L2 norm of the velocity. Defaults to None (unconstrained)</span>

<span class="s1">        a_max (Optional[float]): Maximum L2 norm of the acceleration. Defaults to None (unconstrained)</span>

<span class="s1">        kappa_min (float, optional): Retiming trust region parameter: Defines the maximum change in adjacent scaling</span>

<span class="s1">            factors. Defaults to 1e-2.</span>

<span class="s1">        omega (float, optional): Retiming parameter: Defines the rate at which kappa decays after each iteration.</span>

<span class="s1">            Must be &gt; 1. Small values (~2) work well when transition time estimates are poor, but larger values (~5)</span>

<span class="s1">            are more effective otherwise. Defaults to 3.</span>

<span class="s1">        max_retiming_iters (int, optional): Maximum number of iterations for the retiming process. Defaults to 10.</span>

<span class="s1">        time_weight (float, optional): Objective function weight corresponding to a linear penalty on the duration.</span>

<span class="s1">            Defaults to 1e-4 (this was observed to give duration roughly the same weighting as jerk)</span>

<span class="s1">        timing_rtol (float, optional): Tolerance on the free-final-time optimization. Defaults to 0.01</span>

<span class="s1">            (within 1% of the optimal time)</span>

<span class="s1">        max_iters (int, optional): Maximum number of iterations for the free-final-time optimization. Defaults to 15.</span>

<span class="s1">        debug (bool, optional): Whether to print/plot details on the free-final-time optimization. Defaults to False.</span>

<span class="s1">    Returns:</span>

<span class="s1">        CompositeBezierCurve: The optimal curve</span>

<span class="s1">    &quot;&quot;&quot;</span>

<span class="s1">    curve_kwargs = dict(</span>

<span class="s1">        p0=p0,</span>

<span class="s1">        pf=pf,</span>

<span class="s1">        t0=t0,</span>

<span class="s1">        tf=tf_init,</span>

<span class="s1">        pts_per_curve=pts_per_curve,</span>

<span class="s1">        boxes=boxes,</span>

<span class="s1">        initial_durations=initial_durations,</span>

<span class="s1">        v0=v0,</span>

<span class="s1">        vf=vf,</span>

<span class="s1">        a0=a0,</span>

<span class="s1">        af=af,</span>

<span class="s1">        v_max=v_max,</span>

<span class="s1">        a_max=a_max,</span>

<span class="s1">        kappa_min=kappa_min,</span>

<span class="s1">        omega=omega,</span>

<span class="s1">        max_retiming_iters=max_retiming_iters,</span>

<span class="s1">        time_weight=time_weight,</span>

<span class="s1">    )</span>

<span class="s1">    # As we vary the final time, we need to make sure that the durations per box</span>

<span class="s1">    # also get updated. So, use the fractional durations and rescale based on the total time</span>

<span class="s1">    duration_fractions = initial_durations / (tf_init - t0)</span>

<span class="s1">    if debug:</span>

<span class="s1">        # Keep track of the costs per time to plot afterwards</span>

<span class="s1">        costs_log: dict[float, float] = {}</span>

<span class="s1">    # Wrapper around the spline trajectory function so that we can pop this into our quadratic fit search</span>

<span class="s1">    # method with the expected inputs/outputs, and handle when we can&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">solve</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">curve</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span><span class="w"> </span><span class="nc">time</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">input</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">output</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">solved</span><span class="w"> </span><span class="n">curve</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">_curve_wrapper</span><span class="p">(</span><span class="nl">t</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">tuple</span><span class="o">[</span><span class="n">float, CompositeBezierCurve</span><span class="o">]</span><span class="err">:</span>

<span class="w">        </span><span class="n">nonlocal</span><span class="w"> </span><span class="n">duration_fractions</span>

<span class="w">        </span><span class="n">kwargs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">curve_kwargs</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span>

<span class="w">            </span><span class="ss">&quot;tf&quot;</span><span class="err">:</span><span class="w"> </span><span class="n">t</span><span class="p">,</span>

<span class="w">            </span><span class="ss">&quot;initial_durations&quot;</span><span class="err">:</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">duration_fractions</span><span class="p">,</span>

<span class="w">        </span><span class="err">}</span>

<span class="w">        </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;Evaluating duration: &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)</span>

<span class="w">        </span><span class="k">try</span><span class="err">:</span>

<span class="w">            </span><span class="n">curve</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spline_trajectory_with_retiming</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="k">Update</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">understanding</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">best</span><span class="w"> </span><span class="n">curve</span><span class="w"> </span><span class="n">durations</span><span class="w"> </span><span class="n">based</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">retiming</span><span class="w"> </span><span class="n">process</span>

<span class="w">            </span><span class="n">duration_fractions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">curve</span><span class="p">.</span><span class="n">segment_durations</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">curve</span><span class="p">.</span><span class="n">duration</span>

<span class="w">        </span><span class="ow">except</span><span class="w"> </span><span class="nl">OptimizationError</span><span class="p">:</span>

<span class="w">            </span><span class="n">curve</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">inf</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nl">debug</span><span class="p">:</span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="k">Print</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">breakdown</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="ow">between</span><span class="w"> </span><span class="n">jerk</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nc">time</span>

<span class="w">            </span><span class="k">print</span><span class="p">(</span>

<span class="w">                </span><span class="ss">&quot;Cost: &quot;</span><span class="p">,</span>

<span class="w">                </span><span class="n">cost</span><span class="p">,</span>

<span class="w">                </span><span class="ss">&quot; Jerk: &quot;</span><span class="p">,</span>

<span class="w">                </span><span class="n">cost</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">time_weight</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">,</span>

<span class="w">                </span><span class="ss">&quot; Time: &quot;</span><span class="p">,</span>

<span class="w">                </span><span class="n">time_weight</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">,</span>

<span class="w">            </span><span class="p">)</span>

<span class="w">            </span><span class="n">costs_log</span><span class="o">[</span><span class="n">t</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cost</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">quadratic</span><span class="w"> </span><span class="k">search</span><span class="w"> </span><span class="n">assumes</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">first</span><span class="w"> </span><span class="k">output</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">cost</span><span class="p">,</span><span class="w"> </span><span class="n">curve</span>

<span class="w">    </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="p">,</span><span class="w"> </span><span class="k">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">left_quadratic_fit_search</span><span class="p">(</span>

<span class="w">        </span><span class="n">_curve_wrapper</span><span class="p">,</span><span class="w"> </span><span class="n">tf_init</span><span class="p">,</span><span class="w"> </span><span class="n">timing_rtol</span><span class="p">,</span><span class="w"> </span><span class="n">max_iters</span>

<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="n">best_curve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">output</span><span class="o">[</span><span class="n">0</span><span class="o">]</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nl">debug</span><span class="p">:</span>

<span class="w">        </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;Optimal time: &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot; yields cost: &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="p">)</span>

<span class="w">        </span><span class="n">_plot_optimization_data</span><span class="p">(</span><span class="n">costs_log</span><span class="p">)</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">best_curve</span>

<span class="n">def</span><span class="w"> </span><span class="n">_plot_optimization_data</span><span class="p">(</span><span class="nl">cost_log</span><span class="p">:</span><span class="w"> </span><span class="n">dict</span><span class="o">[</span><span class="n">float, float</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="nl">show</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">True</span><span class="p">)</span><span class="err">:</span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;Helper function to plot the time optimization results when debugging</span>

<span class="ss">    Args:</span>

<span class="ss">        cost_log (dict[float, float]): Costs for each duration. Keys: times, Values: costs</span>

<span class="ss">        show (bool, optional): Whether or not to show the plot. Defaults to True.</span>

<span class="ss">    &quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">fig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">()</span>

<span class="w">    </span><span class="n">times</span><span class="p">,</span><span class="w"> </span><span class="n">costs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zip</span><span class="p">(</span><span class="o">*</span><span class="n">cost_log</span><span class="p">.</span><span class="n">items</span><span class="p">())</span>

<span class="w">    </span><span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>

<span class="w">    </span><span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">times</span><span class="p">,</span><span class="w"> </span><span class="n">costs</span><span class="p">)</span>

<span class="w">    </span><span class="n">sort_idxs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>

<span class="w">    </span><span class="n">times_sorted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="k">array</span><span class="p">(</span><span class="n">times</span><span class="p">)</span><span class="o">[</span><span class="n">sort_idxs</span><span class="o">]</span>

<span class="w">    </span><span class="n">costs_sorted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="k">array</span><span class="p">(</span><span class="n">costs</span><span class="p">)</span><span class="o">[</span><span class="n">sort_idxs</span><span class="o">]</span>

<span class="w">    </span><span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times_sorted</span><span class="p">,</span><span class="w"> </span><span class="n">costs_sorted</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;--&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="ss">&quot;Time&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="ss">&quot;Cost&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="ss">&quot;Cost vs duration&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>

<span class="w">    </span><span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="k">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">costs</span><span class="p">)),</span><span class="w"> </span><span class="n">costs</span><span class="p">)</span>

<span class="w">    </span><span class="n">plt</span><span class="p">.</span><span class="n">scatter</span><span class="p">(</span><span class="k">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">costs</span><span class="p">)),</span><span class="w"> </span><span class="n">costs</span><span class="p">)</span>

<span class="w">    </span><span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="ss">&quot;Iteration&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="ss">&quot;Cost&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="ss">&quot;Convergence&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nl">show</span><span class="p">:</span>

<span class="w">        </span><span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">def</span><span class="w"> </span><span class="n">_bezier_main</span><span class="p">()</span><span class="err">:</span>

<span class="w">    </span><span class="n">p0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>

<span class="w">    </span><span class="n">pf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>

<span class="w">    </span><span class="n">t0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="w">    </span><span class="n">tf_init</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span>

<span class="w">    </span><span class="n">n_control_pts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span>

<span class="w">    </span><span class="n">dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.1</span>

<span class="w">    </span><span class="n">v0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span><span class="w"> </span><span class="mf">0.2</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">)</span>

<span class="w">    </span><span class="n">vf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>

<span class="w">    </span><span class="n">a0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>

<span class="w">    </span><span class="n">af</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>

<span class="w">    </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;Speed limit: &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">LINEAR_SPEED_LIMIT</span><span class="p">)</span>

<span class="w">    </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;Accel limit: &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">LINEAR_ACCEL_LIMIT</span><span class="p">)</span>

<span class="w">    </span><span class="n">curve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">free_final_time_bezier</span><span class="p">(</span>

<span class="w">        </span><span class="n">p0</span><span class="p">,</span>

<span class="w">        </span><span class="n">pf</span><span class="p">,</span>

<span class="w">        </span><span class="n">t0</span><span class="p">,</span>

<span class="w">        </span><span class="n">tf_init</span><span class="p">,</span>

<span class="w">        </span><span class="n">n_control_pts</span><span class="p">,</span>

<span class="w">        </span><span class="n">v0</span><span class="p">,</span>

<span class="w">        </span><span class="n">vf</span><span class="p">,</span>

<span class="w">        </span><span class="n">a0</span><span class="p">,</span>

<span class="w">        </span><span class="n">af</span><span class="p">,</span>

<span class="w">        </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="n">LINEAR_SPEED_LIMIT</span><span class="p">,</span>

<span class="w">        </span><span class="n">LINEAR_ACCEL_LIMIT</span><span class="p">,</span>

<span class="w">        </span><span class="n">debug</span><span class="o">=</span><span class="k">True</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="n">traj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">traj_from_curve</span><span class="p">(</span><span class="n">curve</span><span class="p">,</span><span class="w"> </span><span class="n">dt</span><span class="p">)</span>

<span class="w">    </span><span class="n">traj</span><span class="p">.</span><span class="n">plot</span><span class="p">()</span>

<span class="w">    </span><span class="n">plot_traj_constraints</span><span class="p">(</span>

<span class="w">        </span><span class="n">traj</span><span class="p">,</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"> </span><span class="n">LINEAR_SPEED_LIMIT</span><span class="p">,</span><span class="w"> </span><span class="n">LINEAR_ACCEL_LIMIT</span><span class="p">,</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"> </span><span class="k">None</span>

<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="n">pybullet</span><span class="p">.</span><span class="k">connect</span><span class="p">(</span><span class="n">pybullet</span><span class="p">.</span><span class="n">GUI</span><span class="p">)</span>

<span class="w">    </span><span class="n">traj</span><span class="p">.</span><span class="n">visualize</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

<span class="w">    </span><span class="n">animate_path</span><span class="p">(</span><span class="n">traj</span><span class="p">.</span><span class="n">positions</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>

<span class="w">    </span><span class="k">input</span><span class="p">(</span><span class="ss">&quot;Animation complete, press Enter to finish&quot;</span><span class="p">)</span>

<span class="n">def</span><span class="w"> </span><span class="n">_spline_main</span><span class="p">()</span><span class="err">:</span>

<span class="w">    </span><span class="n">p0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">0.1, 0.2, 0.3</span><span class="o">]</span>

<span class="w">    </span><span class="n">pf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">1.5, 5, 1.7</span><span class="o">]</span>

<span class="w">    </span><span class="n">t0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="w">    </span><span class="n">tf_init</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span>

<span class="w">    </span><span class="n">pts_per_curve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="mi">8</span>

<span class="w">    </span><span class="n">v0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="w">    </span><span class="n">vf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="w">    </span><span class="n">a0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="w">    </span><span class="n">af</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="w">    </span><span class="n">dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.1</span>

<span class="w">    </span><span class="n">boxes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span>

<span class="n">        Box((0, 0, 0), (1, 1, 1)),</span>

<span class="n">        Box((0.5, 0.5, 0.5), (1.5, 5, 1.5)),</span>

<span class="n">        Box((1, 4.5, 1), (2, 5.5, 2)),</span>

<span class="n">    </span><span class="o">]</span>

<span class="w">    </span><span class="n">n_curves</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">boxes</span><span class="p">)</span>

<span class="w">    </span><span class="n">durations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_curves</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">tf_init</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t0</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">n_curves</span>

<span class="w">    </span><span class="n">curve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">free_final_time_spline</span><span class="p">(</span>

<span class="w">        </span><span class="n">p0</span><span class="p">,</span>

<span class="w">        </span><span class="n">pf</span><span class="p">,</span>

<span class="w">        </span><span class="n">t0</span><span class="p">,</span>

<span class="w">        </span><span class="n">tf_init</span><span class="p">,</span>

<span class="w">        </span><span class="n">pts_per_curve</span><span class="p">,</span>

<span class="w">        </span><span class="n">boxes</span><span class="p">,</span>

<span class="w">        </span><span class="n">durations</span><span class="p">,</span>

<span class="w">        </span><span class="n">v0</span><span class="p">,</span>

<span class="w">        </span><span class="n">vf</span><span class="p">,</span>

<span class="w">        </span><span class="n">a0</span><span class="p">,</span>

<span class="w">        </span><span class="n">af</span><span class="p">,</span>

<span class="w">        </span><span class="n">LINEAR_SPEED_LIMIT</span><span class="p">,</span>

<span class="w">        </span><span class="n">LINEAR_ACCEL_LIMIT</span><span class="p">,</span>

<span class="w">        </span><span class="n">debug</span><span class="o">=</span><span class="k">True</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="n">traj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">traj_from_curve</span><span class="p">(</span><span class="n">curve</span><span class="p">,</span><span class="w"> </span><span class="n">dt</span><span class="p">)</span>

<span class="w">    </span><span class="n">traj</span><span class="p">.</span><span class="n">plot</span><span class="p">()</span>

<span class="w">    </span><span class="n">plot_traj_constraints</span><span class="p">(</span>

<span class="w">        </span><span class="n">traj</span><span class="p">,</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"> </span><span class="n">LINEAR_SPEED_LIMIT</span><span class="p">,</span><span class="w"> </span><span class="n">LINEAR_ACCEL_LIMIT</span><span class="p">,</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"> </span><span class="k">None</span>

<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="n">pybullet</span><span class="p">.</span><span class="k">connect</span><span class="p">(</span><span class="n">pybullet</span><span class="p">.</span><span class="n">GUI</span><span class="p">)</span>

<span class="w">    </span><span class="n">traj</span><span class="p">.</span><span class="n">visualize</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

<span class="w">    </span><span class="n">animate_path</span><span class="p">(</span><span class="n">traj</span><span class="p">.</span><span class="n">positions</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>

<span class="w">    </span><span class="k">input</span><span class="p">(</span><span class="ss">&quot;Animation complete, press Enter to finish&quot;</span><span class="p">)</span>

<span class="k">if</span><span class="w"> </span><span class="n">__name__</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;__main__&quot;</span><span class="err">:</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">_bezier_main</span><span class="p">()</span>

<span class="w">    </span><span class="n">_spline_main</span><span class="p">()</span>
</code></pre></div>

</details>
<h2 id="variables">Variables</h2>
<div class="codehilite"><pre><span></span><code><span class="n">LINEAR_ACCEL_LIMIT</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">LINEAR_SPEED_LIMIT</span>
</code></pre></div>

<h2 id="functions">Functions</h2>
<h3 id="free_final_time_bezier">free_final_time_bezier</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">free_final_time_bezier</span><span class="p">(</span>
    <span class="n">p0</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">pf</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">t0</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">tf_init</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">n_control_pts</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">v0</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">vf</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">a0</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">af</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">box</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pyastrobee</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">boxes</span><span class="o">.</span><span class="n">Box</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">v_max</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">a_max</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">time_weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="p">,</span>
    <span class="n">timing_rtol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="n">max_iters</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyastrobee</span><span class="o">.</span><span class="n">trajectories</span><span class="o">.</span><span class="n">bezier</span><span class="o">.</span><span class="n">BezierCurve</span>
</code></pre></div>

<p>Optimize a Bezier curve trajectory to balance minimizing jerk with minimizing the total duration</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>p0</td>
<td>npt.ArrayLike</td>
<td>Initial position, shape (3,)</td>
<td>None</td>
</tr>
<tr>
<td>pf</td>
<td>npt.ArrayLike</td>
<td>Final position, shape (3,)</td>
<td>None</td>
</tr>
<tr>
<td>t0</td>
<td>float</td>
<td>Starting time</td>
<td>None</td>
</tr>
<tr>
<td>tf_init</td>
<td>float</td>
<td>Initial estimate of the final time</td>
<td>None</td>
</tr>
<tr>
<td>n_control_pts</td>
<td>int</td>
<td>Number of control points for the Bezier curve. Must be &gt;= to the number of constraints,<br>and should not be too large (&gt;15ish) as this can reduce optimization performance. 6-10 is usually good</td>
<td>None</td>
</tr>
<tr>
<td>v0</td>
<td>Optional[npt.ArrayLike]</td>
<td>Initial velocity, shape (3,). Defaults to None (unconstrained)</td>
<td>None</td>
</tr>
<tr>
<td>vf</td>
<td>Optional[npt.ArrayLike]</td>
<td>Final velocity, shape (3,). Defaults to None (unconstrained)</td>
<td>None</td>
</tr>
<tr>
<td>a0</td>
<td>Optional[npt.ArrayLike]</td>
<td>Initial acceleration, shape (3,). Defaults to None (unconstrained)</td>
<td>None</td>
</tr>
<tr>
<td>af</td>
<td>Optional[npt.ArrayLike]</td>
<td>Final acceleration, shape (3,). Defaults to None (unconstrained)</td>
<td>None</td>
</tr>
<tr>
<td>box</td>
<td>Optional[Box]</td>
<td>Box constraint on (lower, upper) position bounds. Defaults to None (unconstrained)</td>
<td>None</td>
</tr>
<tr>
<td>v_max</td>
<td>Optional[float]</td>
<td>Maximum L2 norm of the velocity. Defaults to None (unconstrained)</td>
<td>None</td>
</tr>
<tr>
<td>a_max</td>
<td>Optional[float]</td>
<td>Maximum L2 norm of the acceleration. Defaults to None (unconstrained)</td>
<td>None</td>
</tr>
<tr>
<td>time_weight</td>
<td>float</td>
<td>Objective function weight corresponding to a linear penalty on the duration.<br>Defaults to 1e-4. (this was observed to give duration roughly the same weighting as jerk)</td>
<td>None</td>
</tr>
<tr>
<td>timing_rtol</td>
<td>float</td>
<td>Tolerance on the free-final-time optimization. Defaults to 0.01<br>(within 1% of the optimal time)</td>
<td>0</td>
</tr>
<tr>
<td>max_iters</td>
<td>int</td>
<td>Maximum number of iterations for the free-final-time optimization. Defaults to 15.</td>
<td>15</td>
</tr>
<tr>
<td>debug</td>
<td>bool</td>
<td>Whether to print/plot details on the free-final-time optimization. Defaults to False.</td>
<td>False</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>BezierCurve</td>
<td>The optimal curve</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">free_final_time_bezier</span><span class="p">(</span>

<span class="w">    </span><span class="nl">p0</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">    </span><span class="nl">pf</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">    </span><span class="nl">t0</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="p">,</span>

<span class="w">    </span><span class="nl">tf_init</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="p">,</span>

<span class="w">    </span><span class="nl">n_control_pts</span><span class="p">:</span><span class="w"> </span><span class="nc">int</span><span class="p">,</span>

<span class="w">    </span><span class="nl">v0</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">npt.ArrayLike</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="nl">vf</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">npt.ArrayLike</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="nl">a0</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">npt.ArrayLike</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="nl">af</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">npt.ArrayLike</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="nl">box</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Box</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="nl">v_max</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">float</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="nl">a_max</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">float</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="nl">time_weight</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e-4</span><span class="p">,</span>

<span class="w">    </span><span class="nl">timing_rtol</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.01</span><span class="p">,</span>

<span class="w">    </span><span class="nl">max_iters</span><span class="p">:</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span>

<span class="w">    </span><span class="nl">debug</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">False</span><span class="p">,</span>

<span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">BezierCurve</span><span class="p">:</span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;Optimize a Bezier curve trajectory to balance minimizing jerk with minimizing the total duration</span>

<span class="ss">    Args:</span>

<span class="ss">        p0 (npt.ArrayLike): Initial position, shape (3,)</span>

<span class="ss">        pf (npt.ArrayLike): Final position, shape (3,)</span>

<span class="ss">        t0 (float): Starting time</span>

<span class="ss">        tf_init (float): Initial estimate of the final time</span>

<span class="ss">        n_control_pts (int): Number of control points for the Bezier curve. Must be &gt;= to the number of constraints,</span>

<span class="ss">            and should not be too large (&gt;15ish) as this can reduce optimization performance. 6-10 is usually good</span>

<span class="ss">        v0 (Optional[npt.ArrayLike]): Initial velocity, shape (3,). Defaults to None (unconstrained)</span>

<span class="ss">        vf (Optional[npt.ArrayLike]): Final velocity, shape (3,). Defaults to None (unconstrained)</span>

<span class="ss">        a0 (Optional[npt.ArrayLike]): Initial acceleration, shape (3,). Defaults to None (unconstrained)</span>

<span class="ss">        af (Optional[npt.ArrayLike]): Final acceleration, shape (3,). Defaults to None (unconstrained)</span>

<span class="ss">        box (Optional[Box]): Box constraint on (lower, upper) position bounds. Defaults to None (unconstrained)</span>

<span class="ss">        v_max (Optional[float]): Maximum L2 norm of the velocity. Defaults to None (unconstrained)</span>

<span class="ss">        a_max (Optional[float]): Maximum L2 norm of the acceleration. Defaults to None (unconstrained)</span>

<span class="ss">        time_weight (float, optional): Objective function weight corresponding to a linear penalty on the duration.</span>

<span class="ss">            Defaults to 1e-4. (this was observed to give duration roughly the same weighting as jerk)</span>

<span class="ss">        timing_rtol (float, optional): Tolerance on the free-final-time optimization. Defaults to 0.01</span>

<span class="ss">            (within 1% of the optimal time)</span>

<span class="ss">        max_iters (int, optional): Maximum number of iterations for the free-final-time optimization. Defaults to 15.</span>

<span class="ss">        debug (bool, optional): Whether to print/plot details on the free-final-time optimization. Defaults to False.</span>

<span class="ss">    Returns:</span>

<span class="ss">        BezierCurve: The optimal curve</span>

<span class="ss">    &quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">curve_kwargs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dict</span><span class="p">(</span>

<span class="w">        </span><span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span>

<span class="w">        </span><span class="n">pf</span><span class="o">=</span><span class="n">pf</span><span class="p">,</span>

<span class="w">        </span><span class="n">t0</span><span class="o">=</span><span class="n">t0</span><span class="p">,</span>

<span class="w">        </span><span class="n">tf</span><span class="o">=</span><span class="n">tf_init</span><span class="p">,</span>

<span class="w">        </span><span class="n">n_control_pts</span><span class="o">=</span><span class="n">n_control_pts</span><span class="p">,</span>

<span class="w">        </span><span class="n">v0</span><span class="o">=</span><span class="n">v0</span><span class="p">,</span>

<span class="w">        </span><span class="n">vf</span><span class="o">=</span><span class="n">vf</span><span class="p">,</span>

<span class="w">        </span><span class="n">a0</span><span class="o">=</span><span class="n">a0</span><span class="p">,</span>

<span class="w">        </span><span class="n">af</span><span class="o">=</span><span class="n">af</span><span class="p">,</span>

<span class="w">        </span><span class="n">box</span><span class="o">=</span><span class="n">box</span><span class="p">,</span>

<span class="w">        </span><span class="n">v_max</span><span class="o">=</span><span class="n">v_max</span><span class="p">,</span>

<span class="w">        </span><span class="n">a_max</span><span class="o">=</span><span class="n">a_max</span><span class="p">,</span>

<span class="w">        </span><span class="n">time_weight</span><span class="o">=</span><span class="n">time_weight</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nl">debug</span><span class="p">:</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Keep</span><span class="w"> </span><span class="n">track</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">costs</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="nc">time</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">plot</span><span class="w"> </span><span class="n">afterwards</span>

<span class="w">        </span><span class="nl">costs_log</span><span class="p">:</span><span class="w"> </span><span class="n">dict</span><span class="o">[</span><span class="n">float, float</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{}</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">Wrapper</span><span class="w"> </span><span class="n">around</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">bezier</span><span class="w"> </span><span class="n">trajectory</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">pop</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">quadratic</span><span class="w"> </span><span class="n">fit</span><span class="w"> </span><span class="k">search</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="k">method</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">expected</span><span class="w"> </span><span class="n">inputs</span><span class="o">/</span><span class="n">outputs</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">can</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">solve</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">curve</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span><span class="w"> </span><span class="nc">time</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">input</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">output</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">solved</span><span class="w"> </span><span class="n">curve</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">_curve_wrapper</span><span class="p">(</span><span class="nl">t</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">tuple</span><span class="o">[</span><span class="n">float, BezierCurve</span><span class="o">]</span><span class="err">:</span>

<span class="w">        </span><span class="n">kwargs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">curve_kwargs</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;tf&quot;</span><span class="err">:</span><span class="w"> </span><span class="n">t</span><span class="err">}</span>

<span class="w">        </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;Evaluating time: &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)</span>

<span class="w">        </span><span class="k">try</span><span class="err">:</span>

<span class="w">            </span><span class="n">curve</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bezier_trajectory</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="w">        </span><span class="ow">except</span><span class="w"> </span><span class="nl">OptimizationError</span><span class="p">:</span>

<span class="w">            </span><span class="n">curve</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">inf</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nl">debug</span><span class="p">:</span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="k">Print</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">breakdown</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="ow">between</span><span class="w"> </span><span class="n">jerk</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nc">time</span>

<span class="w">            </span><span class="k">print</span><span class="p">(</span>

<span class="w">                </span><span class="ss">&quot;Cost: &quot;</span><span class="p">,</span>

<span class="w">                </span><span class="n">cost</span><span class="p">,</span>

<span class="w">                </span><span class="ss">&quot; Jerk: &quot;</span><span class="p">,</span>

<span class="w">                </span><span class="n">cost</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">time_weight</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">,</span>

<span class="w">                </span><span class="ss">&quot; Time: &quot;</span><span class="p">,</span>

<span class="w">                </span><span class="n">time_weight</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">,</span>

<span class="w">            </span><span class="p">)</span>

<span class="w">            </span><span class="n">costs_log</span><span class="o">[</span><span class="n">t</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cost</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">quadratic</span><span class="w"> </span><span class="k">search</span><span class="w"> </span><span class="n">assumes</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">first</span><span class="w"> </span><span class="k">output</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">cost</span><span class="p">,</span><span class="w"> </span><span class="n">curve</span>

<span class="w">    </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="p">,</span><span class="w"> </span><span class="k">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">left_quadratic_fit_search</span><span class="p">(</span>

<span class="w">        </span><span class="n">_curve_wrapper</span><span class="p">,</span><span class="w"> </span><span class="n">tf_init</span><span class="p">,</span><span class="w"> </span><span class="n">timing_rtol</span><span class="p">,</span><span class="w"> </span><span class="n">max_iters</span>

<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="n">best_curve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">output</span><span class="o">[</span><span class="n">0</span><span class="o">]</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nl">debug</span><span class="p">:</span>

<span class="w">        </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;Optimal time: &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot; yields cost: &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="p">)</span>

<span class="w">        </span><span class="n">_plot_optimization_data</span><span class="p">(</span><span class="n">costs_log</span><span class="p">)</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">best_curve</span>
</code></pre></div>

</details>
<h3 id="free_final_time_spline">free_final_time_spline</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">free_final_time_spline</span><span class="p">(</span>
    <span class="n">p0</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">pf</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">t0</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">tf_init</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">pts_per_curve</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">boxes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">pyastrobee</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">boxes</span><span class="o">.</span><span class="n">Box</span><span class="p">],</span>
    <span class="n">initial_durations</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">v0</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">vf</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">a0</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">af</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">v_max</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">a_max</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">kappa_min</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="n">omega</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">max_retiming_iters</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">time_weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="p">,</span>
    <span class="n">timing_rtol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="n">max_iters</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pyastrobee</span><span class="o">.</span><span class="n">trajectories</span><span class="o">.</span><span class="n">splines</span><span class="o">.</span><span class="n">CompositeBezierCurve</span>
</code></pre></div>

<p>Optimize a spline trajectory to balance minimizing jerk with minimizing the total duration</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>p0</td>
<td>npt.ArrayLike</td>
<td>Initial position, shape (3,)</td>
<td>None</td>
</tr>
<tr>
<td>pf</td>
<td>npt.ArrayLike</td>
<td>Final position, shape (3,)</td>
<td>None</td>
</tr>
<tr>
<td>t0</td>
<td>float</td>
<td>Starting time</td>
<td>None</td>
</tr>
<tr>
<td>tf_init</td>
<td>float</td>
<td>Initial estimate of the final time</td>
<td>None</td>
</tr>
<tr>
<td>pts_per_curve</td>
<td>int</td>
<td>Number of control points per Bezier curve. Generally, should be around 6-10</td>
<td>None</td>
</tr>
<tr>
<td>boxes</td>
<td>list[Box]</td>
<td>Sequential list of safe box regions pass through</td>
<td>None</td>
</tr>
<tr>
<td>initial_durations</td>
<td>npt.ArrayLike</td>
<td>Initial estimate of the durations for each segment of the trajectory. These<br>will be refined during the retiming process. Shape (num_boxes,)</td>
<td>None</td>
</tr>
<tr>
<td>v0</td>
<td>Optional[npt.ArrayLike]</td>
<td>Initial velocity, shape (3,). Defaults to None (unconstrained)</td>
<td>None</td>
</tr>
<tr>
<td>vf</td>
<td>Optional[npt.ArrayLike]</td>
<td>Final velocity, shape (3,). Defaults to None (unconstrained)</td>
<td>None</td>
</tr>
<tr>
<td>a0</td>
<td>Optional[npt.ArrayLike]</td>
<td>Initial acceleration, shape (3,). Defaults to None (unconstrained)</td>
<td>None</td>
</tr>
<tr>
<td>af</td>
<td>Optional[npt.ArrayLike]</td>
<td>Final acceleration, shape (3,). Defaults to None (unconstrained)</td>
<td>None</td>
</tr>
<tr>
<td>v_max</td>
<td>Optional[float]</td>
<td>Maximum L2 norm of the velocity. Defaults to None (unconstrained)</td>
<td>None</td>
</tr>
<tr>
<td>a_max</td>
<td>Optional[float]</td>
<td>Maximum L2 norm of the acceleration. Defaults to None (unconstrained)</td>
<td>None</td>
</tr>
<tr>
<td>kappa_min</td>
<td>float</td>
<td>Retiming trust region parameter: Defines the maximum change in adjacent scaling<br>factors. Defaults to 1e-2.</td>
<td>None</td>
</tr>
<tr>
<td>omega</td>
<td>float</td>
<td>Retiming parameter: Defines the rate at which kappa decays after each iteration.<br>Must be &gt; 1. Small values (~2) work well when transition time estimates are poor, but larger values (~5)<br>are more effective otherwise. Defaults to 3.</td>
<td>None</td>
</tr>
<tr>
<td>max_retiming_iters</td>
<td>int</td>
<td>Maximum number of iterations for the retiming process. Defaults to 10.</td>
<td>10</td>
</tr>
<tr>
<td>time_weight</td>
<td>float</td>
<td>Objective function weight corresponding to a linear penalty on the duration.<br>Defaults to 1e-4 (this was observed to give duration roughly the same weighting as jerk)</td>
<td>None</td>
</tr>
<tr>
<td>timing_rtol</td>
<td>float</td>
<td>Tolerance on the free-final-time optimization. Defaults to 0.01<br>(within 1% of the optimal time)</td>
<td>0</td>
</tr>
<tr>
<td>max_iters</td>
<td>int</td>
<td>Maximum number of iterations for the free-final-time optimization. Defaults to 15.</td>
<td>15</td>
</tr>
<tr>
<td>debug</td>
<td>bool</td>
<td>Whether to print/plot details on the free-final-time optimization. Defaults to False.</td>
<td>False</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>CompositeBezierCurve</td>
<td>The optimal curve</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">free_final_time_spline</span><span class="p">(</span>

<span class="w">    </span><span class="nl">p0</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">    </span><span class="nl">pf</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">    </span><span class="nl">t0</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="p">,</span>

<span class="w">    </span><span class="nl">tf_init</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="p">,</span>

<span class="w">    </span><span class="nl">pts_per_curve</span><span class="p">:</span><span class="w"> </span><span class="nc">int</span><span class="p">,</span>

<span class="w">    </span><span class="nl">boxes</span><span class="p">:</span><span class="w"> </span><span class="n">list</span><span class="o">[</span><span class="n">Box</span><span class="o">]</span><span class="p">,</span>

<span class="w">    </span><span class="nl">initial_durations</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">    </span><span class="nl">v0</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">npt.ArrayLike</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="nl">vf</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">npt.ArrayLike</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="nl">a0</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">npt.ArrayLike</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="nl">af</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">npt.ArrayLike</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="nl">v_max</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">float</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="nl">a_max</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">float</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="nl">kappa_min</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e-2</span><span class="p">,</span>

<span class="w">    </span><span class="nl">omega</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>

<span class="w">    </span><span class="nl">max_retiming_iters</span><span class="p">:</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>

<span class="w">    </span><span class="nl">time_weight</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e-4</span><span class="p">,</span>

<span class="w">    </span><span class="nl">timing_rtol</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.01</span><span class="p">,</span>

<span class="w">    </span><span class="nl">max_iters</span><span class="p">:</span><span class="w"> </span><span class="nc">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span>

<span class="w">    </span><span class="nl">debug</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">False</span><span class="p">,</span>

<span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">CompositeBezierCurve</span><span class="p">:</span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;Optimize a spline trajectory to balance minimizing jerk with minimizing the total duration</span>

<span class="ss">    Args:</span>

<span class="ss">        p0 (npt.ArrayLike): Initial position, shape (3,)</span>

<span class="ss">        pf (npt.ArrayLike): Final position, shape (3,)</span>

<span class="ss">        t0 (float): Starting time</span>

<span class="ss">        tf_init (float): Initial estimate of the final time</span>

<span class="ss">        pts_per_curve (int): Number of control points per Bezier curve. Generally, should be around 6-10</span>

<span class="ss">        boxes (list[Box]): Sequential list of safe box regions pass through</span>

<span class="ss">        initial_durations (npt.ArrayLike): Initial estimate of the durations for each segment of the trajectory. These</span>

<span class="ss">            will be refined during the retiming process. Shape (num_boxes,)</span>

<span class="ss">        v0 (Optional[npt.ArrayLike]): Initial velocity, shape (3,). Defaults to None (unconstrained)</span>

<span class="ss">        vf (Optional[npt.ArrayLike]): Final velocity, shape (3,). Defaults to None (unconstrained)</span>

<span class="ss">        a0 (Optional[npt.ArrayLike]): Initial acceleration, shape (3,). Defaults to None (unconstrained)</span>

<span class="ss">        af (Optional[npt.ArrayLike]): Final acceleration, shape (3,). Defaults to None (unconstrained)</span>

<span class="ss">        v_max (Optional[float]): Maximum L2 norm of the velocity. Defaults to None (unconstrained)</span>

<span class="ss">        a_max (Optional[float]): Maximum L2 norm of the acceleration. Defaults to None (unconstrained)</span>

<span class="ss">        kappa_min (float, optional): Retiming trust region parameter: Defines the maximum change in adjacent scaling</span>

<span class="ss">            factors. Defaults to 1e-2.</span>

<span class="ss">        omega (float, optional): Retiming parameter: Defines the rate at which kappa decays after each iteration.</span>

<span class="ss">            Must be &gt; 1. Small values (~2) work well when transition time estimates are poor, but larger values (~5)</span>

<span class="ss">            are more effective otherwise. Defaults to 3.</span>

<span class="ss">        max_retiming_iters (int, optional): Maximum number of iterations for the retiming process. Defaults to 10.</span>

<span class="ss">        time_weight (float, optional): Objective function weight corresponding to a linear penalty on the duration.</span>

<span class="ss">            Defaults to 1e-4 (this was observed to give duration roughly the same weighting as jerk)</span>

<span class="ss">        timing_rtol (float, optional): Tolerance on the free-final-time optimization. Defaults to 0.01</span>

<span class="ss">            (within 1% of the optimal time)</span>

<span class="ss">        max_iters (int, optional): Maximum number of iterations for the free-final-time optimization. Defaults to 15.</span>

<span class="ss">        debug (bool, optional): Whether to print/plot details on the free-final-time optimization. Defaults to False.</span>

<span class="ss">    Returns:</span>

<span class="ss">        CompositeBezierCurve: The optimal curve</span>

<span class="ss">    &quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">curve_kwargs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dict</span><span class="p">(</span>

<span class="w">        </span><span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span>

<span class="w">        </span><span class="n">pf</span><span class="o">=</span><span class="n">pf</span><span class="p">,</span>

<span class="w">        </span><span class="n">t0</span><span class="o">=</span><span class="n">t0</span><span class="p">,</span>

<span class="w">        </span><span class="n">tf</span><span class="o">=</span><span class="n">tf_init</span><span class="p">,</span>

<span class="w">        </span><span class="n">pts_per_curve</span><span class="o">=</span><span class="n">pts_per_curve</span><span class="p">,</span>

<span class="w">        </span><span class="n">boxes</span><span class="o">=</span><span class="n">boxes</span><span class="p">,</span>

<span class="w">        </span><span class="n">initial_durations</span><span class="o">=</span><span class="n">initial_durations</span><span class="p">,</span>

<span class="w">        </span><span class="n">v0</span><span class="o">=</span><span class="n">v0</span><span class="p">,</span>

<span class="w">        </span><span class="n">vf</span><span class="o">=</span><span class="n">vf</span><span class="p">,</span>

<span class="w">        </span><span class="n">a0</span><span class="o">=</span><span class="n">a0</span><span class="p">,</span>

<span class="w">        </span><span class="n">af</span><span class="o">=</span><span class="n">af</span><span class="p">,</span>

<span class="w">        </span><span class="n">v_max</span><span class="o">=</span><span class="n">v_max</span><span class="p">,</span>

<span class="w">        </span><span class="n">a_max</span><span class="o">=</span><span class="n">a_max</span><span class="p">,</span>

<span class="w">        </span><span class="n">kappa_min</span><span class="o">=</span><span class="n">kappa_min</span><span class="p">,</span>

<span class="w">        </span><span class="n">omega</span><span class="o">=</span><span class="n">omega</span><span class="p">,</span>

<span class="w">        </span><span class="n">max_retiming_iters</span><span class="o">=</span><span class="n">max_retiming_iters</span><span class="p">,</span>

<span class="w">        </span><span class="n">time_weight</span><span class="o">=</span><span class="n">time_weight</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="k">As</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">vary</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">final</span><span class="w"> </span><span class="nc">time</span><span class="p">,</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">sure</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">durations</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">box</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="n">updated</span><span class="p">.</span><span class="w"> </span><span class="n">So</span><span class="p">,</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">fractional</span><span class="w"> </span><span class="n">durations</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">rescale</span><span class="w"> </span><span class="n">based</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="nc">time</span>

<span class="w">    </span><span class="n">duration_fractions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">initial_durations</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">tf_init</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t0</span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nl">debug</span><span class="p">:</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Keep</span><span class="w"> </span><span class="n">track</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">costs</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="nc">time</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">plot</span><span class="w"> </span><span class="n">afterwards</span>

<span class="w">        </span><span class="nl">costs_log</span><span class="p">:</span><span class="w"> </span><span class="n">dict</span><span class="o">[</span><span class="n">float, float</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{}</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">Wrapper</span><span class="w"> </span><span class="n">around</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">spline</span><span class="w"> </span><span class="n">trajectory</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">pop</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">quadratic</span><span class="w"> </span><span class="n">fit</span><span class="w"> </span><span class="k">search</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="k">method</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">expected</span><span class="w"> </span><span class="n">inputs</span><span class="o">/</span><span class="n">outputs</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">can</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">solve</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">curve</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span><span class="w"> </span><span class="nc">time</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">input</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">output</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">solved</span><span class="w"> </span><span class="n">curve</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">_curve_wrapper</span><span class="p">(</span><span class="nl">t</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">tuple</span><span class="o">[</span><span class="n">float, CompositeBezierCurve</span><span class="o">]</span><span class="err">:</span>

<span class="w">        </span><span class="n">nonlocal</span><span class="w"> </span><span class="n">duration_fractions</span>

<span class="w">        </span><span class="n">kwargs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">curve_kwargs</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">{</span>

<span class="w">            </span><span class="ss">&quot;tf&quot;</span><span class="err">:</span><span class="w"> </span><span class="n">t</span><span class="p">,</span>

<span class="w">            </span><span class="ss">&quot;initial_durations&quot;</span><span class="err">:</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">duration_fractions</span><span class="p">,</span>

<span class="w">        </span><span class="err">}</span>

<span class="w">        </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;Evaluating duration: &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)</span>

<span class="w">        </span><span class="k">try</span><span class="err">:</span>

<span class="w">            </span><span class="n">curve</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spline_trajectory_with_retiming</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="k">Update</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">understanding</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">best</span><span class="w"> </span><span class="n">curve</span><span class="w"> </span><span class="n">durations</span><span class="w"> </span><span class="n">based</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">retiming</span><span class="w"> </span><span class="n">process</span>

<span class="w">            </span><span class="n">duration_fractions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">curve</span><span class="p">.</span><span class="n">segment_durations</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">curve</span><span class="p">.</span><span class="n">duration</span>

<span class="w">        </span><span class="ow">except</span><span class="w"> </span><span class="nl">OptimizationError</span><span class="p">:</span>

<span class="w">            </span><span class="n">curve</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">inf</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nl">debug</span><span class="p">:</span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="k">Print</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">breakdown</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="ow">between</span><span class="w"> </span><span class="n">jerk</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nc">time</span>

<span class="w">            </span><span class="k">print</span><span class="p">(</span>

<span class="w">                </span><span class="ss">&quot;Cost: &quot;</span><span class="p">,</span>

<span class="w">                </span><span class="n">cost</span><span class="p">,</span>

<span class="w">                </span><span class="ss">&quot; Jerk: &quot;</span><span class="p">,</span>

<span class="w">                </span><span class="n">cost</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">time_weight</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">,</span>

<span class="w">                </span><span class="ss">&quot; Time: &quot;</span><span class="p">,</span>

<span class="w">                </span><span class="n">time_weight</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="p">,</span>

<span class="w">            </span><span class="p">)</span>

<span class="w">            </span><span class="n">costs_log</span><span class="o">[</span><span class="n">t</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cost</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">quadratic</span><span class="w"> </span><span class="k">search</span><span class="w"> </span><span class="n">assumes</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">first</span><span class="w"> </span><span class="k">output</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">cost</span><span class="p">,</span><span class="w"> </span><span class="n">curve</span>

<span class="w">    </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="p">,</span><span class="w"> </span><span class="k">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">left_quadratic_fit_search</span><span class="p">(</span>

<span class="w">        </span><span class="n">_curve_wrapper</span><span class="p">,</span><span class="w"> </span><span class="n">tf_init</span><span class="p">,</span><span class="w"> </span><span class="n">timing_rtol</span><span class="p">,</span><span class="w"> </span><span class="n">max_iters</span>

<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="n">best_curve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">output</span><span class="o">[</span><span class="n">0</span><span class="o">]</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nl">debug</span><span class="p">:</span>

<span class="w">        </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;Optimal time: &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot; yields cost: &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cost</span><span class="p">)</span>

<span class="w">        </span><span class="n">_plot_optimization_data</span><span class="p">(</span><span class="n">costs_log</span><span class="p">)</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">best_curve</span>
</code></pre></div>

</details>
<h3 id="left_quadratic_fit_search">left_quadratic_fit_search</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">left_quadratic_fit_search</span><span class="p">(</span>
    <span class="n">f</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
    <span class="n">x_init</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">dx_tol</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">max_iters</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span>
</code></pre></div>

<p>A modified version of quadratic fit search that assumes we have an infeasible region for small x (x &gt;= 0)</p>
<p>See Algorithms for Optimization (Kochenderfer), Algorithm 3.4 for quadratic fit search</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>f</td>
<td>Callable[[float], float</td>
<td>tuple[float, Any]]</td>
<td>Univariate function to optimize, callable as f(x).<br>The return must have the cost of the evaluation as the first output. Any additional outputs will be stored<br>and the best will be returned at the end of the search</td>
</tr>
<tr>
<td>x_init</td>
<td>float</td>
<td>Initial location to start the search</td>
<td>None</td>
</tr>
<tr>
<td>dx_tol</td>
<td>float</td>
<td>Stopping tolerance on evaluation points: Terminate if the percent change between consecutive<br>evaluation points is less than this tolerance</td>
<td>None</td>
</tr>
<tr>
<td>max_iters</td>
<td>int</td>
<td>Maximum iterations of the algorithm (if the stopping tolerance is not achieved)</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>tuple[float, float, list[Any]]</td>
<td>float: Best evaluation point x<br>float: Cost of the function evaluation at the best x value<br>list[Any]: Additional outputs of the function being optimized at the best x value. Empty list if there<br>    are no additional outputs</td>
</tr>
</tbody>
</table>
<p><strong>Raises:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>OptimizationError</td>
<td>If no feasible solution is found in max_iters iterations</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">left_quadratic_fit_search</span><span class="p">(</span>

<span class="w">    </span><span class="nl">f</span><span class="p">:</span><span class="w"> </span><span class="n">Callable</span><span class="o">[</span><span class="n">[float</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="nc">float</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">tuple</span><span class="o">[</span><span class="n">float, Any</span><span class="o">]</span><span class="err">]</span><span class="p">,</span>

<span class="w">    </span><span class="nl">x_init</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="p">,</span>

<span class="w">    </span><span class="nl">dx_tol</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="p">,</span>

<span class="w">    </span><span class="nl">max_iters</span><span class="p">:</span><span class="w"> </span><span class="nc">int</span><span class="p">,</span>

<span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">tuple</span><span class="o">[</span><span class="n">float, float, list[Any</span><span class="o">]</span><span class="err">]:</span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;A modified version of quadratic fit search that assumes we have an infeasible region for small x (x &gt;= 0)</span>

<span class="ss">    See Algorithms for Optimization (Kochenderfer), Algorithm 3.4 for quadratic fit search</span>

<span class="ss">    Args:</span>

<span class="ss">        f (Callable[[float], float  |  tuple[float, Any]]): Univariate function to optimize, callable as f(x).</span>

<span class="ss">            The return must have the cost of the evaluation as the first output. Any additional outputs will be stored</span>

<span class="ss">            and the best will be returned at the end of the search</span>

<span class="ss">        x_init (float): Initial location to start the search</span>

<span class="ss">        dx_tol (float): Stopping tolerance on evaluation points: Terminate if the percent change between consecutive</span>

<span class="ss">            evaluation points is less than this tolerance</span>

<span class="ss">        max_iters (int): Maximum iterations of the algorithm (if the stopping tolerance is not achieved)</span>

<span class="ss">    Raises:</span>

<span class="ss">        OptimizationError: If no feasible solution is found in max_iters iterations</span>

<span class="ss">    Returns:</span>

<span class="ss">        tuple[float, float, list[Any]]:</span>

<span class="ss">            float: Best evaluation point x</span>

<span class="ss">            float: Cost of the function evaluation at the best x value</span>

<span class="ss">            list[Any]: Additional outputs of the function being optimized at the best x value. Empty list if there</span>

<span class="ss">                are no additional outputs</span>

<span class="ss">    &quot;&quot;&quot;</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">Mutable</span><span class="w"> </span><span class="n">dicts</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">keep</span><span class="w"> </span><span class="n">track</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">optimization</span><span class="w"> </span><span class="n">process</span>

<span class="w">    </span><span class="n">best</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;x&quot;</span><span class="err">:</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;cost&quot;</span><span class="err">:</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">inf</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;out&quot;</span><span class="err">:</span><span class="w"> </span><span class="err">[]}</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">init</span>

<span class="w">    </span><span class="nf">log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">{</span><span class="ss">&quot;iters&quot;</span><span class="err">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;feasibility_bound&quot;</span><span class="err">:</span><span class="w"> </span><span class="mi">0</span><span class="err">}</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">init</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="k">Create</span><span class="w"> </span><span class="n">wrapper</span><span class="w"> </span><span class="n">around</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">outputs</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="k">Return</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">solely</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">evaluation</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">outputs</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">dictionaries</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">needed</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">_f</span><span class="p">(</span><span class="nl">x</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">float</span><span class="err">:</span>

<span class="w">        </span><span class="n">fx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="w">        </span><span class="nf">log</span><span class="o">[</span><span class="n">&quot;iters&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">fx</span><span class="p">,</span><span class="w"> </span><span class="n">tuple</span><span class="p">)</span><span class="err">:</span>

<span class="w">            </span><span class="n">cost</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="k">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fx</span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="k">Out</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">packed</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">list</span>

<span class="w">        </span><span class="k">else</span><span class="err">:</span>

<span class="w">            </span><span class="n">cost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fx</span>

<span class="w">            </span><span class="k">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">[]</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">Check</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">best</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">far</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">so</span><span class="p">,</span><span class="w"> </span><span class="k">update</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">best</span><span class="o">[</span><span class="n">&quot;cost&quot;</span><span class="o">]</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="nl">inf</span><span class="p">:</span>

<span class="w">            </span><span class="n">best</span><span class="o">[</span><span class="n">&quot;x&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span>

<span class="w">            </span><span class="n">best</span><span class="o">[</span><span class="n">&quot;cost&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cost</span>

<span class="w">            </span><span class="n">best</span><span class="o">[</span><span class="n">&quot;out&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">out</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">cost</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">Find</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">quadratic</span><span class="w"> </span><span class="n">fit</span><span class="w"> </span><span class="k">search</span><span class="w"> </span><span class="k">interval</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="n">given</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="k">search</span><span class="w"> </span><span class="n">location</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">assumes</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">positive</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">infeasible</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="n">occurs</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">too</span><span class="w"> </span><span class="n">small</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">_find_init_interval_from_guess</span><span class="p">(</span><span class="nl">x</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="p">)</span><span class="err">:</span>

<span class="w">        </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span>

<span class="w">        </span><span class="n">yb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_f</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">yb</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="nl">inf</span><span class="p">:</span>

<span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="n">yb</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">inf</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nf">log</span><span class="o">[</span><span class="n">&quot;iters&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">max_iters</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="err">:</span>

<span class="w">                </span><span class="nf">log</span><span class="o">[</span><span class="n">&quot;feasibility_bound&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="nf">log</span><span class="o">[</span><span class="n">&quot;feasibility_bound&quot;</span><span class="o">]</span><span class="p">)</span>

<span class="w">                </span><span class="n">b</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mi">2</span>

<span class="w">                </span><span class="n">yb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_f</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

<span class="w">        </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nf">log</span><span class="o">[</span><span class="n">&quot;feasibility_bound&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span>

<span class="w">        </span><span class="n">ya</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_f</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">ya</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="nl">inf</span><span class="p">:</span>

<span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="n">ya</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">inf</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nf">log</span><span class="o">[</span><span class="n">&quot;iters&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">max_iters</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="err">:</span>

<span class="w">                </span><span class="nf">log</span><span class="o">[</span><span class="n">&quot;feasibility_bound&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="nf">log</span><span class="o">[</span><span class="n">&quot;feasibility_bound&quot;</span><span class="o">]</span><span class="p">)</span>

<span class="w">                </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span>

<span class="w">                </span><span class="n">ya</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_f</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">know</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">valid</span>

<span class="w">        </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">a</span><span class="p">)</span>

<span class="w">        </span><span class="n">yc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_f</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">ya</span><span class="p">,</span><span class="w"> </span><span class="n">yb</span><span class="p">,</span><span class="w"> </span><span class="n">yc</span>

<span class="w">    </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">ya</span><span class="p">,</span><span class="w"> </span><span class="n">yb</span><span class="p">,</span><span class="w"> </span><span class="n">yc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_find_init_interval_from_guess</span><span class="p">(</span><span class="n">x_init</span><span class="p">)</span>

<span class="w">    </span><span class="n">x_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">init</span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="nf">log</span><span class="o">[</span><span class="n">&quot;iters&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">max_iters</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="err">:</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Quadratic</span><span class="w"> </span><span class="n">fit</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="k">search</span><span class="w"> </span><span class="n">location</span>

<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span>

<span class="w">            </span><span class="mf">0.5</span>

<span class="w">            </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">ya</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">yb</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">yc</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

<span class="w">            </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">ya</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">yb</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">yc</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">b</span><span class="p">))</span>

<span class="w">        </span><span class="p">)</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Handle</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">fit</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">known</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">infeasible</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nf">log</span><span class="o">[</span><span class="n">&quot;feasibility_bound&quot;</span><span class="o">]</span><span class="err">:</span>

<span class="w">            </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nf">log</span><span class="o">[</span><span class="n">&quot;feasibility_bound&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span>

<span class="w">        </span><span class="n">yx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">yx</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="nl">inf</span><span class="p">:</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">Infeasible</span>

<span class="w">            </span><span class="nf">log</span><span class="o">[</span><span class="n">&quot;feasibility_bound&quot;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="nf">log</span><span class="o">[</span><span class="n">&quot;feasibility_bound&quot;</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>

<span class="w">        </span><span class="k">else</span><span class="err">:</span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="n">Standard</span><span class="w"> </span><span class="n">quadratic</span><span class="w"> </span><span class="n">fit</span><span class="w"> </span><span class="k">update</span><span class="p">,</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">extra</span><span class="w"> </span><span class="n">cases</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ow">between</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">c</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nl">a</span><span class="p">:</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">yx</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nl">ya</span><span class="p">:</span>

<span class="w">                    </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">ya</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">yx</span>

<span class="w">            </span><span class="n">elif</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nl">c</span><span class="p">:</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nl">b</span><span class="p">:</span>

<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="n">yx</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nl">yb</span><span class="p">:</span>

<span class="w">                        </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">yc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">yx</span>

<span class="w">                    </span><span class="k">else</span><span class="err">:</span>

<span class="w">                        </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">ya</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">yb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">yb</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">yx</span>

<span class="w">                </span><span class="n">elif</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nl">b</span><span class="p">:</span>

<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="n">yx</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nl">yb</span><span class="p">:</span>

<span class="w">                        </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">ya</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">yx</span>

<span class="w">                    </span><span class="k">else</span><span class="err">:</span>

<span class="w">                        </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">yc</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">yb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">yb</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">yx</span>

<span class="w">            </span><span class="k">else</span><span class="err">:</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">c</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">yx</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nl">yc</span><span class="p">:</span>

<span class="w">                    </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">yc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">yx</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Termination</span><span class="w"> </span><span class="nl">criteria</span><span class="p">:</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">evaluation</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="k">update</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">shrunk</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">within</span><span class="w"> </span><span class="ow">some</span><span class="w"> </span><span class="n">tolerance</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">x_prev</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nf">abs</span><span class="p">((</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x_prev</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">x_prev</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nl">dx_tol</span><span class="p">:</span>

<span class="w">            </span><span class="k">break</span>

<span class="w">        </span><span class="n">x_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">best</span><span class="o">[</span><span class="n">&quot;x&quot;</span><span class="o">]</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">        </span><span class="n">raise</span><span class="w"> </span><span class="n">OptimizationError</span><span class="p">(</span><span class="ss">&quot;Unable to find a feasible solution&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">best</span><span class="o">[</span><span class="n">&quot;x&quot;</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">best</span><span class="o">[</span><span class="n">&quot;cost&quot;</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">best</span><span class="o">[</span><span class="n">&quot;out&quot;</span><span class="o">]</span>
</code></pre></div>

</details>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        
<footer class="md-footer">
    
      <nav class="md-footer__inner md-grid" aria-label="Footer">
        
          
          <a href="../trajectory/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Trajectory" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Previous
                </span>
                Trajectory
              </div>
            </div>
          </a>
        
        
          
          <a href="../../utils/algos/" class="md-footer__link md-footer__link--next" aria-label="Next: Algos" rel="next">
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Next
                </span>
                Algos
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
            
            Powered by
            <a href="http://timothycrosley.github.io/portray">portray.</a>
            You too can
            <a href="http://timothycrosley.github.io/portray">
              portray</a>
            your Python project well using automatic documentation.
          </div>
        
      </div>
    </div>
  </footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": [], "search": "../../../../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.078830c0.min.js"></script>
      
    
  </body>
</html>