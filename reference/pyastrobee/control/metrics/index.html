
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.5.4">
    
    
      
        <title>Metrics - pyastrobee</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.80dcb947.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#546d78">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue-grey" data-md-color-accent="pink">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#module-pyastrobeecontrolmetrics" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="pyastrobee" class="md-header__button md-logo" aria-label="pyastrobee" data-md-component="logo">
      
  <img src="../../../../images/favicon_large.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            pyastrobee
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Metrics
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/danielpmorton/pyastrobee" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    pyastrobee
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="pyastrobee" class="md-nav__button md-logo" aria-label="pyastrobee" data-md-component="logo">
      
  <img src="../../../../images/favicon_large.png" alt="logo">

    </a>
    pyastrobee
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/danielpmorton/pyastrobee" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    pyastrobee
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/additional_installs/" class="md-nav__link">
        Additional Installs
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/bag_dynamics/" class="md-nav__link">
        Bag Dynamics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/getting_started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/loading_iss_meshes/" class="md-nav__link">
        Loading Iss Meshes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/meshing/" class="md-nav__link">
        Meshing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/nasa_sim/" class="md-nav__link">
        Nasa Sim
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/pybullet_tips/" class="md-nav__link">
        Pybullet Tips
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/references/" class="md-nav__link">
        References
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/retexturing/" class="md-nav__link">
        Retexturing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/testing/" class="md-nav__link">
        Testing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/tet_meshing/" class="md-nav__link">
        Tet Meshing
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13" type="checkbox" id="__nav_13" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_13">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_13">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13_1" type="checkbox" id="__nav_13_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_13_1">
          Pyastrobee
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Pyastrobee" data-md-level="2">
        <label class="md-nav__title" for="__nav_13_1">
          <span class="md-nav__icon md-icon"></span>
          Pyastrobee
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13_1_2" type="checkbox" id="__nav_13_1_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_13_1_2">
          Config
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Config" data-md-level="3">
        <label class="md-nav__title" for="__nav_13_1_2">
          <span class="md-nav__icon md-icon"></span>
          Config
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../config/astrobee_geom/" class="md-nav__link">
        Astrobee Geom
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../config/astrobee_motion/" class="md-nav__link">
        Astrobee Motion
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../config/astrobee_transforms/" class="md-nav__link">
        Astrobee Transforms
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../config/bag_properties/" class="md-nav__link">
        Bag Properties
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../config/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../config/iss_paths/" class="md-nav__link">
        Iss Paths
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../config/iss_safe_boxes/" class="md-nav__link">
        Iss Safe Boxes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13_1_3" type="checkbox" id="__nav_13_1_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_13_1_3">
          Control
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Control" data-md-level="3">
        <label class="md-nav__title" for="__nav_13_1_3">
          <span class="md-nav__icon md-icon"></span>
          Control
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../constraint_controller/" class="md-nav__link">
        Constraint Controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../force_torque_control/" class="md-nav__link">
        Force Torque Control
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../keyboard_controller/" class="md-nav__link">
        Keyboard Controller
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Metrics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Metrics
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#integrated_safe_set_cost" class="md-nav__link">
    integrated_safe_set_cost
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#robot_and_bag_termination_criteria" class="md-nav__link">
    robot_and_bag_termination_criteria
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safe_set_cost" class="md-nav__link">
    safe_set_cost
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#state_tracking_cost" class="md-nav__link">
    state_tracking_cost
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#traj_tracking_cost" class="md-nav__link">
    traj_tracking_cost
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../multi_robot/" class="md-nav__link">
        Multi Robot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sampling_mpc/" class="md-nav__link">
        Sampling Mpc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sampling_mpc_multithreaded/" class="md-nav__link">
        Sampling Mpc Multithreaded
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13_1_4" type="checkbox" id="__nav_13_1_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_13_1_4">
          Core
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Core" data-md-level="3">
        <label class="md-nav__title" for="__nav_13_1_4">
          <span class="md-nav__icon md-icon"></span>
          Core
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/abstract_bag/" class="md-nav__link">
        Abstract Bag
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/astrobee/" class="md-nav__link">
        Astrobee
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/composite_bag/" class="md-nav__link">
        Composite Bag
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/constraint_bag/" class="md-nav__link">
        Constraint Bag
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/deformable_bag/" class="md-nav__link">
        Deformable Bag
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/environments/" class="md-nav__link">
        Environments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/hybrid_bag/" class="md-nav__link">
        Hybrid Bag
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/iss/" class="md-nav__link">
        Iss
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/rigid_bag/" class="md-nav__link">
        Rigid Bag
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13_1_5" type="checkbox" id="__nav_13_1_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_13_1_5">
          Trajectories
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Trajectories" data-md-level="3">
        <label class="md-nav__title" for="__nav_13_1_5">
          <span class="md-nav__icon md-icon"></span>
          Trajectories
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/arm_planner/" class="md-nav__link">
        Arm Planner
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/bezier/" class="md-nav__link">
        Bezier
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/bezier_slerp/" class="md-nav__link">
        Bezier Slerp
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/box_paths/" class="md-nav__link">
        Box Paths
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/curve_utils/" class="md-nav__link">
        Curve Utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/decasteljau_slerp/" class="md-nav__link">
        Decasteljau Slerp
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/face_forward/" class="md-nav__link">
        Face Forward
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/multi_robot_trajs/" class="md-nav__link">
        Multi Robot Trajs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/planner/" class="md-nav__link">
        Planner
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/polynomials/" class="md-nav__link">
        Polynomials
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/quaternion_interpolation/" class="md-nav__link">
        Quaternion Interpolation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/sampling/" class="md-nav__link">
        Sampling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/simple_trajectories/" class="md-nav__link">
        Simple Trajectories
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/splines/" class="md-nav__link">
        Splines
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/timing/" class="md-nav__link">
        Timing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/trajectory/" class="md-nav__link">
        Trajectory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/variable_time_curves/" class="md-nav__link">
        Variable Time Curves
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13_1_6" type="checkbox" id="__nav_13_1_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_13_1_6">
          Utils
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Utils" data-md-level="3">
        <label class="md-nav__title" for="__nav_13_1_6">
          <span class="md-nav__icon md-icon"></span>
          Utils
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/algos/" class="md-nav__link">
        Algos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/bag_frame/" class="md-nav__link">
        Bag Frame
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/boxes/" class="md-nav__link">
        Boxes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/bullet_utils/" class="md-nav__link">
        Bullet Utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/debug_visualizer/" class="md-nav__link">
        Debug Visualizer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/dynamics/" class="md-nav__link">
        Dynamics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/errors/" class="md-nav__link">
        Errors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/math_utils/" class="md-nav__link">
        Math Utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/mesh_utils/" class="md-nav__link">
        Mesh Utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/poses/" class="md-nav__link">
        Poses
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/python_utils/" class="md-nav__link">
        Python Utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/quaternion_derivatives/" class="md-nav__link">
        Quaternion Derivatives
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/quaternions/" class="md-nav__link">
        Quaternions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/rotations/" class="md-nav__link">
        Rotations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/transformations/" class="md-nav__link">
        Transformations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/video_concatenation/" class="md-nav__link">
        Video Concatenation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#integrated_safe_set_cost" class="md-nav__link">
    integrated_safe_set_cost
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#robot_and_bag_termination_criteria" class="md-nav__link">
    robot_and_bag_termination_criteria
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#safe_set_cost" class="md-nav__link">
    safe_set_cost
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#state_tracking_cost" class="md-nav__link">
    state_tracking_cost
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#traj_tracking_cost" class="md-nav__link">
    traj_tracking_cost
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/danielpmorton/pyastrobee/edit/main/reference/pyastrobee/control/metrics.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="module-pyastrobeecontrolmetrics">Module pyastrobee.control.metrics</h1>
<p>Simple metrics / cost functions: For defining how well we track trajectories, remain in collision-free regions, ...</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="sd">&quot;&quot;&quot;Simple metrics / cost functions: For defining how well we track trajectories, remain in collision-free regions, ...&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span><span class="w"> </span><span class="n">Union</span><span class="p">,</span><span class="w"> </span><span class="n">Optional</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy.typing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">npt</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span><span class="w"> </span><span class="n">colors</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pyastrobee.utils.boxes</span><span class="w"> </span><span class="kn">import</span><span class="w"> </span><span class="n">Box</span><span class="p">,</span><span class="w"> </span><span class="n">plot_2D_box</span><span class="p">,</span><span class="w"> </span><span class="n">is_in_box</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pyastrobee.trajectories.trajectory</span><span class="w"> </span><span class="kn">import</span><span class="w"> </span><span class="n">Trajectory</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pyastrobee.utils.quaternions</span><span class="w"> </span><span class="kn">import</span><span class="w"> </span><span class="n">quaternion_angular_error</span><span class="p">,</span><span class="w"> </span><span class="n">quaternion_dist</span>

<span class="k">def</span><span class="w"> </span><span class="nf">state_tracking_cost</span><span class="p">(</span>

<span class="w">    </span><span class="n">cur_pos</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">    </span><span class="n">cur_orn</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">    </span><span class="n">cur_vel</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">    </span><span class="n">cur_ang_vel</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">    </span><span class="n">des_pos</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">    </span><span class="n">des_orn</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">    </span><span class="n">des_vel</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">    </span><span class="n">des_ang_vel</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">    </span><span class="n">pos_penalty</span><span class="p">:</span><span class="w"> </span><span class="nb">float</span><span class="p">,</span>

<span class="w">    </span><span class="n">orn_penalty</span><span class="p">:</span><span class="w"> </span><span class="nb">float</span><span class="p">,</span>

<span class="w">    </span><span class="n">vel_penalty</span><span class="p">:</span><span class="w"> </span><span class="nb">float</span><span class="p">,</span>

<span class="w">    </span><span class="n">ang_vel_penalty</span><span class="p">:</span><span class="w"> </span><span class="nb">float</span><span class="p">,</span>

<span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nb">float</span><span class="p">:</span>

<span class="w">    </span><span class="s2">&quot;&quot;&quot;Evaluate a cost function for deviations between the current and desired dynamics state</span>

<span class="s2">    Args:</span>

<span class="s2">        cur_pos (npt.ArrayLike): Current position, shape (3,)</span>

<span class="s2">        cur_orn (npt.ArrayLike): Current XYZW quaternion orientation, shape (4,)</span>

<span class="s2">        cur_vel (npt.ArrayLike): Current linear velocity, shape (3,)</span>

<span class="s2">        cur_ang_vel (npt.ArrayLike): Current angular velocity, shape (3,)</span>

<span class="s2">        des_pos (npt.ArrayLike): Desired position, shape (3,)</span>

<span class="s2">        des_orn (npt.ArrayLike): Desired XYZW quaternion orientation, shape (4,)</span>

<span class="s2">        des_vel (npt.ArrayLike): Desired linear velocity, shape (3,)</span>

<span class="s2">        des_ang_vel (npt.ArrayLike): Desired angular velocity, shape (3,)</span>

<span class="s2">        pos_penalty (float): Penalty scaling factor for position error</span>

<span class="s2">        orn_penalty (float): Penalty scaling factor for orientation/angular error</span>

<span class="s2">        vel_penalty (float): Penalty scaling factor for linear velocity error</span>

<span class="s2">        ang_vel_penalty (float): Penalty scaling factor for angular velocity error</span>

<span class="s2">    Returns:</span>

<span class="s2">        float: Cost function evaluation</span>

<span class="s2">    &quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">pos_err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">cur_pos</span><span class="p">,</span><span class="w"> </span><span class="n">des_pos</span><span class="p">)</span>

<span class="w">    </span><span class="n">orn_err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">quaternion_angular_error</span><span class="p">(</span><span class="n">cur_orn</span><span class="p">,</span><span class="w"> </span><span class="n">des_orn</span><span class="p">)</span>

<span class="w">    </span><span class="n">vel_err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">cur_vel</span><span class="p">,</span><span class="w"> </span><span class="n">des_vel</span><span class="p">)</span>

<span class="w">    </span><span class="n">ang_vel_err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">cur_ang_vel</span><span class="p">,</span><span class="w"> </span><span class="n">des_ang_vel</span><span class="p">)</span>

<span class="w">    </span><span class="c1"># NOTE Would an L1 norm be better here?</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>

<span class="w">        </span><span class="n">pos_penalty</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">pos_err</span><span class="p">)</span>

<span class="w">        </span><span class="o">+</span><span class="w"> </span><span class="n">orn_penalty</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">orn_err</span><span class="p">)</span>

<span class="w">        </span><span class="o">+</span><span class="w"> </span><span class="n">vel_penalty</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vel_err</span><span class="p">)</span>

<span class="w">        </span><span class="o">+</span><span class="w"> </span><span class="n">ang_vel_penalty</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">ang_vel_err</span><span class="p">)</span>

<span class="w">    </span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">traj_tracking_cost</span><span class="p">(</span>

<span class="w">    </span><span class="n">des_traj</span><span class="p">:</span><span class="w"> </span><span class="n">Trajectory</span><span class="p">,</span>

<span class="w">    </span><span class="n">recorded_traj</span><span class="p">:</span><span class="w"> </span><span class="n">Trajectory</span><span class="p">,</span>

<span class="w">    </span><span class="n">pos_penalty</span><span class="p">:</span><span class="w"> </span><span class="nb">float</span><span class="p">,</span>

<span class="w">    </span><span class="n">orn_penalty</span><span class="p">:</span><span class="w"> </span><span class="nb">float</span><span class="p">,</span>

<span class="w">    </span><span class="n">vel_penalty</span><span class="p">:</span><span class="w"> </span><span class="nb">float</span><span class="p">,</span>

<span class="w">    </span><span class="n">ang_vel_penalty</span><span class="p">:</span><span class="w"> </span><span class="nb">float</span><span class="p">,</span>

<span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nb">float</span><span class="p">:</span>

<span class="w">    </span><span class="s2">&quot;&quot;&quot;Evaluates a state mismatch cost function over the duration of a trajectory</span>

<span class="s2">    Args:</span>

<span class="s2">        des_traj (Trajectory): Desired trajectory</span>

<span class="s2">        recorded_traj (Trajectory): Recorded trajectory</span>

<span class="s2">        pos_penalty (float): Penalty scaling factor for position error</span>

<span class="s2">        orn_penalty (float): Penalty scaling factor for orientation/angular error</span>

<span class="s2">        vel_penalty (float): Penalty scaling factor for linear velocity error</span>

<span class="s2">        ang_vel_penalty (float): Penalty scaling factor for angular velocity error</span>

<span class="s2">    Returns:</span>

<span class="s2">        float: Cost function evaluation</span>

<span class="s2">    &quot;&quot;&quot;</span>

<span class="w">    </span><span class="k">assert</span><span class="w"> </span><span class="n">recorded_traj</span><span class="o">.</span><span class="n">num_timesteps</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">des_traj</span><span class="o">.</span><span class="n">num_timesteps</span>

<span class="w">    </span><span class="n">total_cost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">range</span><span class="p">(</span><span class="n">recorded_traj</span><span class="o">.</span><span class="n">num_timesteps</span><span class="p">):</span>

<span class="w">        </span><span class="n">total_cost</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">state_tracking_cost</span><span class="p">(</span>

<span class="w">            </span><span class="n">recorded_traj</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>

<span class="w">            </span><span class="n">recorded_traj</span><span class="o">.</span><span class="n">quaternions</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>

<span class="w">            </span><span class="n">recorded_traj</span><span class="o">.</span><span class="n">linear_velocities</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>

<span class="w">            </span><span class="n">recorded_traj</span><span class="o">.</span><span class="n">angular_velocities</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>

<span class="w">            </span><span class="n">des_traj</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>

<span class="w">            </span><span class="n">des_traj</span><span class="o">.</span><span class="n">quaternions</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>

<span class="w">            </span><span class="n">des_traj</span><span class="o">.</span><span class="n">linear_velocities</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>

<span class="w">            </span><span class="n">des_traj</span><span class="o">.</span><span class="n">angular_velocities</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>

<span class="w">            </span><span class="n">pos_penalty</span><span class="p">,</span>

<span class="w">            </span><span class="n">orn_penalty</span><span class="p">,</span>

<span class="w">            </span><span class="n">vel_penalty</span><span class="p">,</span>

<span class="w">            </span><span class="n">ang_vel_penalty</span><span class="p">,</span>

<span class="w">        </span><span class="p">)</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">total_cost</span>

<span class="k">def</span><span class="w"> </span><span class="nf">safe_set_cost</span><span class="p">(</span>

<span class="w">    </span><span class="n">position</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">    </span><span class="n">boxes</span><span class="p">:</span><span class="w"> </span><span class="n">Union</span><span class="p">[</span><span class="n">Box</span><span class="p">,</span><span class="w"> </span><span class="nb">list</span><span class="p">[</span><span class="n">Box</span><span class="p">]],</span>

<span class="w">    </span><span class="n">padding</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">None</span><span class="p">,</span>

<span class="w">    </span><span class="n">collision_penalty</span><span class="p">:</span><span class="w"> </span><span class="nb">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>

<span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nb">float</span><span class="p">:</span>

<span class="w">    </span><span class="s2">&quot;&quot;&quot;Evaluate the cost function for a given position within an environment composed of safe boxes</span>

<span class="s2">    In general, the cost function rewards being centrally located within the safe set, with the cost increasing as the</span>

<span class="s2">    position approaches the wall. Costs are negative for being inside the safe set, and positive outside (in collision).</span>

<span class="s2">    We can add an additional large penalty for being in collision, to help ensure collision avoidance</span>

<span class="s2">    This is essentially an axis-aligned L1 signed distance field</span>

<span class="s2">    Args:</span>

<span class="s2">        position (npt.ArrayLike): Position to evaluate the cost function</span>

<span class="s2">        boxes (Union[Box, list[Box]]): Local description of the safe set. This does NOT need to be every box in the</span>

<span class="s2">            environment, just the ones in the proximity of the position being evaluated</span>

<span class="s2">        padding (Optional[npt.ArrayLike]): Distance(s) to pad the safe set by (for instance, if we evaluate the central</span>

<span class="s2">            point of a spherical robot). Defaults to None.</span>

<span class="s2">        collision_penalty (float, optional): Additional penalty to increase the cost function if collision occurs.</span>

<span class="s2">            Defaults to 0.</span>

<span class="s2">    Returns:</span>

<span class="s2">        float: Cost function evaluation</span>

<span class="s2">    &quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">dim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">boxes</span><span class="p">,</span><span class="w"> </span><span class="n">Box</span><span class="p">):</span>

<span class="w">        </span><span class="n">boxes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">boxes</span><span class="p">]</span>

<span class="w">    </span><span class="c1"># If we&#39;re padding the boxes, go through each one and reduce their size by the padding amount</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">padding</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="kc">None</span><span class="p">:</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">padding</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="w"> </span><span class="nb">int</span><span class="p">)):</span>

<span class="w">            </span><span class="n">padding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">padding</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>

<span class="w">        </span><span class="k">else</span><span class="p">:</span>

<span class="w">            </span><span class="n">padding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">padding</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="w">            </span><span class="k">assert</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">padding</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">dim</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">box</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">enumerate</span><span class="p">(</span><span class="n">boxes</span><span class="p">):</span>

<span class="w">            </span><span class="n">boxes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Box</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">lower</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">padding</span><span class="p">,</span><span class="w"> </span><span class="n">box</span><span class="o">.</span><span class="n">upper</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">padding</span><span class="p">)</span>

<span class="w">    </span><span class="c1"># Keep track of which boxes we&#39;re inside, since the penalty depends on if we&#39;re in the safe set or not</span>

<span class="w">    </span><span class="n">boxes_inside</span><span class="p">:</span><span class="w"> </span><span class="nb">list</span><span class="p">[</span><span class="n">Box</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">box</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">boxes</span><span class="p">:</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">is_in_box</span><span class="p">(</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">box</span><span class="p">):</span>

<span class="w">            </span><span class="n">boxes_inside</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>

<span class="w">    </span><span class="c1"># If we are not in collision, we only consider the boxes that we&#39;re inside</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">boxes_inside</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">sum</span><span class="p">(</span>

<span class="w">            </span><span class="nb">max</span><span class="p">([</span><span class="o">*</span><span class="p">(</span><span class="n">position</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">box</span><span class="o">.</span><span class="n">upper</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">lower</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">position</span><span class="p">)])</span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">box</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">boxes_inside</span>

<span class="w">        </span><span class="p">)</span>

<span class="w">    </span><span class="c1"># If we are in collision, the collision depth is based on the nearest wall, which considers all boxes</span>

<span class="w">    </span><span class="k">else</span><span class="p">:</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">collision_penalty</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span>

<span class="w">            </span><span class="nb">max</span><span class="p">([</span><span class="o">*</span><span class="p">(</span><span class="n">position</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">box</span><span class="o">.</span><span class="n">upper</span><span class="p">),</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">lower</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">position</span><span class="p">)])</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">box</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">boxes</span>

<span class="w">        </span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">integrated_safe_set_cost</span><span class="p">(</span>

<span class="w">    </span><span class="n">positions</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">    </span><span class="n">boxes</span><span class="p">:</span><span class="w"> </span><span class="n">Union</span><span class="p">[</span><span class="n">Box</span><span class="p">,</span><span class="w"> </span><span class="nb">list</span><span class="p">[</span><span class="n">Box</span><span class="p">]],</span>

<span class="w">    </span><span class="n">padding</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">None</span><span class="p">,</span>

<span class="w">    </span><span class="n">collision_penalty</span><span class="p">:</span><span class="w"> </span><span class="nb">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>

<span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="w"> </span><span class="nb">bool</span><span class="p">]:</span>

<span class="w">    </span><span class="s2">&quot;&quot;&quot;Evaluates the safe-set collision avoidance cost function over a sequence of positions</span>

<span class="s2">    Args:</span>

<span class="s2">        positions (npt.ArrayLike): Positions to evaluate the cost function</span>

<span class="s2">        boxes (Union[Box, list[Box]]): Local description of the safe set. This does NOT need to be every box in the</span>

<span class="s2">            environment, just the ones in the proximity of the position being evaluated</span>

<span class="s2">        padding (Optional[npt.ArrayLike]): Distance(s) to pad the safe set by (for instance, if we evaluate the central</span>

<span class="s2">            point of a spherical robot). Defaults to None.</span>

<span class="s2">        collision_penalty (float, optional): Additional penalty to increase the cost function if collision occurs.</span>

<span class="s2">            Defaults to 0.</span>

<span class="s2">    Returns:</span>

<span class="s2">        tuple[float, bool]:</span>

<span class="s2">            float: The total integrated cost function evaluation</span>

<span class="s2">            bool: Whether a collision occurred at any point in the motion</span>

<span class="s2">    &quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">total_cost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="w">    </span><span class="n">collision_occurred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">False</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">positions</span><span class="p">:</span>

<span class="w">        </span><span class="n">cost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">safe_set_cost</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">boxes</span><span class="p">,</span><span class="w"> </span><span class="n">padding</span><span class="p">,</span><span class="w"> </span><span class="n">collision_penalty</span><span class="p">)</span>

<span class="w">        </span><span class="n">total_cost</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">cost</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>

<span class="w">            </span><span class="n">collision_occurred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">True</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">total_cost</span><span class="p">,</span><span class="w"> </span><span class="n">collision_occurred</span>

<span class="k">def</span><span class="w"> </span><span class="nf">robot_and_bag_termination_criteria</span><span class="p">(</span>

<span class="w">    </span><span class="n">robot_state</span><span class="p">:</span><span class="w"> </span><span class="nb">tuple</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span><span class="w"> </span><span class="o">...</span><span class="p">],</span>

<span class="w">    </span><span class="n">bag_state</span><span class="p">:</span><span class="w"> </span><span class="nb">tuple</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span><span class="w"> </span><span class="o">...</span><span class="p">],</span>

<span class="w">    </span><span class="n">desired_robot_pose</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">    </span><span class="n">pos_tol</span><span class="p">:</span><span class="w"> </span><span class="nb">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.05</span><span class="p">,</span>

<span class="w">    </span><span class="n">orn_tol</span><span class="p">:</span><span class="w"> </span><span class="nb">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>

<span class="w">    </span><span class="n">vel_tol</span><span class="p">:</span><span class="w"> </span><span class="nb">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.05</span><span class="p">,</span>

<span class="w">    </span><span class="n">omega_tol</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>

<span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nb">bool</span><span class="p">:</span>

<span class="w">    </span><span class="s2">&quot;&quot;&quot;Deterine if the robot/bag system is successfully stabilized about the desired robot pose</span>

<span class="s2">    Note: The ending pose of the bag is not super important right now, so we&#39;re neglecting it in this criteria. If this</span>

<span class="s2">    is important later on, we can add it to this</span>

<span class="s2">    Args:</span>

<span class="s2">        robot_state (tuple[npt.ArrayLike, ...]): Current dynamics state of the robot: position, orientation (XYZW</span>

<span class="s2">            quaternion), velocity, and angular velocity</span>

<span class="s2">        bag_state (tuple[npt.ArrayLike, ...]): Current dynamics state of the bag: position, orientation (XYZW</span>

<span class="s2">            quaternion), velocity, and angular velocity</span>

<span class="s2">        desired_robot_pose (npt.ArrayLike): Desired position + XYZW quaternion pose of the robot, shape (7,)</span>

<span class="s2">        pos_tol (float, optional): Absolute tolerance on position. Defaults to 0.05 (within 5 cm)</span>

<span class="s2">        orn_tol (float, optional): Absolute tolerance on orientation (via quaternion distance metric). Defaults to</span>

<span class="s2">            deg2rad(10) (approximately within a 10 degree rotation)</span>

<span class="s2">        vel_tol (float, optional): Absolute tolerance on velocity. Defaults to 0.05 (within 5 cm/s)</span>

<span class="s2">        omega_tol (float, optional): Absolute tolerance on angular velocity. Defaults to deg2rad(10) (approximately</span>

<span class="s2">            within 10 deg/s)</span>

<span class="s2">    Returns:</span>

<span class="s2">        bool: True if stabilized at the desired pose</span>

<span class="s2">    &quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">des_pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">desired_robot_pose</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>

<span class="w">    </span><span class="n">des_orn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">desired_robot_pose</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>

<span class="w">    </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">orn</span><span class="p">,</span><span class="w"> </span><span class="n">vel</span><span class="p">,</span><span class="w"> </span><span class="n">ang_vel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">robot_state</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>

<span class="w">    </span><span class="n">bag_vel</span><span class="p">,</span><span class="w"> </span><span class="n">bag_ang_vel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bag_state</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span>

<span class="w">        </span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">pos</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">des_pos</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">pos_tol</span>

<span class="w">        </span><span class="ow">and</span><span class="w"> </span><span class="n">quaternion_dist</span><span class="p">(</span><span class="n">orn</span><span class="p">,</span><span class="w"> </span><span class="n">des_orn</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">orn_tol</span>

<span class="w">        </span><span class="ow">and</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vel</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">vel_tol</span>

<span class="w">        </span><span class="ow">and</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">ang_vel</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">omega_tol</span>

<span class="w">        </span><span class="ow">and</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">bag_vel</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">vel_tol</span>

<span class="w">        </span><span class="ow">and</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">bag_ang_vel</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">omega_tol</span>

<span class="w">    </span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">_visualize_safe_set_cost</span><span class="p">():</span>

<span class="w">    </span><span class="s2">&quot;&quot;&quot;Create a 2D example of two safe-set boxes and visualize a heatmap of the penalty function&quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span>

<span class="w">    </span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">))</span>

<span class="w">    </span><span class="n">Z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="w">    </span><span class="n">box_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Box</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">])</span>

<span class="w">    </span><span class="n">box_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Box</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">])</span>

<span class="w">    </span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

<span class="w">    </span><span class="n">padding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">])</span>

<span class="w">    </span><span class="n">penalty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span>

<span class="w">    </span><span class="n">new_boxes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>

<span class="w">        </span><span class="n">Box</span><span class="p">(</span><span class="n">box_1</span><span class="o">.</span><span class="n">lower</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">padding</span><span class="p">,</span><span class="w"> </span><span class="n">box_1</span><span class="o">.</span><span class="n">upper</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">padding</span><span class="p">),</span>

<span class="w">        </span><span class="n">Box</span><span class="p">(</span><span class="n">box_2</span><span class="o">.</span><span class="n">lower</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">padding</span><span class="p">,</span><span class="w"> </span><span class="n">box_2</span><span class="o">.</span><span class="n">upper</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">padding</span><span class="p">),</span>

<span class="w">    </span><span class="p">]</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>

<span class="w">            </span><span class="n">Z</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">safe_set_cost</span><span class="p">(</span>

<span class="w">                </span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">],</span><span class="w"> </span><span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">]),</span><span class="w"> </span><span class="p">[</span><span class="n">box_1</span><span class="p">,</span><span class="w"> </span><span class="n">box_2</span><span class="p">],</span><span class="w"> </span><span class="n">padding</span><span class="p">,</span><span class="w"> </span><span class="n">penalty</span>

<span class="w">            </span><span class="p">)</span>

<span class="w">            </span><span class="c1"># Z[i, j] = (1 if Z[i, j] &gt;= 0 else -1) * Z[i, j] ** 2</span>

<span class="w">    </span><span class="n">two_slope_norm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colors</span><span class="o">.</span><span class="n">TwoSlopeNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Z</span><span class="p">),</span><span class="w"> </span><span class="n">vcenter</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">vmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Z</span><span class="p">))</span>

<span class="w">    </span><span class="n">heatmap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">Z</span><span class="p">,</span><span class="w"> </span><span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Spectral_r&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">norm</span><span class="o">=</span><span class="n">two_slope_norm</span><span class="p">)</span>

<span class="w">    </span><span class="n">plot_2D_box</span><span class="p">(</span><span class="n">box_1</span><span class="p">,</span><span class="w"> </span><span class="kc">None</span><span class="p">,</span><span class="w"> </span><span class="kc">False</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;k--&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">plot_2D_box</span><span class="p">(</span><span class="n">box_2</span><span class="p">,</span><span class="w"> </span><span class="kc">None</span><span class="p">,</span><span class="w"> </span><span class="kc">False</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;k--&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">plot_2D_box</span><span class="p">(</span><span class="n">new_boxes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="kc">None</span><span class="p">,</span><span class="w"> </span><span class="kc">False</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;b--&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">plot_2D_box</span><span class="p">(</span><span class="n">new_boxes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="kc">None</span><span class="p">,</span><span class="w"> </span><span class="kc">False</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;b--&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">heatmap</span><span class="p">)</span>

<span class="w">    </span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Safe Set Deviation&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">if</span><span class="w"> </span><span class="vm">__name__</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

<span class="w">    </span><span class="n">_visualize_safe_set_cost</span><span class="p">()</span>
</code></pre></div>

</details>
<h2 id="functions">Functions</h2>
<h3 id="integrated_safe_set_cost">integrated_safe_set_cost</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">integrated_safe_set_cost</span><span class="p">(</span>
    <span class="n">positions</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">boxes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pyastrobee</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">boxes</span><span class="o">.</span><span class="n">Box</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">pyastrobee</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">boxes</span><span class="o">.</span><span class="n">Box</span><span class="p">]],</span>
    <span class="n">padding</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">collision_penalty</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span>
</code></pre></div>

<p>Evaluates the safe-set collision avoidance cost function over a sequence of positions</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>positions</td>
<td>npt.ArrayLike</td>
<td>Positions to evaluate the cost function</td>
<td>None</td>
</tr>
<tr>
<td>boxes</td>
<td>Union[Box, list[Box]]</td>
<td>Local description of the safe set. This does NOT need to be every box in the<br>environment, just the ones in the proximity of the position being evaluated</td>
<td>None</td>
</tr>
<tr>
<td>padding</td>
<td>Optional[npt.ArrayLike]</td>
<td>Distance(s) to pad the safe set by (for instance, if we evaluate the central<br>point of a spherical robot). Defaults to None.</td>
<td>None</td>
</tr>
<tr>
<td>collision_penalty</td>
<td>float</td>
<td>Additional penalty to increase the cost function if collision occurs.<br>Defaults to 0.</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>tuple[float, bool]</td>
<td>float: The total integrated cost function evaluation<br>bool: Whether a collision occurred at any point in the motion</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">integrated_safe_set_cost</span><span class="p">(</span>

<span class="w">    </span><span class="nl">positions</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">    </span><span class="nl">boxes</span><span class="p">:</span><span class="w"> </span><span class="ow">Union</span><span class="o">[</span><span class="n">Box, list[Box</span><span class="o">]</span><span class="err">]</span><span class="p">,</span>

<span class="w">    </span><span class="nl">padding</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">npt.ArrayLike</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="nl">collision_penalty</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>

<span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">tuple</span><span class="o">[</span><span class="n">float, bool</span><span class="o">]</span><span class="err">:</span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;Evaluates the safe-set collision avoidance cost function over a sequence of positions</span>

<span class="ss">    Args:</span>

<span class="ss">        positions (npt.ArrayLike): Positions to evaluate the cost function</span>

<span class="ss">        boxes (Union[Box, list[Box]]): Local description of the safe set. This does NOT need to be every box in the</span>

<span class="ss">            environment, just the ones in the proximity of the position being evaluated</span>

<span class="ss">        padding (Optional[npt.ArrayLike]): Distance(s) to pad the safe set by (for instance, if we evaluate the central</span>

<span class="ss">            point of a spherical robot). Defaults to None.</span>

<span class="ss">        collision_penalty (float, optional): Additional penalty to increase the cost function if collision occurs.</span>

<span class="ss">            Defaults to 0.</span>

<span class="ss">    Returns:</span>

<span class="ss">        tuple[float, bool]:</span>

<span class="ss">            float: The total integrated cost function evaluation</span>

<span class="ss">            bool: Whether a collision occurred at any point in the motion</span>

<span class="ss">    &quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">total_cost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="w">    </span><span class="n">collision_occurred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">False</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">positions</span><span class="p">:</span>

<span class="w">        </span><span class="n">cost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">safe_set_cost</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">boxes</span><span class="p">,</span><span class="w"> </span><span class="n">padding</span><span class="p">,</span><span class="w"> </span><span class="n">collision_penalty</span><span class="p">)</span>

<span class="w">        </span><span class="n">total_cost</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">cost</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">cost</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="err">:</span>

<span class="w">            </span><span class="n">collision_occurred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">True</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">total_cost</span><span class="p">,</span><span class="w"> </span><span class="n">collision_occurred</span>
</code></pre></div>

</details>
<h3 id="robot_and_bag_termination_criteria">robot_and_bag_termination_criteria</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">robot_and_bag_termination_criteria</span><span class="p">(</span>
    <span class="n">robot_state</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span> <span class="o">...</span><span class="p">],</span>
    <span class="n">bag_state</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span> <span class="o">...</span><span class="p">],</span>
    <span class="n">desired_robot_pose</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">pos_tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
    <span class="n">orn_tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.17453292519943295</span><span class="p">,</span>
    <span class="n">vel_tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
    <span class="n">omega_tol</span><span class="o">=</span><span class="mf">0.17453292519943295</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</code></pre></div>

<p>Deterine if the robot/bag system is successfully stabilized about the desired robot pose</p>
<p>Note: The ending pose of the bag is not super important right now, so we're neglecting it in this criteria. If this
is important later on, we can add it to this</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>robot_state</td>
<td>tuple[npt.ArrayLike, ...]</td>
<td>Current dynamics state of the robot: position, orientation (XYZW<br>quaternion), velocity, and angular velocity</td>
<td>None</td>
</tr>
<tr>
<td>bag_state</td>
<td>tuple[npt.ArrayLike, ...]</td>
<td>Current dynamics state of the bag: position, orientation (XYZW<br>quaternion), velocity, and angular velocity</td>
<td>None</td>
</tr>
<tr>
<td>desired_robot_pose</td>
<td>npt.ArrayLike</td>
<td>Desired position + XYZW quaternion pose of the robot, shape (7,)</td>
<td>None</td>
</tr>
<tr>
<td>pos_tol</td>
<td>float</td>
<td>Absolute tolerance on position. Defaults to 0.05 (within 5 cm)</td>
<td>0</td>
</tr>
<tr>
<td>orn_tol</td>
<td>float</td>
<td>Absolute tolerance on orientation (via quaternion distance metric). Defaults to<br>deg2rad(10) (approximately within a 10 degree rotation)</td>
<td>None</td>
</tr>
<tr>
<td>vel_tol</td>
<td>float</td>
<td>Absolute tolerance on velocity. Defaults to 0.05 (within 5 cm/s)</td>
<td>0</td>
</tr>
<tr>
<td>omega_tol</td>
<td>float</td>
<td>Absolute tolerance on angular velocity. Defaults to deg2rad(10) (approximately<br>within 10 deg/s)</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>bool</td>
<td>True if stabilized at the desired pose</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">robot_and_bag_termination_criteria</span><span class="p">(</span>

<span class="w">    </span><span class="n">robot_state</span><span class="o">:</span><span class="w"> </span><span class="n">tuple</span><span class="p">[</span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span><span class="w"> </span><span class="p">...],</span>

<span class="w">    </span><span class="n">bag_state</span><span class="o">:</span><span class="w"> </span><span class="n">tuple</span><span class="p">[</span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span><span class="w"> </span><span class="p">...],</span>

<span class="w">    </span><span class="n">desired_robot_pose</span><span class="o">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">    </span><span class="n">pos_tol</span><span class="o">:</span><span class="w"> </span><span class="n">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.05</span><span class="p">,</span>

<span class="w">    </span><span class="n">orn_tol</span><span class="o">:</span><span class="w"> </span><span class="n">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>

<span class="w">    </span><span class="n">vel_tol</span><span class="o">:</span><span class="w"> </span><span class="n">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.05</span><span class="p">,</span>

<span class="w">    </span><span class="n">omega_tol</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>

<span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">bool</span><span class="o">:</span>

<span class="w">    </span><span class="s">&quot;&quot;&quot;Deterine if the robot/bag system is successfully stabilized about the desired robot pose</span>

<span class="s">    Note: The ending pose of the bag is not super important right now, so we&#39;</span><span class="n">re</span><span class="w"> </span><span class="n">neglecting</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">criteria</span><span class="p">.</span><span class="w"> </span><span class="nf">If</span><span class="w"> </span><span class="n">this</span>

<span class="w">    </span><span class="n">is</span><span class="w"> </span><span class="n">important</span><span class="w"> </span><span class="n">later</span><span class="w"> </span><span class="n">on</span><span class="p">,</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">this</span>

<span class="w">    </span><span class="n">Args</span><span class="o">:</span>

<span class="w">        </span><span class="n">robot_state</span><span class="w"> </span><span class="p">(</span><span class="n">tuple</span><span class="p">[</span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span><span class="w"> </span><span class="p">...])</span><span class="o">:</span><span class="w"> </span><span class="n">Current</span><span class="w"> </span><span class="n">dynamics</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="kr">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">robot</span><span class="o">:</span><span class="w"> </span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">orientation</span><span class="w"> </span><span class="p">(</span><span class="n">XYZW</span>

<span class="w">            </span><span class="n">quaternion</span><span class="p">),</span><span class="w"> </span><span class="n">velocity</span><span class="p">,</span><span class="w"> </span><span class="kr">and</span><span class="w"> </span><span class="n">angular</span><span class="w"> </span><span class="n">velocity</span>

<span class="w">        </span><span class="n">bag_state</span><span class="w"> </span><span class="p">(</span><span class="n">tuple</span><span class="p">[</span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span><span class="w"> </span><span class="p">...])</span><span class="o">:</span><span class="w"> </span><span class="n">Current</span><span class="w"> </span><span class="n">dynamics</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="kr">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">bag</span><span class="o">:</span><span class="w"> </span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">orientation</span><span class="w"> </span><span class="p">(</span><span class="n">XYZW</span>

<span class="w">            </span><span class="n">quaternion</span><span class="p">),</span><span class="w"> </span><span class="n">velocity</span><span class="p">,</span><span class="w"> </span><span class="kr">and</span><span class="w"> </span><span class="n">angular</span><span class="w"> </span><span class="n">velocity</span>

<span class="w">        </span><span class="n">desired_robot_pose</span><span class="w"> </span><span class="p">(</span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">Desired</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">XYZW</span><span class="w"> </span><span class="n">quaternion</span><span class="w"> </span><span class="n">pose</span><span class="w"> </span><span class="kr">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">robot</span><span class="p">,</span><span class="w"> </span><span class="n">shape</span><span class="w"> </span><span class="p">(</span><span class="mi">7</span><span class="p">,)</span>

<span class="w">        </span><span class="n">pos_tol</span><span class="w"> </span><span class="p">(</span><span class="n">float</span><span class="p">,</span><span class="w"> </span><span class="n">optional</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">Absolute</span><span class="w"> </span><span class="n">tolerance</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">position</span><span class="p">.</span><span class="w"> </span><span class="n">Defaults</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">0.05</span><span class="w"> </span><span class="p">(</span><span class="kr">within</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="n">cm</span><span class="p">)</span>

<span class="w">        </span><span class="n">orn_tol</span><span class="w"> </span><span class="p">(</span><span class="n">float</span><span class="p">,</span><span class="w"> </span><span class="n">optional</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">Absolute</span><span class="w"> </span><span class="n">tolerance</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">orientation</span><span class="w"> </span><span class="p">(</span><span class="n">via</span><span class="w"> </span><span class="n">quaternion</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="n">metric</span><span class="p">).</span><span class="w"> </span><span class="n">Defaults</span><span class="w"> </span><span class="n">to</span>

<span class="w">            </span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">approximately</span><span class="w"> </span><span class="kr">within</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">degree</span><span class="w"> </span><span class="n">rotation</span><span class="p">)</span>

<span class="w">        </span><span class="n">vel_tol</span><span class="w"> </span><span class="p">(</span><span class="n">float</span><span class="p">,</span><span class="w"> </span><span class="n">optional</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">Absolute</span><span class="w"> </span><span class="n">tolerance</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">velocity</span><span class="p">.</span><span class="w"> </span><span class="n">Defaults</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mf">0.05</span><span class="w"> </span><span class="p">(</span><span class="kr">within</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="n">cm</span><span class="o">/</span><span class="n">s</span><span class="p">)</span>

<span class="w">        </span><span class="n">omega_tol</span><span class="w"> </span><span class="p">(</span><span class="n">float</span><span class="p">,</span><span class="w"> </span><span class="n">optional</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="n">Absolute</span><span class="w"> </span><span class="n">tolerance</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">angular</span><span class="w"> </span><span class="n">velocity</span><span class="p">.</span><span class="w"> </span><span class="n">Defaults</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">deg2rad</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">approximately</span>

<span class="w">            </span><span class="kr">within</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">deg</span><span class="o">/</span><span class="n">s</span><span class="p">)</span>

<span class="w">    </span><span class="n">Returns</span><span class="o">:</span>

<span class="w">        </span><span class="n">bool</span><span class="o">:</span><span class="w"> </span><span class="kr">True</span><span class="w"> </span><span class="nf">if</span><span class="w"> </span><span class="n">stabilized</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">desired</span><span class="w"> </span><span class="n">pose</span>

<span class="w">    </span><span class="s">&quot;&quot;&quot;</span>

<span class="s">    des_pos = desired_robot_pose[:3]</span>

<span class="s">    des_orn = desired_robot_pose[3:]</span>

<span class="s">    pos, orn, vel, ang_vel = robot_state[:4]</span>

<span class="s">    bag_vel, bag_ang_vel = bag_state[2:]</span>

<span class="s">    return (</span>

<span class="s">        np.linalg.norm(pos - des_pos) &lt;= pos_tol</span>

<span class="s">        and quaternion_dist(orn, des_orn) &lt;= orn_tol</span>

<span class="s">        and np.linalg.norm(vel) &lt;= vel_tol</span>

<span class="s">        and np.linalg.norm(ang_vel) &lt;= omega_tol</span>

<span class="s">        and np.linalg.norm(bag_vel) &lt;= vel_tol</span>

<span class="s">        and np.linalg.norm(bag_ang_vel) &lt;= omega_tol</span>

<span class="s">    )</span>
</code></pre></div>

</details>
<h3 id="safe_set_cost">safe_set_cost</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">safe_set_cost</span><span class="p">(</span>
    <span class="n">position</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">boxes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pyastrobee</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">boxes</span><span class="o">.</span><span class="n">Box</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">pyastrobee</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">boxes</span><span class="o">.</span><span class="n">Box</span><span class="p">]],</span>
    <span class="n">padding</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">collision_penalty</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span>
</code></pre></div>

<p>Evaluate the cost function for a given position within an environment composed of safe boxes</p>
<p>In general, the cost function rewards being centrally located within the safe set, with the cost increasing as the
position approaches the wall. Costs are negative for being inside the safe set, and positive outside (in collision).
We can add an additional large penalty for being in collision, to help ensure collision avoidance</p>
<p>This is essentially an axis-aligned L1 signed distance field</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>position</td>
<td>npt.ArrayLike</td>
<td>Position to evaluate the cost function</td>
<td>None</td>
</tr>
<tr>
<td>boxes</td>
<td>Union[Box, list[Box]]</td>
<td>Local description of the safe set. This does NOT need to be every box in the<br>environment, just the ones in the proximity of the position being evaluated</td>
<td>None</td>
</tr>
<tr>
<td>padding</td>
<td>Optional[npt.ArrayLike]</td>
<td>Distance(s) to pad the safe set by (for instance, if we evaluate the central<br>point of a spherical robot). Defaults to None.</td>
<td>None</td>
</tr>
<tr>
<td>collision_penalty</td>
<td>float</td>
<td>Additional penalty to increase the cost function if collision occurs.<br>Defaults to 0.</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>float</td>
<td>Cost function evaluation</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">safe_set_cost</span><span class="p">(</span>

<span class="w">    </span><span class="k">position</span><span class="err">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">    </span><span class="nl">boxes</span><span class="p">:</span><span class="w"> </span><span class="ow">Union</span><span class="o">[</span><span class="n">Box, list[Box</span><span class="o">]</span><span class="err">]</span><span class="p">,</span>

<span class="w">    </span><span class="nl">padding</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">npt.ArrayLike</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="nl">collision_penalty</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>

<span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">float</span><span class="err">:</span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;Evaluate the cost function for a given position within an environment composed of safe boxes</span>

<span class="ss">    In general, the cost function rewards being centrally located within the safe set, with the cost increasing as the</span>

<span class="ss">    position approaches the wall. Costs are negative for being inside the safe set, and positive outside (in collision).</span>

<span class="ss">    We can add an additional large penalty for being in collision, to help ensure collision avoidance</span>

<span class="ss">    This is essentially an axis-aligned L1 signed distance field</span>

<span class="ss">    Args:</span>

<span class="ss">        position (npt.ArrayLike): Position to evaluate the cost function</span>

<span class="ss">        boxes (Union[Box, list[Box]]): Local description of the safe set. This does NOT need to be every box in the</span>

<span class="ss">            environment, just the ones in the proximity of the position being evaluated</span>

<span class="ss">        padding (Optional[npt.ArrayLike]): Distance(s) to pad the safe set by (for instance, if we evaluate the central</span>

<span class="ss">            point of a spherical robot). Defaults to None.</span>

<span class="ss">        collision_penalty (float, optional): Additional penalty to increase the cost function if collision occurs.</span>

<span class="ss">            Defaults to 0.</span>

<span class="ss">    Returns:</span>

<span class="ss">        float: Cost function evaluation</span>

<span class="ss">    &quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">dim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="k">position</span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">boxes</span><span class="p">,</span><span class="w"> </span><span class="n">Box</span><span class="p">)</span><span class="err">:</span>

<span class="w">        </span><span class="n">boxes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">boxes</span><span class="o">]</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="k">If</span><span class="w"> </span><span class="n">we</span><span class="s1">&#39;re padding the boxes, go through each one and reduce their size by the padding amount</span>

<span class="s1">    if padding is not None:</span>

<span class="s1">        if isinstance(padding, (float, int)):</span>

<span class="s1">            padding = padding * np.ones(dim)</span>

<span class="s1">        else:</span>

<span class="s1">            padding = np.ravel(padding).astype(np.float64)</span>

<span class="s1">            assert len(padding) == dim</span>

<span class="s1">        for i, box in enumerate(boxes):</span>

<span class="s1">            boxes[i] = Box(box.lower + padding, box.upper - padding)</span>

<span class="s1">    # Keep track of which boxes we&#39;</span><span class="n">re</span><span class="w"> </span><span class="n">inside</span><span class="p">,</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">penalty</span><span class="w"> </span><span class="n">depends</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">we</span><span class="s1">&#39;re in the safe set or not</span>

<span class="s1">    boxes_inside: list[Box] = []</span>

<span class="s1">    for box in boxes:</span>

<span class="s1">        if is_in_box(position, box):</span>

<span class="s1">            boxes_inside.append(box)</span>

<span class="s1">    # If we are not in collision, we only consider the boxes that we&#39;</span><span class="n">re</span><span class="w"> </span><span class="n">inside</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">boxes_inside</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="err">:</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span>

<span class="w">            </span><span class="nf">max</span><span class="p">(</span><span class="o">[</span><span class="n">*(position - box.upper), *(box.lower - position)</span><span class="o">]</span><span class="p">)</span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">box</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">boxes_inside</span>

<span class="w">        </span><span class="p">)</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="k">If</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">collision</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">collision</span><span class="w"> </span><span class="k">depth</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">based</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">nearest</span><span class="w"> </span><span class="n">wall</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">considers</span><span class="w"> </span><span class="ow">all</span><span class="w"> </span><span class="n">boxes</span>

<span class="w">    </span><span class="k">else</span><span class="err">:</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">collision_penalty</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span>

<span class="w">            </span><span class="nf">max</span><span class="p">(</span><span class="o">[</span><span class="n">*(position - box.upper), *(box.lower - position)</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">box</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">boxes</span>

<span class="w">        </span><span class="p">)</span>
</code></pre></div>

</details>
<h3 id="state_tracking_cost">state_tracking_cost</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">state_tracking_cost</span><span class="p">(</span>
    <span class="n">cur_pos</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">cur_orn</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">cur_vel</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">cur_ang_vel</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">des_pos</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">des_orn</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">des_vel</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">des_ang_vel</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">pos_penalty</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">orn_penalty</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">vel_penalty</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">ang_vel_penalty</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span>
</code></pre></div>

<p>Evaluate a cost function for deviations between the current and desired dynamics state</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>cur_pos</td>
<td>npt.ArrayLike</td>
<td>Current position, shape (3,)</td>
<td>None</td>
</tr>
<tr>
<td>cur_orn</td>
<td>npt.ArrayLike</td>
<td>Current XYZW quaternion orientation, shape (4,)</td>
<td>None</td>
</tr>
<tr>
<td>cur_vel</td>
<td>npt.ArrayLike</td>
<td>Current linear velocity, shape (3,)</td>
<td>None</td>
</tr>
<tr>
<td>cur_ang_vel</td>
<td>npt.ArrayLike</td>
<td>Current angular velocity, shape (3,)</td>
<td>None</td>
</tr>
<tr>
<td>des_pos</td>
<td>npt.ArrayLike</td>
<td>Desired position, shape (3,)</td>
<td>None</td>
</tr>
<tr>
<td>des_orn</td>
<td>npt.ArrayLike</td>
<td>Desired XYZW quaternion orientation, shape (4,)</td>
<td>None</td>
</tr>
<tr>
<td>des_vel</td>
<td>npt.ArrayLike</td>
<td>Desired linear velocity, shape (3,)</td>
<td>None</td>
</tr>
<tr>
<td>des_ang_vel</td>
<td>npt.ArrayLike</td>
<td>Desired angular velocity, shape (3,)</td>
<td>None</td>
</tr>
<tr>
<td>pos_penalty</td>
<td>float</td>
<td>Penalty scaling factor for position error</td>
<td>None</td>
</tr>
<tr>
<td>orn_penalty</td>
<td>float</td>
<td>Penalty scaling factor for orientation/angular error</td>
<td>None</td>
</tr>
<tr>
<td>vel_penalty</td>
<td>float</td>
<td>Penalty scaling factor for linear velocity error</td>
<td>None</td>
</tr>
<tr>
<td>ang_vel_penalty</td>
<td>float</td>
<td>Penalty scaling factor for angular velocity error</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>float</td>
<td>Cost function evaluation</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code>def state_tracking_cost(

    cur_pos: npt.ArrayLike,

    cur_orn: npt.ArrayLike,

    cur_vel: npt.ArrayLike,

    cur_ang_vel: npt.ArrayLike,

    des_pos: npt.ArrayLike,

    des_orn: npt.ArrayLike,

    des_vel: npt.ArrayLike,

    des_ang_vel: npt.ArrayLike,

    pos_penalty: float,

    orn_penalty: float,

    vel_penalty: float,

    ang_vel_penalty: float,

) -&gt; float:

    &quot;&quot;&quot;Evaluate a cost function for deviations between the current and desired dynamics state

    Args:

        cur_pos (npt.ArrayLike): Current position, shape (3,)

        cur_orn (npt.ArrayLike): Current XYZW quaternion orientation, shape (4,)

        cur_vel (npt.ArrayLike): Current linear velocity, shape (3,)

        cur_ang_vel (npt.ArrayLike): Current angular velocity, shape (3,)

        des_pos (npt.ArrayLike): Desired position, shape (3,)

        des_orn (npt.ArrayLike): Desired XYZW quaternion orientation, shape (4,)

        des_vel (npt.ArrayLike): Desired linear velocity, shape (3,)

        des_ang_vel (npt.ArrayLike): Desired angular velocity, shape (3,)

        pos_penalty (float): Penalty scaling factor for position error

        orn_penalty (float): Penalty scaling factor for orientation/angular error

        vel_penalty (float): Penalty scaling factor for linear velocity error

        ang_vel_penalty (float): Penalty scaling factor for angular velocity error

    Returns:

        float: Cost function evaluation

    &quot;&quot;&quot;

    pos_err = np.subtract(cur_pos, des_pos)

    orn_err = quaternion_angular_error(cur_orn, des_orn)

    vel_err = np.subtract(cur_vel, des_vel)

    ang_vel_err = np.subtract(cur_ang_vel, des_ang_vel)

    # NOTE Would an L1 norm be better here?

    return (

        pos_penalty <span class="gs">* np.linalg.norm(pos_err)</span>

<span class="gs">        + orn_penalty *</span> np.linalg.norm(orn_err)

        + vel_penalty <span class="gs">* np.linalg.norm(vel_err)</span>

<span class="gs">        + ang_vel_penalty *</span> np.linalg.norm(ang_vel_err)

    )
</code></pre></div>

</details>
<h3 id="traj_tracking_cost">traj_tracking_cost</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">traj_tracking_cost</span><span class="p">(</span>
    <span class="n">des_traj</span><span class="p">:</span> <span class="n">pyastrobee</span><span class="o">.</span><span class="n">trajectories</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">Trajectory</span><span class="p">,</span>
    <span class="n">recorded_traj</span><span class="p">:</span> <span class="n">pyastrobee</span><span class="o">.</span><span class="n">trajectories</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">Trajectory</span><span class="p">,</span>
    <span class="n">pos_penalty</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">orn_penalty</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">vel_penalty</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">ang_vel_penalty</span><span class="p">:</span> <span class="nb">float</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span>
</code></pre></div>

<p>Evaluates a state mismatch cost function over the duration of a trajectory</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>des_traj</td>
<td>Trajectory</td>
<td>Desired trajectory</td>
<td>None</td>
</tr>
<tr>
<td>recorded_traj</td>
<td>Trajectory</td>
<td>Recorded trajectory</td>
<td>None</td>
</tr>
<tr>
<td>pos_penalty</td>
<td>float</td>
<td>Penalty scaling factor for position error</td>
<td>None</td>
</tr>
<tr>
<td>orn_penalty</td>
<td>float</td>
<td>Penalty scaling factor for orientation/angular error</td>
<td>None</td>
</tr>
<tr>
<td>vel_penalty</td>
<td>float</td>
<td>Penalty scaling factor for linear velocity error</td>
<td>None</td>
</tr>
<tr>
<td>ang_vel_penalty</td>
<td>float</td>
<td>Penalty scaling factor for angular velocity error</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>float</td>
<td>Cost function evaluation</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">traj_tracking_cost</span><span class="p">(</span>

<span class="w">    </span><span class="nl">des_traj</span><span class="p">:</span><span class="w"> </span><span class="n">Trajectory</span><span class="p">,</span>

<span class="w">    </span><span class="nl">recorded_traj</span><span class="p">:</span><span class="w"> </span><span class="n">Trajectory</span><span class="p">,</span>

<span class="w">    </span><span class="nl">pos_penalty</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="p">,</span>

<span class="w">    </span><span class="nl">orn_penalty</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="p">,</span>

<span class="w">    </span><span class="nl">vel_penalty</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="p">,</span>

<span class="w">    </span><span class="nl">ang_vel_penalty</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="p">,</span>

<span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">float</span><span class="err">:</span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;Evaluates a state mismatch cost function over the duration of a trajectory</span>

<span class="ss">    Args:</span>

<span class="ss">        des_traj (Trajectory): Desired trajectory</span>

<span class="ss">        recorded_traj (Trajectory): Recorded trajectory</span>

<span class="ss">        pos_penalty (float): Penalty scaling factor for position error</span>

<span class="ss">        orn_penalty (float): Penalty scaling factor for orientation/angular error</span>

<span class="ss">        vel_penalty (float): Penalty scaling factor for linear velocity error</span>

<span class="ss">        ang_vel_penalty (float): Penalty scaling factor for angular velocity error</span>

<span class="ss">    Returns:</span>

<span class="ss">        float: Cost function evaluation</span>

<span class="ss">    &quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">assert</span><span class="w"> </span><span class="n">recorded_traj</span><span class="p">.</span><span class="n">num_timesteps</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">des_traj</span><span class="p">.</span><span class="n">num_timesteps</span>

<span class="w">    </span><span class="n">total_cost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">range</span><span class="p">(</span><span class="n">recorded_traj</span><span class="p">.</span><span class="n">num_timesteps</span><span class="p">)</span><span class="err">:</span>

<span class="w">        </span><span class="n">total_cost</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">state_tracking_cost</span><span class="p">(</span>

<span class="w">            </span><span class="n">recorded_traj</span><span class="p">.</span><span class="n">positions</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">,</span>

<span class="w">            </span><span class="n">recorded_traj</span><span class="p">.</span><span class="n">quaternions</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">,</span>

<span class="w">            </span><span class="n">recorded_traj</span><span class="p">.</span><span class="n">linear_velocities</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">,</span>

<span class="w">            </span><span class="n">recorded_traj</span><span class="p">.</span><span class="n">angular_velocities</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">,</span>

<span class="w">            </span><span class="n">des_traj</span><span class="p">.</span><span class="n">positions</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">,</span>

<span class="w">            </span><span class="n">des_traj</span><span class="p">.</span><span class="n">quaternions</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">,</span>

<span class="w">            </span><span class="n">des_traj</span><span class="p">.</span><span class="n">linear_velocities</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">,</span>

<span class="w">            </span><span class="n">des_traj</span><span class="p">.</span><span class="n">angular_velocities</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">,</span>

<span class="w">            </span><span class="n">pos_penalty</span><span class="p">,</span>

<span class="w">            </span><span class="n">orn_penalty</span><span class="p">,</span>

<span class="w">            </span><span class="n">vel_penalty</span><span class="p">,</span>

<span class="w">            </span><span class="n">ang_vel_penalty</span><span class="p">,</span>

<span class="w">        </span><span class="p">)</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">total_cost</span>
</code></pre></div>

</details>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        
<footer class="md-footer">
    
      <nav class="md-footer__inner md-grid" aria-label="Footer">
        
          
          <a href="../keyboard_controller/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Keyboard Controller" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Previous
                </span>
                Keyboard Controller
              </div>
            </div>
          </a>
        
        
          
          <a href="../multi_robot/" class="md-footer__link md-footer__link--next" aria-label="Next: Multi Robot" rel="next">
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Next
                </span>
                Multi Robot
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
            
            Powered by
            <a href="http://timothycrosley.github.io/portray">portray.</a>
            You too can
            <a href="http://timothycrosley.github.io/portray">
              portray</a>
            your Python project well using automatic documentation.
          </div>
        
      </div>
    </div>
  </footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": [], "search": "../../../../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.078830c0.min.js"></script>
      
    
  </body>
</html>