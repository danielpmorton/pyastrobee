
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.5.4">
    
    
      
        <title>Force Torque Control - pyastrobee</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.80dcb947.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#546d78">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue-grey" data-md-color-accent="pink">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#module-pyastrobeecontrolforce_torque_control" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="pyastrobee" class="md-header__button md-logo" aria-label="pyastrobee" data-md-component="logo">
      
  <img src="../../../../images/favicon_large.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            pyastrobee
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Force Torque Control
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/danielpmorton/pyastrobee" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    pyastrobee
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="pyastrobee" class="md-nav__button md-logo" aria-label="pyastrobee" data-md-component="logo">
      
  <img src="../../../../images/favicon_large.png" alt="logo">

    </a>
    pyastrobee
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/danielpmorton/pyastrobee" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    pyastrobee
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/additional_installs/" class="md-nav__link">
        Additional Installs
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/bag_dynamics/" class="md-nav__link">
        Bag Dynamics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/getting_started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/loading_iss_meshes/" class="md-nav__link">
        Loading Iss Meshes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/meshing/" class="md-nav__link">
        Meshing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/nasa_sim/" class="md-nav__link">
        Nasa Sim
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/pybullet_tips/" class="md-nav__link">
        Pybullet Tips
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/references/" class="md-nav__link">
        References
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/retexturing/" class="md-nav__link">
        Retexturing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/testing/" class="md-nav__link">
        Testing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/tet_meshing/" class="md-nav__link">
        Tet Meshing
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13" type="checkbox" id="__nav_13" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_13">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_13">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13_1" type="checkbox" id="__nav_13_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_13_1">
          Pyastrobee
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Pyastrobee" data-md-level="2">
        <label class="md-nav__title" for="__nav_13_1">
          <span class="md-nav__icon md-icon"></span>
          Pyastrobee
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13_1_2" type="checkbox" id="__nav_13_1_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_13_1_2">
          Config
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Config" data-md-level="3">
        <label class="md-nav__title" for="__nav_13_1_2">
          <span class="md-nav__icon md-icon"></span>
          Config
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../config/astrobee_geom/" class="md-nav__link">
        Astrobee Geom
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../config/astrobee_motion/" class="md-nav__link">
        Astrobee Motion
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../config/astrobee_transforms/" class="md-nav__link">
        Astrobee Transforms
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../config/bag_properties/" class="md-nav__link">
        Bag Properties
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../config/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../config/iss_paths/" class="md-nav__link">
        Iss Paths
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../config/iss_safe_boxes/" class="md-nav__link">
        Iss Safe Boxes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13_1_3" type="checkbox" id="__nav_13_1_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_13_1_3">
          Control
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Control" data-md-level="3">
        <label class="md-nav__title" for="__nav_13_1_3">
          <span class="md-nav__icon md-icon"></span>
          Control
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../constraint_controller/" class="md-nav__link">
        Constraint Controller
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Force Torque Control
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Force Torque Control
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#plot_control" class="md-nav__link">
    plot_control
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#controllogger" class="md-nav__link">
    ControlLogger
  </a>
  
    <nav class="md-nav" aria-label="ControlLogger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#instance-variables" class="md-nav__link">
    Instance variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#log_control" class="md-nav__link">
    log_control
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plot" class="md-nav__link">
    plot
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forcetorquecontroller" class="md-nav__link">
    ForceTorqueController
  </a>
  
    <nav class="md-nav" aria-label="ForceTorqueController">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#attributes" class="md-nav__link">
    Attributes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_1" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#follow_traj" class="md-nav__link">
    follow_traj
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_current_state" class="md-nav__link">
    get_current_state
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_force" class="md-nav__link">
    get_force
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_torque" class="md-nav__link">
    get_torque
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step" class="md-nav__link">
    step
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stop" class="md-nav__link">
    stop
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../keyboard_controller/" class="md-nav__link">
        Keyboard Controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../metrics/" class="md-nav__link">
        Metrics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../multi_robot/" class="md-nav__link">
        Multi Robot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sampling_mpc/" class="md-nav__link">
        Sampling Mpc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sampling_mpc_multithreaded/" class="md-nav__link">
        Sampling Mpc Multithreaded
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13_1_4" type="checkbox" id="__nav_13_1_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_13_1_4">
          Core
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Core" data-md-level="3">
        <label class="md-nav__title" for="__nav_13_1_4">
          <span class="md-nav__icon md-icon"></span>
          Core
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/abstract_bag/" class="md-nav__link">
        Abstract Bag
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/astrobee/" class="md-nav__link">
        Astrobee
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/composite_bag/" class="md-nav__link">
        Composite Bag
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/constraint_bag/" class="md-nav__link">
        Constraint Bag
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/deformable_bag/" class="md-nav__link">
        Deformable Bag
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/environments/" class="md-nav__link">
        Environments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/hybrid_bag/" class="md-nav__link">
        Hybrid Bag
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/iss/" class="md-nav__link">
        Iss
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../core/rigid_bag/" class="md-nav__link">
        Rigid Bag
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13_1_5" type="checkbox" id="__nav_13_1_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_13_1_5">
          Trajectories
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Trajectories" data-md-level="3">
        <label class="md-nav__title" for="__nav_13_1_5">
          <span class="md-nav__icon md-icon"></span>
          Trajectories
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/arm_planner/" class="md-nav__link">
        Arm Planner
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/bezier/" class="md-nav__link">
        Bezier
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/bezier_slerp/" class="md-nav__link">
        Bezier Slerp
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/box_paths/" class="md-nav__link">
        Box Paths
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/curve_utils/" class="md-nav__link">
        Curve Utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/decasteljau_slerp/" class="md-nav__link">
        Decasteljau Slerp
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/face_forward/" class="md-nav__link">
        Face Forward
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/multi_robot_trajs/" class="md-nav__link">
        Multi Robot Trajs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/planner/" class="md-nav__link">
        Planner
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/polynomials/" class="md-nav__link">
        Polynomials
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/quaternion_interpolation/" class="md-nav__link">
        Quaternion Interpolation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/sampling/" class="md-nav__link">
        Sampling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/simple_trajectories/" class="md-nav__link">
        Simple Trajectories
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/splines/" class="md-nav__link">
        Splines
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/timing/" class="md-nav__link">
        Timing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/trajectory/" class="md-nav__link">
        Trajectory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../trajectories/variable_time_curves/" class="md-nav__link">
        Variable Time Curves
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13_1_6" type="checkbox" id="__nav_13_1_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_13_1_6">
          Utils
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Utils" data-md-level="3">
        <label class="md-nav__title" for="__nav_13_1_6">
          <span class="md-nav__icon md-icon"></span>
          Utils
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/algos/" class="md-nav__link">
        Algos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/bag_frame/" class="md-nav__link">
        Bag Frame
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/boxes/" class="md-nav__link">
        Boxes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/bullet_utils/" class="md-nav__link">
        Bullet Utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/debug_visualizer/" class="md-nav__link">
        Debug Visualizer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/dynamics/" class="md-nav__link">
        Dynamics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/errors/" class="md-nav__link">
        Errors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/math_utils/" class="md-nav__link">
        Math Utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/mesh_utils/" class="md-nav__link">
        Mesh Utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/poses/" class="md-nav__link">
        Poses
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/python_utils/" class="md-nav__link">
        Python Utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/quaternion_derivatives/" class="md-nav__link">
        Quaternion Derivatives
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/quaternions/" class="md-nav__link">
        Quaternions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/rotations/" class="md-nav__link">
        Rotations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/transformations/" class="md-nav__link">
        Transformations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/video_concatenation/" class="md-nav__link">
        Video Concatenation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#plot_control" class="md-nav__link">
    plot_control
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#controllogger" class="md-nav__link">
    ControlLogger
  </a>
  
    <nav class="md-nav" aria-label="ControlLogger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#instance-variables" class="md-nav__link">
    Instance variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#log_control" class="md-nav__link">
    log_control
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plot" class="md-nav__link">
    plot
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forcetorquecontroller" class="md-nav__link">
    ForceTorqueController
  </a>
  
    <nav class="md-nav" aria-label="ForceTorqueController">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#attributes" class="md-nav__link">
    Attributes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_1" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#follow_traj" class="md-nav__link">
    follow_traj
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_current_state" class="md-nav__link">
    get_current_state
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_force" class="md-nav__link">
    get_force
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get_torque" class="md-nav__link">
    get_torque
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step" class="md-nav__link">
    step
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stop" class="md-nav__link">
    stop
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/danielpmorton/pyastrobee/edit/main/reference/pyastrobee/control/force_torque_control.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="module-pyastrobeecontrolforce_torque_control">Module pyastrobee.control.force_torque_control</h1>
<p>Force + torque PID control of the Astrobee body</p>
<p>Note: Forces and torques are currently applied in world frame</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="sd">&quot;&quot;&quot;Force + torque PID control of the Astrobee body</span>

<span class="sd">Note: Forces and torques are currently applied in world frame</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># TODO: Add better handling of body-frame forces and torques (more aligned with how Astrobee&#39;s thrusters operate)</span>

<span class="c1"># TODO: Operational space control</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span><span class="w"> </span><span class="n">Optional</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">pybullet</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pybullet_utils.bullet_client</span><span class="w"> </span><span class="kn">import</span><span class="w"> </span><span class="n">BulletClient</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy.typing</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">npt</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.figure</span><span class="w"> </span><span class="kn">import</span><span class="w"> </span><span class="n">Figure</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pyastrobee.trajectories.trajectory</span><span class="w"> </span><span class="kn">import</span><span class="w"> </span><span class="p">(</span>

<span class="w">    </span><span class="n">Trajectory</span><span class="p">,</span>

<span class="w">    </span><span class="n">TrajectoryLogger</span><span class="p">,</span>

<span class="w">    </span><span class="n">stopping_criteria</span><span class="p">,</span>

<span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pyastrobee.utils.quaternions</span><span class="w"> </span><span class="kn">import</span><span class="w"> </span><span class="n">quaternion_angular_error</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pyastrobee.utils.rotations</span><span class="w"> </span><span class="kn">import</span><span class="w"> </span><span class="n">quat_to_rmat</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ForceTorqueController</span><span class="p">:</span>

<span class="w">    </span><span class="s2">&quot;&quot;&quot;PID-style force/torque control</span>

<span class="s2">    Args:</span>

<span class="s2">        robot_id (int): Pybullet ID of the robot to control</span>

<span class="s2">        mass (float): Mass of the robot</span>

<span class="s2">        inertia (np.ndarray): Inertia tensor for the robot, shape (3, 3)</span>

<span class="s2">        kp (float): Gain for position error</span>

<span class="s2">        kv (float): Gain for velocity error</span>

<span class="s2">        kq (float): Gain for orientation (quaternion) error</span>

<span class="s2">        kw (float): Gain for angular velocity (omega) error</span>

<span class="s2">        dt (float): Timestep</span>

<span class="s2">        pos_tol (float, optional): Stopping tolerance on position error magnitude. Defaults to 1e-2.</span>

<span class="s2">        orn_tol (float, optional): Stopping tolerance on quaternion distance between cur/des. Defaults to 1e-2.</span>

<span class="s2">        vel_tol (float, optional): Stopping tolerance on linear velocity error magnitude. Defaults to 1e-2.</span>

<span class="s2">        ang_vel_tol (float, optional): Stopping tolerance on angular velocity error magnitude. Defaults to 5e-3.</span>

<span class="s2">        max_force (Optional[float]): Limit on the applied force magnitude. Defaults to None (no limit)</span>

<span class="s2">        max_torque (Optional[float]): Limit on the applied torque magnitude. Defaults to None (no limit)</span>

<span class="s2">        client (BulletClient, optional): If connecting to multiple physics servers, include the client</span>

<span class="s2">            (the class instance, not just the ID) here. Defaults to None (use default connected client)</span>

<span class="s2">    &quot;&quot;&quot;</span>

<span class="w">    </span><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>

<span class="w">        </span><span class="bp">self</span><span class="p">,</span>

<span class="w">        </span><span class="n">robot_id</span><span class="p">:</span><span class="w"> </span><span class="nb">int</span><span class="p">,</span>

<span class="w">        </span><span class="n">mass</span><span class="p">:</span><span class="w"> </span><span class="nb">float</span><span class="p">,</span>

<span class="w">        </span><span class="n">inertia</span><span class="p">:</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>

<span class="w">        </span><span class="n">kp</span><span class="p">:</span><span class="w"> </span><span class="nb">float</span><span class="p">,</span>

<span class="w">        </span><span class="n">kv</span><span class="p">:</span><span class="w"> </span><span class="nb">float</span><span class="p">,</span>

<span class="w">        </span><span class="n">kq</span><span class="p">:</span><span class="w"> </span><span class="nb">float</span><span class="p">,</span>

<span class="w">        </span><span class="n">kw</span><span class="p">:</span><span class="w"> </span><span class="nb">float</span><span class="p">,</span>

<span class="w">        </span><span class="n">dt</span><span class="p">:</span><span class="w"> </span><span class="nb">float</span><span class="p">,</span>

<span class="w">        </span><span class="n">pos_tol</span><span class="p">:</span><span class="w"> </span><span class="nb">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e-2</span><span class="p">,</span>

<span class="w">        </span><span class="n">orn_tol</span><span class="p">:</span><span class="w"> </span><span class="nb">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e-2</span><span class="p">,</span>

<span class="w">        </span><span class="n">vel_tol</span><span class="p">:</span><span class="w"> </span><span class="nb">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e-2</span><span class="p">,</span>

<span class="w">        </span><span class="n">ang_vel_tol</span><span class="p">:</span><span class="w"> </span><span class="nb">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5e-3</span><span class="p">,</span>

<span class="w">        </span><span class="n">max_force</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">None</span><span class="p">,</span>

<span class="w">        </span><span class="n">max_torque</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">None</span><span class="p">,</span>

<span class="w">        </span><span class="n">client</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="p">[</span><span class="n">BulletClient</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">None</span><span class="p">,</span>

<span class="w">    </span><span class="p">):</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">robot_id</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">mass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mass</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">inertia</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inertia</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">kp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kp</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">kv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kv</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">kq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kq</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">kw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kw</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dt</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">pos_tol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pos_tol</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">orn_tol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orn_tol</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">vel_tol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vel_tol</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">ang_vel_tol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ang_vel_tol</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">max_force</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max_force</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">max_torque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max_torque</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">traj_log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TrajectoryLogger</span><span class="p">()</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">control_log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ControlLogger</span><span class="p">()</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">:</span><span class="w"> </span><span class="n">pybullet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pybullet</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="kc">None</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">client</span>

<span class="w">        </span><span class="c1"># Parameters for checking if there was a quaternion sign flip</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">last_quat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">getBasePositionAndOrientation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">quat_sign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>

<span class="w">    </span><span class="c1"># TODO figure out how world/robot frame should be handled</span>

<span class="w">    </span><span class="k">def</span><span class="w"> </span><span class="nf">get_force</span><span class="p">(</span>

<span class="w">        </span><span class="bp">self</span><span class="p">,</span>

<span class="w">        </span><span class="n">cur_pos</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="n">cur_vel</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="n">des_pos</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="n">des_vel</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="n">des_accel</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>

<span class="w">        </span><span class="s2">&quot;&quot;&quot;Calculates the required force to achieve a desired pos/vel/accel</span>

<span class="s2">        Args:</span>

<span class="s2">            cur_pos (npt.ArrayLike): Current position, shape (3,)</span>

<span class="s2">            cur_vel (npt.ArrayLike): Current velocity, shape (3,)</span>

<span class="s2">            des_pos (npt.ArrayLike): Desired position, shape (3,)</span>

<span class="s2">            des_vel (npt.ArrayLike): Desired velocity, shape (3,)</span>

<span class="s2">            des_accel (npt.ArrayLike): Desired acceleration, shape (3,)</span>

<span class="s2">        Returns:</span>

<span class="s2">            np.ndarray: Force, (Fx, Fy, Fz), shape (3,)</span>

<span class="s2">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">mass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="w">        </span><span class="n">pos_err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">cur_pos</span><span class="p">,</span><span class="w"> </span><span class="n">des_pos</span><span class="p">)</span>

<span class="w">        </span><span class="n">vel_err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">cur_vel</span><span class="p">,</span><span class="w"> </span><span class="n">des_vel</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">des_accel</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">kv</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vel_err</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">kp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pos_err</span>

<span class="w">    </span><span class="k">def</span><span class="w"> </span><span class="nf">get_torque</span><span class="p">(</span>

<span class="w">        </span><span class="bp">self</span><span class="p">,</span>

<span class="w">        </span><span class="n">cur_q</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="n">cur_w</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="n">des_q</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="n">des_w</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="n">des_a</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>

<span class="w">        </span><span class="s2">&quot;&quot;&quot;Calculates the required torque to achieve a desired orientation/ang vel/ang accel</span>

<span class="s2">        Args:</span>

<span class="s2">            cur_q (npt.ArrayLike): Current orientation (XYZW quaternion), shape (4,)</span>

<span class="s2">            cur_w (npt.ArrayLike): Current angular velocity (omega), shape (3,)</span>

<span class="s2">            des_q (npt.ArrayLike): Desired orientation (XYZW quaternion), shape (4,)</span>

<span class="s2">            des_w (npt.ArrayLike): Desired angular velocity (omega), shape (3,)</span>

<span class="s2">            des_a (npt.ArrayLike): Desired angular acceleration (alpha), shape (3,)</span>

<span class="s2">        Returns:</span>

<span class="s2">            np.ndarray: Torque, (Tx, Ty, Tz), shape (3,)</span>

<span class="s2">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">cur_q</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">last_quat</span><span class="p">,</span><span class="w"> </span><span class="n">atol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">):</span>

<span class="w">            </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Quaternion flip detected&quot;</span><span class="p">)</span>

<span class="w">            </span><span class="bp">self</span><span class="o">.</span><span class="n">quat_sign</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>

<span class="w">        </span><span class="n">ang_err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">quaternion_angular_error</span><span class="p">(</span><span class="n">cur_q</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">quat_sign</span><span class="p">,</span><span class="w"> </span><span class="n">des_q</span><span class="p">)</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">last_quat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cur_q</span>

<span class="w">        </span><span class="n">ang_vel_err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cur_w</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">des_w</span>

<span class="w">        </span><span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">quat_to_rmat</span><span class="p">(</span><span class="n">cur_q</span><span class="p">)</span>

<span class="w">        </span><span class="n">world_inertia</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">inertia</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">R</span><span class="o">.</span><span class="n">T</span>

<span class="w">        </span><span class="c1"># Standard 3D free-body torque equation based on desired ang. accel and current ang. vel</span>

<span class="w">        </span><span class="c1"># Note: this ignores the m * r x a term</span>

<span class="w">        </span><span class="n">torque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">world_inertia</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">des_a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">cur_w</span><span class="p">,</span><span class="w"> </span><span class="n">world_inertia</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">cur_w</span><span class="p">)</span>

<span class="w">        </span><span class="c1"># Add in the proportional and derivative terms</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">torque</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">kw</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ang_vel_err</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">kq</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ang_err</span>

<span class="w">    </span><span class="k">def</span><span class="w"> </span><span class="nf">follow_traj</span><span class="p">(</span>

<span class="w">        </span><span class="bp">self</span><span class="p">,</span>

<span class="w">        </span><span class="n">traj</span><span class="p">:</span><span class="w"> </span><span class="n">Trajectory</span><span class="p">,</span>

<span class="w">        </span><span class="n">stop_at_end</span><span class="p">:</span><span class="w"> </span><span class="nb">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">True</span><span class="p">,</span>

<span class="w">        </span><span class="n">max_stop_iters</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">None</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kc">None</span><span class="p">:</span>

<span class="w">        </span><span class="s2">&quot;&quot;&quot;Use PID force/torque control to follow a trajectory</span>

<span class="s2">        Args:</span>

<span class="s2">            traj (Trajectory): Trajectory with position, orientation, and derivative info across time</span>

<span class="s2">            stop_at_end (bool, optional): Whether or not to command the robot to come to a stop at the last</span>

<span class="s2">                pose in the trajectory. Defaults to True</span>

<span class="s2">            max_stop_iters (int, optional): If stop_at_end is True, this gives a maximum number of iterations to</span>

<span class="s2">                allow for stopping. Defaults to None (keep controlling until stopped)</span>

<span class="s2">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">range</span><span class="p">(</span><span class="n">traj</span><span class="o">.</span><span class="n">num_timesteps</span><span class="p">):</span>

<span class="w">            </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">orn</span><span class="p">,</span><span class="w"> </span><span class="n">lin_vel</span><span class="p">,</span><span class="w"> </span><span class="n">ang_vel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">get_current_state</span><span class="p">()</span>

<span class="w">            </span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">(</span>

<span class="w">                </span><span class="n">pos</span><span class="p">,</span>

<span class="w">                </span><span class="n">lin_vel</span><span class="p">,</span>

<span class="w">                </span><span class="n">orn</span><span class="p">,</span>

<span class="w">                </span><span class="n">ang_vel</span><span class="p">,</span>

<span class="w">                </span><span class="n">traj</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="p">:],</span>

<span class="w">                </span><span class="n">traj</span><span class="o">.</span><span class="n">linear_velocities</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="p">:],</span>

<span class="w">                </span><span class="n">traj</span><span class="o">.</span><span class="n">linear_accels</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="p">:],</span>

<span class="w">                </span><span class="n">traj</span><span class="o">.</span><span class="n">quaternions</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="p">:],</span>

<span class="w">                </span><span class="n">traj</span><span class="o">.</span><span class="n">angular_velocities</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="p">:],</span>

<span class="w">                </span><span class="n">traj</span><span class="o">.</span><span class="n">angular_accels</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="p">:],</span>

<span class="w">            </span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">stop_at_end</span><span class="p">:</span>

<span class="w">            </span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">traj</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">:],</span><span class="w"> </span><span class="n">traj</span><span class="o">.</span><span class="n">quaternions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">:],</span><span class="w"> </span><span class="n">max_stop_iters</span><span class="p">)</span>

<span class="w">    </span><span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span>

<span class="w">        </span><span class="bp">self</span><span class="p">,</span>

<span class="w">        </span><span class="n">des_pos</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="n">des_quat</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="n">max_iters</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">None</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kc">None</span><span class="p">:</span>

<span class="w">        </span><span class="s2">&quot;&quot;&quot;Controls the robot to stop at a desired position/orientation</span>

<span class="s2">        Args:</span>

<span class="s2">            des_pos (npt.ArrayLike): Desired position, shape (3,)</span>

<span class="s2">            des_quat (npt.ArrayLike): Desired orientation (XYZW quaternion), shape (4,)</span>

<span class="s2">            max_iters (int, optional): Maximum number of control iterations to allow for stopping.</span>

<span class="s2">                Defaults to None (keep controlling until stopped)</span>

<span class="s2">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">des_vel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="w">        </span><span class="n">des_accel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="w">        </span><span class="n">des_omega</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="w">        </span><span class="n">des_alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="w">        </span><span class="n">iters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="kc">True</span><span class="p">:</span>

<span class="w">            </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">orn</span><span class="p">,</span><span class="w"> </span><span class="n">lin_vel</span><span class="p">,</span><span class="w"> </span><span class="n">ang_vel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">get_current_state</span><span class="p">()</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">stopping_criteria</span><span class="p">(</span>

<span class="w">                </span><span class="n">pos</span><span class="p">,</span>

<span class="w">                </span><span class="n">orn</span><span class="p">,</span>

<span class="w">                </span><span class="n">lin_vel</span><span class="p">,</span>

<span class="w">                </span><span class="n">ang_vel</span><span class="p">,</span>

<span class="w">                </span><span class="n">des_pos</span><span class="p">,</span>

<span class="w">                </span><span class="n">des_quat</span><span class="p">,</span>

<span class="w">                </span><span class="bp">self</span><span class="o">.</span><span class="n">pos_tol</span><span class="p">,</span>

<span class="w">                </span><span class="bp">self</span><span class="o">.</span><span class="n">orn_tol</span><span class="p">,</span>

<span class="w">                </span><span class="bp">self</span><span class="o">.</span><span class="n">vel_tol</span><span class="p">,</span>

<span class="w">                </span><span class="bp">self</span><span class="o">.</span><span class="n">ang_vel_tol</span><span class="p">,</span>

<span class="w">            </span><span class="p">):</span>

<span class="w">                </span><span class="k">return</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">max_iters</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="kc">None</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">iters</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">max_iters</span><span class="p">:</span>

<span class="w">                </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Maximum iterations reached, stopping unsuccessful&quot;</span><span class="p">)</span>

<span class="w">                </span><span class="k">return</span>

<span class="w">            </span><span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">(</span>

<span class="w">                </span><span class="n">pos</span><span class="p">,</span>

<span class="w">                </span><span class="n">lin_vel</span><span class="p">,</span>

<span class="w">                </span><span class="n">orn</span><span class="p">,</span>

<span class="w">                </span><span class="n">ang_vel</span><span class="p">,</span>

<span class="w">                </span><span class="n">des_pos</span><span class="p">,</span>

<span class="w">                </span><span class="n">des_vel</span><span class="p">,</span>

<span class="w">                </span><span class="n">des_accel</span><span class="p">,</span>

<span class="w">                </span><span class="n">des_quat</span><span class="p">,</span>

<span class="w">                </span><span class="n">des_omega</span><span class="p">,</span>

<span class="w">                </span><span class="n">des_alpha</span><span class="p">,</span>

<span class="w">            </span><span class="p">)</span>

<span class="w">            </span><span class="n">iters</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span>

<span class="w">    </span><span class="k">def</span><span class="w"> </span><span class="nf">step</span><span class="p">(</span>

<span class="w">        </span><span class="bp">self</span><span class="p">,</span>

<span class="w">        </span><span class="n">pos</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="n">vel</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="n">orn</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="n">omega</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="n">des_pos</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="n">des_vel</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="n">des_accel</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="n">des_orn</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="n">des_omega</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="n">des_alpha</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="n">step_sim</span><span class="p">:</span><span class="w"> </span><span class="nb">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">True</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kc">None</span><span class="p">:</span>

<span class="w">        </span><span class="s2">&quot;&quot;&quot;Steps the controller and the simulation</span>

<span class="s2">        Args:</span>

<span class="s2">            pos (npt.ArrayLike): Current position, shape (3,)</span>

<span class="s2">            vel (npt.ArrayLike): Current linear velocity, shape (3,)</span>

<span class="s2">            orn (npt.ArrayLike): Current orientation (XYZW quaternion), shape (4,)</span>

<span class="s2">            omega (npt.ArrayLike): Current angular velocity, shape (3,)</span>

<span class="s2">            des_pos (npt.ArrayLike): Desired position, shape (3,)</span>

<span class="s2">            des_vel (npt.ArrayLike): Desired linear velocity, shape (3,)</span>

<span class="s2">            des_accel (npt.ArrayLike): Desired linear acceleration, shape (3,)</span>

<span class="s2">            des_orn (npt.ArrayLike): Desired orientation (XYZW quaternion), shape (4,)</span>

<span class="s2">            des_omega (npt.ArrayLike): Desired angular velocity, shape (3,)</span>

<span class="s2">            des_alpha (npt.ArrayLike): Desired angular acceleration, shape (3,)</span>

<span class="s2">            step_sim (bool, optional): Whether to step the sim or not (This should almost always be true except for if</span>

<span class="s2">                there are multiple active controllers in the simulation. In that case, the sim must be stepped manually</span>

<span class="s2">                with this flag as False on each controller). Defaults to True.</span>

<span class="s2">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">force</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">get_force</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">vel</span><span class="p">,</span><span class="w"> </span><span class="n">des_pos</span><span class="p">,</span><span class="w"> </span><span class="n">des_vel</span><span class="p">,</span><span class="w"> </span><span class="n">des_accel</span><span class="p">)</span>

<span class="w">        </span><span class="n">torque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">get_torque</span><span class="p">(</span><span class="n">orn</span><span class="p">,</span><span class="w"> </span><span class="n">omega</span><span class="p">,</span><span class="w"> </span><span class="n">des_orn</span><span class="p">,</span><span class="w"> </span><span class="n">des_omega</span><span class="p">,</span><span class="w"> </span><span class="n">des_alpha</span><span class="p">)</span>

<span class="w">        </span><span class="c1"># Clamp the maximum force/torque if needed</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">max_force</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="kc">None</span><span class="p">:</span>

<span class="w">            </span><span class="n">force_mag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">force</span><span class="p">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">force_mag</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">max_force</span><span class="p">:</span>

<span class="w">                </span><span class="n">force</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">max_force</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">force</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">force_mag</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">max_torque</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="kc">None</span><span class="p">:</span>

<span class="w">            </span><span class="n">torque_mag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">torque</span><span class="p">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">torque_mag</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">max_torque</span><span class="p">:</span>

<span class="w">                </span><span class="n">torque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">max_torque</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">torque</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">torque_mag</span><span class="p">)</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">control_log</span><span class="o">.</span><span class="n">log_control</span><span class="p">(</span><span class="n">force</span><span class="p">,</span><span class="w"> </span><span class="n">torque</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">applyExternalForce</span><span class="p">(</span>

<span class="w">            </span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">force</span><span class="p">,</span><span class="w"> </span><span class="nb">list</span><span class="p">(</span><span class="n">pos</span><span class="p">),</span><span class="w"> </span><span class="n">pybullet</span><span class="o">.</span><span class="n">WORLD_FRAME</span>

<span class="w">        </span><span class="p">)</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">applyExternalTorque</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nb">list</span><span class="p">(</span><span class="n">torque</span><span class="p">),</span><span class="w"> </span><span class="n">pybullet</span><span class="o">.</span><span class="n">WORLD_FRAME</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">step_sim</span><span class="p">:</span>

<span class="w">            </span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">stepSimulation</span><span class="p">()</span>

<span class="w">    </span><span class="k">def</span><span class="w"> </span><span class="nf">get_current_state</span><span class="p">(</span>

<span class="w">        </span><span class="bp">self</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>

<span class="w">        </span><span class="s2">&quot;&quot;&quot;Determines the current dynamics state of the robot</span>

<span class="s2">        Returns:</span>

<span class="s2">            tuple[np.ndarray, np.ndarray, np.ndarray, np.ndarray]:</span>

<span class="s2">                np.ndarray: Current position, shape (3,)</span>

<span class="s2">                np.ndarray: Current orientation (XYZW quaternion), shape (4,)</span>

<span class="s2">                np.ndarray: Current linear velocity, shape (3,)</span>

<span class="s2">                np.ndarray: Current angular velocity, shape (3,)</span>

<span class="s2">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">quat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">getBasePositionAndOrientation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

<span class="w">        </span><span class="n">lin_vel</span><span class="p">,</span><span class="w"> </span><span class="n">ang_vel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">getBaseVelocity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">traj_log</span><span class="o">.</span><span class="n">log_state</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">quat</span><span class="p">,</span><span class="w"> </span><span class="n">lin_vel</span><span class="p">,</span><span class="w"> </span><span class="n">ang_vel</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">)</span>

<span class="w">        </span><span class="c1"># These are originally tuples, so convert to numpy</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pos</span><span class="p">),</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">quat</span><span class="p">),</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lin_vel</span><span class="p">),</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ang_vel</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ControlLogger</span><span class="p">:</span>

<span class="w">    </span><span class="s2">&quot;&quot;&quot;Class for maintaining a history of control inputs for plottting or further analysis</span>

<span class="s2">    Any conversions between world frame / robot frame should be done before storing the force/torque</span>

<span class="s2">    data, depending on what is of interest</span>

<span class="s2">    &quot;&quot;&quot;</span>

<span class="w">    </span><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">_forces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">_torques</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">_times</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]</span>

<span class="w">    </span><span class="nd">@property</span>

<span class="w">    </span><span class="k">def</span><span class="w"> </span><span class="nf">forces</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_forces</span><span class="p">)</span>

<span class="w">    </span><span class="nd">@property</span>

<span class="w">    </span><span class="k">def</span><span class="w"> </span><span class="nf">torques</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_torques</span><span class="p">)</span>

<span class="w">    </span><span class="nd">@property</span>

<span class="w">    </span><span class="k">def</span><span class="w"> </span><span class="nf">times</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_times</span><span class="p">)</span>

<span class="w">    </span><span class="k">def</span><span class="w"> </span><span class="nf">log_control</span><span class="p">(</span>

<span class="w">        </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">force</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span><span class="w"> </span><span class="n">torque</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">,</span><span class="w"> </span><span class="n">dt</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">None</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kc">None</span><span class="p">:</span>

<span class="w">        </span><span class="s2">&quot;&quot;&quot;Logs the forces and torques applied in a simulation step</span>

<span class="s2">        Args:</span>

<span class="s2">            force (npt.ArrayLike): Applied force (Fx, Fy, Fz), shape (3,)</span>

<span class="s2">            torque (npt.ArrayLike): Applied torque (Tx, Ty, Tz), shape (3,)</span>

<span class="s2">            dt (Optional[float]): Time elapsed since the previous step. Defaults to None.</span>

<span class="s2">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">_forces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">force</span><span class="p">)</span>

<span class="w">        </span><span class="bp">self</span><span class="o">.</span><span class="n">_torques</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torque</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="kc">None</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_times</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>

<span class="w">            </span><span class="bp">self</span><span class="o">.</span><span class="n">_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

<span class="w">        </span><span class="k">elif</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="kc">None</span><span class="p">:</span>

<span class="w">            </span><span class="bp">self</span><span class="o">.</span><span class="n">_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dt</span><span class="p">)</span>

<span class="w">    </span><span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span>

<span class="w">        </span><span class="bp">self</span><span class="p">,</span>

<span class="w">        </span><span class="n">max_force</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">None</span><span class="p">,</span>

<span class="w">        </span><span class="n">max_torque</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">None</span><span class="p">,</span>

<span class="w">        </span><span class="n">show</span><span class="p">:</span><span class="w"> </span><span class="nb">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">True</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Figure</span><span class="p">:</span>

<span class="w">        </span><span class="s2">&quot;&quot;&quot;Plot the stored history of control inputs</span>

<span class="s2">        Args:</span>

<span class="s2">            max_force (Optional[npt.ArrayLike]): Applied force limits (Fx_max, Fy_max, Fz_max), shape (3,)</span>

<span class="s2">                Defaults to None (Don&#39;t indicate the limit on the plots)</span>

<span class="s2">            max_torque (Optional[npt.ArrayLike]): Applied torque limits (Tx_max, Ty_max, Tz_max), shape (3,)</span>

<span class="s2">                Defaults to None (Don&#39;t indicate the limit on the plots)</span>

<span class="s2">            show (bool, optional): Whether or not to show the plot. Defaults to True</span>

<span class="s2">        Returns:</span>

<span class="s2">            Figure: Matplotlib figure containing the plots</span>

<span class="s2">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">plot_control</span><span class="p">(</span>

<span class="w">            </span><span class="bp">self</span><span class="o">.</span><span class="n">forces</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">torques</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">times</span><span class="p">,</span><span class="w"> </span><span class="n">max_force</span><span class="p">,</span><span class="w"> </span><span class="n">max_torque</span><span class="p">,</span><span class="w"> </span><span class="n">show</span>

<span class="w">        </span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plot_control</span><span class="p">(</span>

<span class="w">    </span><span class="n">forces</span><span class="p">:</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>

<span class="w">    </span><span class="n">torques</span><span class="p">:</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>

<span class="w">    </span><span class="n">times</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">None</span><span class="p">,</span>

<span class="w">    </span><span class="n">max_force</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">None</span><span class="p">,</span>

<span class="w">    </span><span class="n">max_torque</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="p">[</span><span class="n">npt</span><span class="o">.</span><span class="n">ArrayLike</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">None</span><span class="p">,</span>

<span class="w">    </span><span class="n">show</span><span class="p">:</span><span class="w"> </span><span class="nb">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">True</span><span class="p">,</span>

<span class="w">    </span><span class="n">fmt</span><span class="p">:</span><span class="w"> </span><span class="nb">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;k-&quot;</span><span class="p">,</span>

<span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Figure</span><span class="p">:</span>

<span class="w">    </span><span class="s2">&quot;&quot;&quot;Plots a recorded history of force/torque control inputs</span>

<span class="s2">    Args:</span>

<span class="s2">        forces (np.ndarray): Sequence of force inputs (Fx, Fy, Fz), shape (n, 3)</span>

<span class="s2">        torques (np.ndarray): Sequence of torque inputs (Tx, Ty, Tz), shape (n, 3)</span>

<span class="s2">        times (Optional[np.ndarray], optional): Times corresponding to control inputs, shape (n,).</span>

<span class="s2">            Defaults to None, in which case control inputs will be plotted against timesteps</span>

<span class="s2">        max_force (Optional[npt.ArrayLike]): Applied force limits (Fx_max, Fy_max, Fz_max), shape (3,)</span>

<span class="s2">            Defaults to None (Don&#39;t indicate the limit on the plots)</span>

<span class="s2">        max_torque (Optional[npt.ArrayLike]): Applied torque limits (Tx_max, Ty_max, Tz_max), shape (3,)</span>

<span class="s2">            Defaults to None (Don&#39;t indicate the limit on the plots)</span>

<span class="s2">        show (bool, optional): Whether or not to display the plot. Defaults to True.</span>

<span class="s2">        fmt (str, optional): Matplotlib line specification. Defaults to &quot;k-&quot;</span>

<span class="s2">    Returns:</span>

<span class="s2">        Figure: Matplotlib figure containing the plots</span>

<span class="s2">    &quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">fig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">times</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="kc">None</span><span class="p">:</span>

<span class="w">        </span><span class="n">x_axis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">times</span>

<span class="w">        </span><span class="n">x_label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Time, s&quot;</span>

<span class="w">    </span><span class="k">else</span><span class="p">:</span>

<span class="w">        </span><span class="n">x_axis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">forces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="w">        </span><span class="n">x_label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Timesteps&quot;</span>

<span class="w">    </span><span class="n">subfigs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fig</span><span class="o">.</span><span class="n">subfigures</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>

<span class="w">    </span><span class="n">top_axes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subfigs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>

<span class="w">    </span><span class="n">bot_axes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subfigs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>

<span class="w">    </span><span class="n">force_labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Fx&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Fy&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Fz&quot;</span><span class="p">]</span>

<span class="w">    </span><span class="n">torque_labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Tx&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Ty&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Tz&quot;</span><span class="p">]</span>

<span class="w">    </span><span class="c1"># Plot force info on the top axes</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">ax</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">enumerate</span><span class="p">(</span><span class="n">top_axes</span><span class="p">):</span>

<span class="w">        </span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span><span class="w"> </span><span class="n">forces</span><span class="p">[:,</span><span class="w"> </span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">fmt</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">max_force</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="kc">None</span><span class="p">:</span>

<span class="w">            </span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span><span class="w"> </span><span class="n">max_force</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_axis</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;--&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">force_labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="w">        </span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>

<span class="w">    </span><span class="c1"># Plot torque info on the bottom axes</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">ax</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">enumerate</span><span class="p">(</span><span class="n">bot_axes</span><span class="p">):</span>

<span class="w">        </span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span><span class="w"> </span><span class="n">torques</span><span class="p">[:,</span><span class="w"> </span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">fmt</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">max_torque</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="kc">None</span><span class="p">:</span>

<span class="w">            </span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span><span class="w"> </span><span class="n">max_torque</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_axis</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;--&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">torque_labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="w">        </span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">show</span><span class="p">:</span>

<span class="w">        </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">fig</span>
</code></pre></div>

</details>
<h2 id="functions">Functions</h2>
<h3 id="plot_control">plot_control</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">plot_control</span><span class="p">(</span>
    <span class="n">forces</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">torques</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">times</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_force</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_torque</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">fmt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;k-&#39;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span>
</code></pre></div>

<p>Plots a recorded history of force/torque control inputs</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>forces</td>
<td>np.ndarray</td>
<td>Sequence of force inputs (Fx, Fy, Fz), shape (n, 3)</td>
<td>None</td>
</tr>
<tr>
<td>torques</td>
<td>np.ndarray</td>
<td>Sequence of torque inputs (Tx, Ty, Tz), shape (n, 3)</td>
<td>None</td>
</tr>
<tr>
<td>times</td>
<td>Optional[np.ndarray]</td>
<td>Times corresponding to control inputs, shape (n,).<br>Defaults to None, in which case control inputs will be plotted against timesteps</td>
<td>None</td>
</tr>
<tr>
<td>max_force</td>
<td>Optional[npt.ArrayLike]</td>
<td>Applied force limits (Fx_max, Fy_max, Fz_max), shape (3,)<br>Defaults to None (Don't indicate the limit on the plots)</td>
<td>None</td>
</tr>
<tr>
<td>max_torque</td>
<td>Optional[npt.ArrayLike]</td>
<td>Applied torque limits (Tx_max, Ty_max, Tz_max), shape (3,)<br>Defaults to None (Don't indicate the limit on the plots)</td>
<td>None</td>
</tr>
<tr>
<td>show</td>
<td>bool</td>
<td>Whether or not to display the plot. Defaults to True.</td>
<td>True</td>
</tr>
<tr>
<td>fmt</td>
<td>str</td>
<td>Matplotlib line specification. Defaults to "k-"</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Figure</td>
<td>Matplotlib figure containing the plots</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">plot_control</span><span class="p">(</span>

<span class="w">    </span><span class="nl">forces</span><span class="p">:</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">,</span>

<span class="w">    </span><span class="nl">torques</span><span class="p">:</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">,</span>

<span class="w">    </span><span class="nl">times</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">np.ndarray</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="nl">max_force</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">npt.ArrayLike</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="nl">max_torque</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">npt.ArrayLike</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="nl">show</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">True</span><span class="p">,</span>

<span class="w">    </span><span class="nl">fmt</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;k-&quot;</span><span class="p">,</span>

<span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">Figure</span><span class="p">:</span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;Plots a recorded history of force/torque control inputs</span>

<span class="ss">    Args:</span>

<span class="ss">        forces (np.ndarray): Sequence of force inputs (Fx, Fy, Fz), shape (n, 3)</span>

<span class="ss">        torques (np.ndarray): Sequence of torque inputs (Tx, Ty, Tz), shape (n, 3)</span>

<span class="ss">        times (Optional[np.ndarray], optional): Times corresponding to control inputs, shape (n,).</span>

<span class="ss">            Defaults to None, in which case control inputs will be plotted against timesteps</span>

<span class="ss">        max_force (Optional[npt.ArrayLike]): Applied force limits (Fx_max, Fy_max, Fz_max), shape (3,)</span>

<span class="ss">            Defaults to None (Don&#39;t indicate the limit on the plots)</span>

<span class="ss">        max_torque (Optional[npt.ArrayLike]): Applied torque limits (Tx_max, Ty_max, Tz_max), shape (3,)</span>

<span class="ss">            Defaults to None (Don&#39;t indicate the limit on the plots)</span>

<span class="ss">        show (bool, optional): Whether or not to display the plot. Defaults to True.</span>

<span class="ss">        fmt (str, optional): Matplotlib line specification. Defaults to &quot;</span><span class="n">k</span><span class="o">-</span><span class="ss">&quot;</span>

<span class="ss">    Returns:</span>

<span class="ss">        Figure: Matplotlib figure containing the plots</span>

<span class="ss">    &quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">fig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">()</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">times</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">        </span><span class="n">x_axis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">times</span>

<span class="w">        </span><span class="n">x_label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Time, s&quot;</span>

<span class="w">    </span><span class="k">else</span><span class="err">:</span>

<span class="w">        </span><span class="n">x_axis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="n">forces</span><span class="p">.</span><span class="n">shape</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">)</span>

<span class="w">        </span><span class="n">x_label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;Timesteps&quot;</span>

<span class="w">    </span><span class="n">subfigs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fig</span><span class="p">.</span><span class="n">subfigures</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>

<span class="w">    </span><span class="n">top_axes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subfigs</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>

<span class="w">    </span><span class="n">bot_axes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subfigs</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>

<span class="w">    </span><span class="n">force_labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">&quot;Fx&quot;, &quot;Fy&quot;, &quot;Fz&quot;</span><span class="o">]</span>

<span class="w">    </span><span class="n">torque_labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">&quot;Tx&quot;, &quot;Ty&quot;, &quot;Tz&quot;</span><span class="o">]</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">Plot</span><span class="w"> </span><span class="n">force</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">top</span><span class="w"> </span><span class="n">axes</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">ax</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">enumerate</span><span class="p">(</span><span class="n">top_axes</span><span class="p">)</span><span class="err">:</span>

<span class="w">        </span><span class="n">ax</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span><span class="w"> </span><span class="n">forces</span><span class="o">[</span><span class="n">:, i</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">fmt</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">max_force</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">            </span><span class="n">ax</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span><span class="w"> </span><span class="n">max_force</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_axis</span><span class="p">),</span><span class="w"> </span><span class="ss">&quot;--&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">ax</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">force_labels</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span>

<span class="w">        </span><span class="n">ax</span><span class="p">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">Plot</span><span class="w"> </span><span class="n">torque</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">bottom</span><span class="w"> </span><span class="n">axes</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">ax</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">enumerate</span><span class="p">(</span><span class="n">bot_axes</span><span class="p">)</span><span class="err">:</span>

<span class="w">        </span><span class="n">ax</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span><span class="w"> </span><span class="n">torques</span><span class="o">[</span><span class="n">:, i</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">fmt</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">max_torque</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">            </span><span class="n">ax</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span><span class="w"> </span><span class="n">max_torque</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x_axis</span><span class="p">),</span><span class="w"> </span><span class="ss">&quot;--&quot;</span><span class="p">)</span>

<span class="w">        </span><span class="n">ax</span><span class="p">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">torque_labels</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">)</span>

<span class="w">        </span><span class="n">ax</span><span class="p">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nl">show</span><span class="p">:</span>

<span class="w">        </span><span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">fig</span>
</code></pre></div>

</details>
<h2 id="classes">Classes</h2>
<h3 id="controllogger">ControlLogger</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">ControlLogger</span><span class="p">(</span>

<span class="p">)</span>
</code></pre></div>

<p>Class for maintaining a history of control inputs for plottting or further analysis</p>
<p>Any conversions between world frame / robot frame should be done before storing the force/torque
data, depending on what is of interest</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nl">ControlLogger</span><span class="p">:</span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;Class for maintaining a history of control inputs for plottting or further analysis</span>

<span class="ss">    Any conversions between world frame / robot frame should be done before storing the force/torque</span>

<span class="ss">    data, depending on what is of interest</span>

<span class="ss">    &quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="err">:</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">_forces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">[]</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">_torques</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">[]</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">_times</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">[]</span>

<span class="w">    </span><span class="nv">@property</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">forces</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="nl">ndarray</span><span class="p">:</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_forces</span><span class="p">)</span>

<span class="w">    </span><span class="nv">@property</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">torques</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="nl">ndarray</span><span class="p">:</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_torques</span><span class="p">)</span>

<span class="w">    </span><span class="nv">@property</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">times</span><span class="p">(</span><span class="n">self</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="nl">ndarray</span><span class="p">:</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="k">array</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_times</span><span class="p">)</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">log_control</span><span class="p">(</span>

<span class="w">        </span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">force</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span><span class="w"> </span><span class="nl">torque</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span><span class="w"> </span><span class="nl">dt</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">float</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Logs the forces and torques applied in a simulation step</span>

<span class="ss">        Args:</span>

<span class="ss">            force (npt.ArrayLike): Applied force (Fx, Fy, Fz), shape (3,)</span>

<span class="ss">            torque (npt.ArrayLike): Applied torque (Tx, Ty, Tz), shape (3,)</span>

<span class="ss">            dt (Optional[float]): Time elapsed since the previous step. Defaults to None.</span>

<span class="ss">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">_forces</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">force</span><span class="p">)</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">_torques</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">torque</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_times</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="err">:</span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">_times</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

<span class="w">        </span><span class="n">elif</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">_times</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_times</span><span class="o">[</span><span class="n">-1</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dt</span><span class="p">)</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">plot</span><span class="p">(</span>

<span class="w">        </span><span class="n">self</span><span class="p">,</span>

<span class="w">        </span><span class="nl">max_force</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">npt.ArrayLike</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="nl">max_torque</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">npt.ArrayLike</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="nl">show</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">True</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">Figure</span><span class="p">:</span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Plot the stored history of control inputs</span>

<span class="ss">        Args:</span>

<span class="ss">            max_force (Optional[npt.ArrayLike]): Applied force limits (Fx_max, Fy_max, Fz_max), shape (3,)</span>

<span class="ss">                Defaults to None (Don&#39;t indicate the limit on the plots)</span>

<span class="ss">            max_torque (Optional[npt.ArrayLike]): Applied torque limits (Tx_max, Ty_max, Tz_max), shape (3,)</span>

<span class="ss">                Defaults to None (Don&#39;t indicate the limit on the plots)</span>

<span class="ss">            show (bool, optional): Whether or not to show the plot. Defaults to True</span>

<span class="ss">        Returns:</span>

<span class="ss">            Figure: Matplotlib figure containing the plots</span>

<span class="ss">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">plot_control</span><span class="p">(</span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">forces</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">torques</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">times</span><span class="p">,</span><span class="w"> </span><span class="n">max_force</span><span class="p">,</span><span class="w"> </span><span class="n">max_torque</span><span class="p">,</span><span class="w"> </span><span class="n">show</span>

<span class="w">        </span><span class="p">)</span>
</code></pre></div>

</details>
<hr />
<h4 id="instance-variables">Instance variables</h4>
<div class="codehilite"><pre><span></span><code><span class="n">forces</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">times</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">torques</span>
</code></pre></div>

<h4 id="methods">Methods</h4>
<h4 id="log_control">log_control</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">log_control</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">force</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">torque</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">dt</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

<p>Logs the forces and torques applied in a simulation step</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>force</td>
<td>npt.ArrayLike</td>
<td>Applied force (Fx, Fy, Fz), shape (3,)</td>
<td>None</td>
</tr>
<tr>
<td>torque</td>
<td>npt.ArrayLike</td>
<td>Applied torque (Tx, Ty, Tz), shape (3,)</td>
<td>None</td>
</tr>
<tr>
<td>dt</td>
<td>Optional[float]</td>
<td>Time elapsed since the previous step. Defaults to None.</td>
<td>None</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">log_control</span><span class="p">(</span>

<span class="w">        </span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">force</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span><span class="w"> </span><span class="nl">torque</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span><span class="w"> </span><span class="nl">dt</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">float</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Logs the forces and torques applied in a simulation step</span>

<span class="ss">        Args:</span>

<span class="ss">            force (npt.ArrayLike): Applied force (Fx, Fy, Fz), shape (3,)</span>

<span class="ss">            torque (npt.ArrayLike): Applied torque (Tx, Ty, Tz), shape (3,)</span>

<span class="ss">            dt (Optional[float]): Time elapsed since the previous step. Defaults to None.</span>

<span class="ss">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">_forces</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">force</span><span class="p">)</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">_torques</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">torque</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_times</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="err">:</span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">_times</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

<span class="w">        </span><span class="n">elif</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">_times</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_times</span><span class="o">[</span><span class="n">-1</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dt</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="plot">plot</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">plot</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">max_force</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_torque</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span>
</code></pre></div>

<p>Plot the stored history of control inputs</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>max_force</td>
<td>Optional[npt.ArrayLike]</td>
<td>Applied force limits (Fx_max, Fy_max, Fz_max), shape (3,)<br>Defaults to None (Don't indicate the limit on the plots)</td>
<td>None</td>
</tr>
<tr>
<td>max_torque</td>
<td>Optional[npt.ArrayLike]</td>
<td>Applied torque limits (Tx_max, Ty_max, Tz_max), shape (3,)<br>Defaults to None (Don't indicate the limit on the plots)</td>
<td>None</td>
</tr>
<tr>
<td>show</td>
<td>bool</td>
<td>Whether or not to show the plot. Defaults to True</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Figure</td>
<td>Matplotlib figure containing the plots</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">plot</span><span class="p">(</span>

<span class="w">        </span><span class="kr">self</span><span class="p">,</span>

<span class="w">        </span><span class="n">max_force</span><span class="o">:</span><span class="w"> </span><span class="n">Optional</span><span class="p">[</span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">None</span><span class="p">,</span>

<span class="w">        </span><span class="n">max_torque</span><span class="o">:</span><span class="w"> </span><span class="n">Optional</span><span class="p">[</span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">None</span><span class="p">,</span>

<span class="w">        </span><span class="n">show</span><span class="o">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">True</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Figure</span><span class="o">:</span>

<span class="w">        </span><span class="s">&quot;&quot;&quot;Plot the stored history of control inputs</span>

<span class="s">        Args:</span>

<span class="s">            max_force (Optional[npt.ArrayLike]): Applied force limits (Fx_max, Fy_max, Fz_max), shape (3,)</span>

<span class="s">                Defaults to None (Don&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">indicate</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="kr">limit</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">plots</span><span class="p">)</span>

<span class="w">            </span><span class="n">max_torque</span><span class="w"> </span><span class="p">(</span><span class="n">Optional</span><span class="p">[</span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">])</span><span class="o">:</span><span class="w"> </span><span class="n">Applied</span><span class="w"> </span><span class="n">torque</span><span class="w"> </span><span class="n">limits</span><span class="w"> </span><span class="p">(</span><span class="n">Tx_max</span><span class="p">,</span><span class="w"> </span><span class="n">Ty_max</span><span class="p">,</span><span class="w"> </span><span class="n">Tz_max</span><span class="p">),</span><span class="w"> </span><span class="n">shape</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">,)</span>

<span class="w">                </span><span class="n">Defaults</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">None</span><span class="w"> </span><span class="p">(</span><span class="n">Don</span><span class="s">&#39;t indicate the limit on the plots)</span>

<span class="s">            show (bool, optional): Whether or not to show the plot. Defaults to True</span>

<span class="s">        Returns:</span>

<span class="s">            Figure: Matplotlib figure containing the plots</span>

<span class="s">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="n">plot_control</span><span class="p">(</span>

<span class="w">            </span><span class="kr">self</span><span class="p">.</span><span class="n">forces</span><span class="p">,</span><span class="w"> </span><span class="kr">self</span><span class="p">.</span><span class="n">torques</span><span class="p">,</span><span class="w"> </span><span class="kr">self</span><span class="p">.</span><span class="n">times</span><span class="p">,</span><span class="w"> </span><span class="n">max_force</span><span class="p">,</span><span class="w"> </span><span class="n">max_torque</span><span class="p">,</span><span class="w"> </span><span class="n">show</span>

<span class="w">        </span><span class="p">)</span>
</code></pre></div>

</details>
<h3 id="forcetorquecontroller">ForceTorqueController</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">ForceTorqueController</span><span class="p">(</span>
    <span class="n">robot_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">mass</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">inertia</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">kp</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">kv</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">kq</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">kw</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">dt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">pos_tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="n">orn_tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="n">vel_tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="n">ang_vel_tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.005</span><span class="p">,</span>
    <span class="n">max_force</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_torque</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pybullet_utils</span><span class="o">.</span><span class="n">bullet_client</span><span class="o">.</span><span class="n">BulletClient</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>

<p>PID-style force/torque control</p>
<h4 id="attributes">Attributes</h4>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>robot_id</td>
<td>int</td>
<td>Pybullet ID of the robot to control</td>
<td>None</td>
</tr>
<tr>
<td>mass</td>
<td>float</td>
<td>Mass of the robot</td>
<td>None</td>
</tr>
<tr>
<td>inertia</td>
<td>np.ndarray</td>
<td>Inertia tensor for the robot, shape (3, 3)</td>
<td>None</td>
</tr>
<tr>
<td>kp</td>
<td>float</td>
<td>Gain for position error</td>
<td>None</td>
</tr>
<tr>
<td>kv</td>
<td>float</td>
<td>Gain for velocity error</td>
<td>None</td>
</tr>
<tr>
<td>kq</td>
<td>float</td>
<td>Gain for orientation (quaternion) error</td>
<td>None</td>
</tr>
<tr>
<td>kw</td>
<td>float</td>
<td>Gain for angular velocity (omega) error</td>
<td>None</td>
</tr>
<tr>
<td>dt</td>
<td>float</td>
<td>Timestep</td>
<td>None</td>
</tr>
<tr>
<td>pos_tol</td>
<td>float</td>
<td>Stopping tolerance on position error magnitude. Defaults to 1e-2.</td>
<td>1e-2</td>
</tr>
<tr>
<td>orn_tol</td>
<td>float</td>
<td>Stopping tolerance on quaternion distance between cur/des. Defaults to 1e-2.</td>
<td>1e-2</td>
</tr>
<tr>
<td>vel_tol</td>
<td>float</td>
<td>Stopping tolerance on linear velocity error magnitude. Defaults to 1e-2.</td>
<td>1e-2</td>
</tr>
<tr>
<td>ang_vel_tol</td>
<td>float</td>
<td>Stopping tolerance on angular velocity error magnitude. Defaults to 5e-3.</td>
<td>5e-3</td>
</tr>
<tr>
<td>max_force</td>
<td>Optional[float]</td>
<td>Limit on the applied force magnitude. Defaults to None (no limit)</td>
<td>None</td>
</tr>
<tr>
<td>max_torque</td>
<td>Optional[float]</td>
<td>Limit on the applied torque magnitude. Defaults to None (no limit)</td>
<td>None</td>
</tr>
<tr>
<td>client</td>
<td>BulletClient</td>
<td>If connecting to multiple physics servers, include the client<br>(the class instance, not just the ID) here. Defaults to None (use default connected client)</td>
<td>None</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nl">ForceTorqueController</span><span class="p">:</span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;PID-style force/torque control</span>

<span class="ss">    Args:</span>

<span class="ss">        robot_id (int): Pybullet ID of the robot to control</span>

<span class="ss">        mass (float): Mass of the robot</span>

<span class="ss">        inertia (np.ndarray): Inertia tensor for the robot, shape (3, 3)</span>

<span class="ss">        kp (float): Gain for position error</span>

<span class="ss">        kv (float): Gain for velocity error</span>

<span class="ss">        kq (float): Gain for orientation (quaternion) error</span>

<span class="ss">        kw (float): Gain for angular velocity (omega) error</span>

<span class="ss">        dt (float): Timestep</span>

<span class="ss">        pos_tol (float, optional): Stopping tolerance on position error magnitude. Defaults to 1e-2.</span>

<span class="ss">        orn_tol (float, optional): Stopping tolerance on quaternion distance between cur/des. Defaults to 1e-2.</span>

<span class="ss">        vel_tol (float, optional): Stopping tolerance on linear velocity error magnitude. Defaults to 1e-2.</span>

<span class="ss">        ang_vel_tol (float, optional): Stopping tolerance on angular velocity error magnitude. Defaults to 5e-3.</span>

<span class="ss">        max_force (Optional[float]): Limit on the applied force magnitude. Defaults to None (no limit)</span>

<span class="ss">        max_torque (Optional[float]): Limit on the applied torque magnitude. Defaults to None (no limit)</span>

<span class="ss">        client (BulletClient, optional): If connecting to multiple physics servers, include the client</span>

<span class="ss">            (the class instance, not just the ID) here. Defaults to None (use default connected client)</span>

<span class="ss">    &quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">__init__</span><span class="p">(</span>

<span class="w">        </span><span class="n">self</span><span class="p">,</span>

<span class="w">        </span><span class="nl">robot_id</span><span class="p">:</span><span class="w"> </span><span class="nc">int</span><span class="p">,</span>

<span class="w">        </span><span class="nl">mass</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="p">,</span>

<span class="w">        </span><span class="nl">inertia</span><span class="p">:</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">,</span>

<span class="w">        </span><span class="nl">kp</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="p">,</span>

<span class="w">        </span><span class="nl">kv</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="p">,</span>

<span class="w">        </span><span class="nl">kq</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="p">,</span>

<span class="w">        </span><span class="nl">kw</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="p">,</span>

<span class="w">        </span><span class="nl">dt</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="p">,</span>

<span class="w">        </span><span class="nl">pos_tol</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e-2</span><span class="p">,</span>

<span class="w">        </span><span class="nl">orn_tol</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e-2</span><span class="p">,</span>

<span class="w">        </span><span class="nl">vel_tol</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e-2</span><span class="p">,</span>

<span class="w">        </span><span class="nl">ang_vel_tol</span><span class="p">:</span><span class="w"> </span><span class="nc">float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5e-3</span><span class="p">,</span>

<span class="w">        </span><span class="nl">max_force</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">float</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="nl">max_torque</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">float</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">        </span><span class="nl">client</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">BulletClient</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span><span class="err">:</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">robot_id</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">mass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mass</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">inertia</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inertia</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">kp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kp</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">kv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kv</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">kq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kq</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">kw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kw</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dt</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">pos_tol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pos_tol</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">orn_tol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orn_tol</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">vel_tol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vel_tol</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">ang_vel_tol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ang_vel_tol</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">max_force</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max_force</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">max_torque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max_torque</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">traj_log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TrajectoryLogger</span><span class="p">()</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">control_log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ControlLogger</span><span class="p">()</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="nl">client</span><span class="p">:</span><span class="w"> </span><span class="n">pybullet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pybullet</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">client</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">Parameters</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">checking</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">quaternion</span><span class="w"> </span><span class="nf">sign</span><span class="w"> </span><span class="n">flip</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">last_quat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="k">array</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="n">getBasePositionAndOrientation</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">id</span><span class="p">)</span><span class="o">[</span><span class="n">1</span><span class="o">]</span><span class="p">)</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">quat_sign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>

<span class="w">    </span><span class="err">#</span><span class="w"> </span><span class="n">TODO</span><span class="w"> </span><span class="n">figure</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">how</span><span class="w"> </span><span class="n">world</span><span class="o">/</span><span class="n">robot</span><span class="w"> </span><span class="n">frame</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">handled</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">get_force</span><span class="p">(</span>

<span class="w">        </span><span class="n">self</span><span class="p">,</span>

<span class="w">        </span><span class="nl">cur_pos</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="nl">cur_vel</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="nl">des_pos</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="nl">des_vel</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="nl">des_accel</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="nl">ndarray</span><span class="p">:</span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Calculates the required force to achieve a desired pos/vel/accel</span>

<span class="ss">        Args:</span>

<span class="ss">            cur_pos (npt.ArrayLike): Current position, shape (3,)</span>

<span class="ss">            cur_vel (npt.ArrayLike): Current velocity, shape (3,)</span>

<span class="ss">            des_pos (npt.ArrayLike): Desired position, shape (3,)</span>

<span class="ss">            des_vel (npt.ArrayLike): Desired velocity, shape (3,)</span>

<span class="ss">            des_accel (npt.ArrayLike): Desired acceleration, shape (3,)</span>

<span class="ss">        Returns:</span>

<span class="ss">            np.ndarray: Force, (Fx, Fy, Fz), shape (3,)</span>

<span class="ss">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">mass</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="w">        </span><span class="n">pos_err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">cur_pos</span><span class="p">,</span><span class="w"> </span><span class="n">des_pos</span><span class="p">)</span>

<span class="w">        </span><span class="n">vel_err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">cur_vel</span><span class="p">,</span><span class="w"> </span><span class="n">des_vel</span><span class="p">)</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">M</span><span class="w"> </span><span class="err">@</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">des_accel</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">kv</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vel_err</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">kp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pos_err</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">get_torque</span><span class="p">(</span>

<span class="w">        </span><span class="n">self</span><span class="p">,</span>

<span class="w">        </span><span class="nl">cur_q</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="nl">cur_w</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="nl">des_q</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="nl">des_w</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="nl">des_a</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="nl">ndarray</span><span class="p">:</span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Calculates the required torque to achieve a desired orientation/ang vel/ang accel</span>

<span class="ss">        Args:</span>

<span class="ss">            cur_q (npt.ArrayLike): Current orientation (XYZW quaternion), shape (4,)</span>

<span class="ss">            cur_w (npt.ArrayLike): Current angular velocity (omega), shape (3,)</span>

<span class="ss">            des_q (npt.ArrayLike): Desired orientation (XYZW quaternion), shape (4,)</span>

<span class="ss">            des_w (npt.ArrayLike): Desired angular velocity (omega), shape (3,)</span>

<span class="ss">            des_a (npt.ArrayLike): Desired angular acceleration (alpha), shape (3,)</span>

<span class="ss">        Returns:</span>

<span class="ss">            np.ndarray: Torque, (Tx, Ty, Tz), shape (3,)</span>

<span class="ss">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">cur_q</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">last_quat</span><span class="p">,</span><span class="w"> </span><span class="n">atol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span><span class="err">:</span>

<span class="w">            </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;Quaternion flip detected&quot;</span><span class="p">)</span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">quat_sign</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>

<span class="w">        </span><span class="n">ang_err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">quaternion_angular_error</span><span class="p">(</span><span class="n">cur_q</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">quat_sign</span><span class="p">,</span><span class="w"> </span><span class="n">des_q</span><span class="p">)</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">last_quat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cur_q</span>

<span class="w">        </span><span class="n">ang_vel_err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cur_w</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">des_w</span>

<span class="w">        </span><span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">quat_to_rmat</span><span class="p">(</span><span class="n">cur_q</span><span class="p">)</span>

<span class="w">        </span><span class="n">world_inertia</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="err">@</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">inertia</span><span class="w"> </span><span class="err">@</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="n">T</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Standard</span><span class="w"> </span><span class="mi">3</span><span class="n">D</span><span class="w"> </span><span class="k">free</span><span class="o">-</span><span class="n">body</span><span class="w"> </span><span class="n">torque</span><span class="w"> </span><span class="n">equation</span><span class="w"> </span><span class="n">based</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">desired</span><span class="w"> </span><span class="n">ang</span><span class="p">.</span><span class="w"> </span><span class="n">accel</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">current</span><span class="w"> </span><span class="n">ang</span><span class="p">.</span><span class="w"> </span><span class="n">vel</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="nl">Note</span><span class="p">:</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">ignores</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">term</span>

<span class="w">        </span><span class="n">torque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">world_inertia</span><span class="w"> </span><span class="err">@</span><span class="w"> </span><span class="n">des_a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="k">cross</span><span class="p">(</span><span class="n">cur_w</span><span class="p">,</span><span class="w"> </span><span class="n">world_inertia</span><span class="w"> </span><span class="err">@</span><span class="w"> </span><span class="n">cur_w</span><span class="p">)</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="k">Add</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">proportional</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">derivative</span><span class="w"> </span><span class="n">terms</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">torque</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">kw</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ang_vel_err</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">kq</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ang_err</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">follow_traj</span><span class="p">(</span>

<span class="w">        </span><span class="n">self</span><span class="p">,</span>

<span class="w">        </span><span class="nl">traj</span><span class="p">:</span><span class="w"> </span><span class="n">Trajectory</span><span class="p">,</span>

<span class="w">        </span><span class="nl">stop_at_end</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">True</span><span class="p">,</span>

<span class="w">        </span><span class="nl">max_stop_iters</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">int</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Use PID force/torque control to follow a trajectory</span>

<span class="ss">        Args:</span>

<span class="ss">            traj (Trajectory): Trajectory with position, orientation, and derivative info across time</span>

<span class="ss">            stop_at_end (bool, optional): Whether or not to command the robot to come to a stop at the last</span>

<span class="ss">                pose in the trajectory. Defaults to True</span>

<span class="ss">            max_stop_iters (int, optional): If stop_at_end is True, this gives a maximum number of iterations to</span>

<span class="ss">                allow for stopping. Defaults to None (keep controlling until stopped)</span>

<span class="ss">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">range</span><span class="p">(</span><span class="n">traj</span><span class="p">.</span><span class="n">num_timesteps</span><span class="p">)</span><span class="err">:</span>

<span class="w">            </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">orn</span><span class="p">,</span><span class="w"> </span><span class="n">lin_vel</span><span class="p">,</span><span class="w"> </span><span class="n">ang_vel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">get_current_state</span><span class="p">()</span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">step</span><span class="p">(</span>

<span class="w">                </span><span class="n">pos</span><span class="p">,</span>

<span class="w">                </span><span class="n">lin_vel</span><span class="p">,</span>

<span class="w">                </span><span class="n">orn</span><span class="p">,</span>

<span class="w">                </span><span class="n">ang_vel</span><span class="p">,</span>

<span class="w">                </span><span class="n">traj</span><span class="p">.</span><span class="n">positions</span><span class="o">[</span><span class="n">i, :</span><span class="o">]</span><span class="p">,</span>

<span class="w">                </span><span class="n">traj</span><span class="p">.</span><span class="n">linear_velocities</span><span class="o">[</span><span class="n">i, :</span><span class="o">]</span><span class="p">,</span>

<span class="w">                </span><span class="n">traj</span><span class="p">.</span><span class="n">linear_accels</span><span class="o">[</span><span class="n">i, :</span><span class="o">]</span><span class="p">,</span>

<span class="w">                </span><span class="n">traj</span><span class="p">.</span><span class="n">quaternions</span><span class="o">[</span><span class="n">i, :</span><span class="o">]</span><span class="p">,</span>

<span class="w">                </span><span class="n">traj</span><span class="p">.</span><span class="n">angular_velocities</span><span class="o">[</span><span class="n">i, :</span><span class="o">]</span><span class="p">,</span>

<span class="w">                </span><span class="n">traj</span><span class="p">.</span><span class="n">angular_accels</span><span class="o">[</span><span class="n">i, :</span><span class="o">]</span><span class="p">,</span>

<span class="w">            </span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nl">stop_at_end</span><span class="p">:</span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">stop</span><span class="p">(</span><span class="n">traj</span><span class="p">.</span><span class="n">positions</span><span class="o">[</span><span class="n">-1, :</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">traj</span><span class="p">.</span><span class="n">quaternions</span><span class="o">[</span><span class="n">-1, :</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">max_stop_iters</span><span class="p">)</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">stop</span><span class="p">(</span>

<span class="w">        </span><span class="n">self</span><span class="p">,</span>

<span class="w">        </span><span class="nl">des_pos</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="nl">des_quat</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="nl">max_iters</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">int</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Controls the robot to stop at a desired position/orientation</span>

<span class="ss">        Args:</span>

<span class="ss">            des_pos (npt.ArrayLike): Desired position, shape (3,)</span>

<span class="ss">            des_quat (npt.ArrayLike): Desired orientation (XYZW quaternion), shape (4,)</span>

<span class="ss">            max_iters (int, optional): Maximum number of control iterations to allow for stopping.</span>

<span class="ss">                Defaults to None (keep controlling until stopped)</span>

<span class="ss">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">des_vel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="w">        </span><span class="n">des_accel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="w">        </span><span class="n">des_omega</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="w">        </span><span class="n">des_alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="w">        </span><span class="n">iters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="k">True</span><span class="err">:</span>

<span class="w">            </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">orn</span><span class="p">,</span><span class="w"> </span><span class="n">lin_vel</span><span class="p">,</span><span class="w"> </span><span class="n">ang_vel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">get_current_state</span><span class="p">()</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">stopping_criteria</span><span class="p">(</span>

<span class="w">                </span><span class="n">pos</span><span class="p">,</span>

<span class="w">                </span><span class="n">orn</span><span class="p">,</span>

<span class="w">                </span><span class="n">lin_vel</span><span class="p">,</span>

<span class="w">                </span><span class="n">ang_vel</span><span class="p">,</span>

<span class="w">                </span><span class="n">des_pos</span><span class="p">,</span>

<span class="w">                </span><span class="n">des_quat</span><span class="p">,</span>

<span class="w">                </span><span class="n">self</span><span class="p">.</span><span class="n">pos_tol</span><span class="p">,</span>

<span class="w">                </span><span class="n">self</span><span class="p">.</span><span class="n">orn_tol</span><span class="p">,</span>

<span class="w">                </span><span class="n">self</span><span class="p">.</span><span class="n">vel_tol</span><span class="p">,</span>

<span class="w">                </span><span class="n">self</span><span class="p">.</span><span class="n">ang_vel_tol</span><span class="p">,</span>

<span class="w">            </span><span class="p">)</span><span class="err">:</span>

<span class="w">                </span><span class="k">return</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">max_iters</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">iters</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nl">max_iters</span><span class="p">:</span>

<span class="w">                </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;Maximum iterations reached, stopping unsuccessful&quot;</span><span class="p">)</span>

<span class="w">                </span><span class="k">return</span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">step</span><span class="p">(</span>

<span class="w">                </span><span class="n">pos</span><span class="p">,</span>

<span class="w">                </span><span class="n">lin_vel</span><span class="p">,</span>

<span class="w">                </span><span class="n">orn</span><span class="p">,</span>

<span class="w">                </span><span class="n">ang_vel</span><span class="p">,</span>

<span class="w">                </span><span class="n">des_pos</span><span class="p">,</span>

<span class="w">                </span><span class="n">des_vel</span><span class="p">,</span>

<span class="w">                </span><span class="n">des_accel</span><span class="p">,</span>

<span class="w">                </span><span class="n">des_quat</span><span class="p">,</span>

<span class="w">                </span><span class="n">des_omega</span><span class="p">,</span>

<span class="w">                </span><span class="n">des_alpha</span><span class="p">,</span>

<span class="w">            </span><span class="p">)</span>

<span class="w">            </span><span class="n">iters</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">step</span><span class="p">(</span>

<span class="w">        </span><span class="n">self</span><span class="p">,</span>

<span class="w">        </span><span class="nl">pos</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="nl">vel</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="nl">orn</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="nl">omega</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="nl">des_pos</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="nl">des_vel</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="nl">des_accel</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="nl">des_orn</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="nl">des_omega</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="nl">des_alpha</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="nl">step_sim</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">True</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Steps the controller and the simulation</span>

<span class="ss">        Args:</span>

<span class="ss">            pos (npt.ArrayLike): Current position, shape (3,)</span>

<span class="ss">            vel (npt.ArrayLike): Current linear velocity, shape (3,)</span>

<span class="ss">            orn (npt.ArrayLike): Current orientation (XYZW quaternion), shape (4,)</span>

<span class="ss">            omega (npt.ArrayLike): Current angular velocity, shape (3,)</span>

<span class="ss">            des_pos (npt.ArrayLike): Desired position, shape (3,)</span>

<span class="ss">            des_vel (npt.ArrayLike): Desired linear velocity, shape (3,)</span>

<span class="ss">            des_accel (npt.ArrayLike): Desired linear acceleration, shape (3,)</span>

<span class="ss">            des_orn (npt.ArrayLike): Desired orientation (XYZW quaternion), shape (4,)</span>

<span class="ss">            des_omega (npt.ArrayLike): Desired angular velocity, shape (3,)</span>

<span class="ss">            des_alpha (npt.ArrayLike): Desired angular acceleration, shape (3,)</span>

<span class="ss">            step_sim (bool, optional): Whether to step the sim or not (This should almost always be true except for if</span>

<span class="ss">                there are multiple active controllers in the simulation. In that case, the sim must be stepped manually</span>

<span class="ss">                with this flag as False on each controller). Defaults to True.</span>

<span class="ss">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">force</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">get_force</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">vel</span><span class="p">,</span><span class="w"> </span><span class="n">des_pos</span><span class="p">,</span><span class="w"> </span><span class="n">des_vel</span><span class="p">,</span><span class="w"> </span><span class="n">des_accel</span><span class="p">)</span>

<span class="w">        </span><span class="n">torque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">get_torque</span><span class="p">(</span><span class="n">orn</span><span class="p">,</span><span class="w"> </span><span class="n">omega</span><span class="p">,</span><span class="w"> </span><span class="n">des_orn</span><span class="p">,</span><span class="w"> </span><span class="n">des_omega</span><span class="p">,</span><span class="w"> </span><span class="n">des_alpha</span><span class="p">)</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Clamp</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">maximum</span><span class="w"> </span><span class="n">force</span><span class="o">/</span><span class="n">torque</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">needed</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">max_force</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">            </span><span class="n">force_mag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="n">norm</span><span class="p">(</span><span class="n">force</span><span class="p">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">force_mag</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="nl">max_force</span><span class="p">:</span>

<span class="w">                </span><span class="n">force</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">max_force</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">force</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">force_mag</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">max_torque</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">            </span><span class="n">torque_mag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="n">norm</span><span class="p">(</span><span class="n">torque</span><span class="p">)</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">torque_mag</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="nl">max_torque</span><span class="p">:</span>

<span class="w">                </span><span class="n">torque</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">max_torque</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">torque</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">torque_mag</span><span class="p">)</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">control_log</span><span class="p">.</span><span class="n">log_control</span><span class="p">(</span><span class="n">force</span><span class="p">,</span><span class="w"> </span><span class="n">torque</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">dt</span><span class="p">)</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="n">applyExternalForce</span><span class="p">(</span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">force</span><span class="p">,</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="n">pos</span><span class="p">),</span><span class="w"> </span><span class="n">pybullet</span><span class="p">.</span><span class="n">WORLD_FRAME</span>

<span class="w">        </span><span class="p">)</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="n">applyExternalTorque</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="n">torque</span><span class="p">),</span><span class="w"> </span><span class="n">pybullet</span><span class="p">.</span><span class="n">WORLD_FRAME</span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nl">step_sim</span><span class="p">:</span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="n">stepSimulation</span><span class="p">()</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">get_current_state</span><span class="p">(</span>

<span class="w">        </span><span class="n">self</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">tuple</span><span class="o">[</span><span class="n">np.ndarray, np.ndarray, np.ndarray, np.ndarray</span><span class="o">]</span><span class="err">:</span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Determines the current dynamics state of the robot</span>

<span class="ss">        Returns:</span>

<span class="ss">            tuple[np.ndarray, np.ndarray, np.ndarray, np.ndarray]:</span>

<span class="ss">                np.ndarray: Current position, shape (3,)</span>

<span class="ss">                np.ndarray: Current orientation (XYZW quaternion), shape (4,)</span>

<span class="ss">                np.ndarray: Current linear velocity, shape (3,)</span>

<span class="ss">                np.ndarray: Current angular velocity, shape (3,)</span>

<span class="ss">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">quat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="n">getBasePositionAndOrientation</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>

<span class="w">        </span><span class="n">lin_vel</span><span class="p">,</span><span class="w"> </span><span class="n">ang_vel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="n">getBaseVelocity</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">traj_log</span><span class="p">.</span><span class="n">log_state</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">quat</span><span class="p">,</span><span class="w"> </span><span class="n">lin_vel</span><span class="p">,</span><span class="w"> </span><span class="n">ang_vel</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">dt</span><span class="p">)</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">These</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">originally</span><span class="w"> </span><span class="n">tuples</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="nf">convert</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">numpy</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="k">array</span><span class="p">(</span><span class="n">pos</span><span class="p">),</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="k">array</span><span class="p">(</span><span class="n">quat</span><span class="p">),</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="k">array</span><span class="p">(</span><span class="n">lin_vel</span><span class="p">),</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="k">array</span><span class="p">(</span><span class="n">ang_vel</span><span class="p">)</span>
</code></pre></div>

</details>
<hr />
<h4 id="methods_1">Methods</h4>
<h4 id="follow_traj">follow_traj</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">follow_traj</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">traj</span><span class="p">:</span> <span class="n">pyastrobee</span><span class="o">.</span><span class="n">trajectories</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">Trajectory</span><span class="p">,</span>
    <span class="n">stop_at_end</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">max_stop_iters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

<p>Use PID force/torque control to follow a trajectory</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>traj</td>
<td>Trajectory</td>
<td>Trajectory with position, orientation, and derivative info across time</td>
<td>None</td>
</tr>
<tr>
<td>stop_at_end</td>
<td>bool</td>
<td>Whether or not to command the robot to come to a stop at the last<br>pose in the trajectory. Defaults to True</td>
<td>None</td>
</tr>
<tr>
<td>max_stop_iters</td>
<td>int</td>
<td>If stop_at_end is True, this gives a maximum number of iterations to<br>allow for stopping. Defaults to None (keep controlling until stopped)</td>
<td>None</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">follow_traj</span><span class="p">(</span>

<span class="w">        </span><span class="n">self</span><span class="p">,</span>

<span class="w">        </span><span class="nl">traj</span><span class="p">:</span><span class="w"> </span><span class="n">Trajectory</span><span class="p">,</span>

<span class="w">        </span><span class="nl">stop_at_end</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">True</span><span class="p">,</span>

<span class="w">        </span><span class="nl">max_stop_iters</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">int</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Use PID force/torque control to follow a trajectory</span>

<span class="ss">        Args:</span>

<span class="ss">            traj (Trajectory): Trajectory with position, orientation, and derivative info across time</span>

<span class="ss">            stop_at_end (bool, optional): Whether or not to command the robot to come to a stop at the last</span>

<span class="ss">                pose in the trajectory. Defaults to True</span>

<span class="ss">            max_stop_iters (int, optional): If stop_at_end is True, this gives a maximum number of iterations to</span>

<span class="ss">                allow for stopping. Defaults to None (keep controlling until stopped)</span>

<span class="ss">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">range</span><span class="p">(</span><span class="n">traj</span><span class="p">.</span><span class="n">num_timesteps</span><span class="p">)</span><span class="err">:</span>

<span class="w">            </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">orn</span><span class="p">,</span><span class="w"> </span><span class="n">lin_vel</span><span class="p">,</span><span class="w"> </span><span class="n">ang_vel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">get_current_state</span><span class="p">()</span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">step</span><span class="p">(</span>

<span class="w">                </span><span class="n">pos</span><span class="p">,</span>

<span class="w">                </span><span class="n">lin_vel</span><span class="p">,</span>

<span class="w">                </span><span class="n">orn</span><span class="p">,</span>

<span class="w">                </span><span class="n">ang_vel</span><span class="p">,</span>

<span class="w">                </span><span class="n">traj</span><span class="p">.</span><span class="n">positions</span><span class="o">[</span><span class="n">i, :</span><span class="o">]</span><span class="p">,</span>

<span class="w">                </span><span class="n">traj</span><span class="p">.</span><span class="n">linear_velocities</span><span class="o">[</span><span class="n">i, :</span><span class="o">]</span><span class="p">,</span>

<span class="w">                </span><span class="n">traj</span><span class="p">.</span><span class="n">linear_accels</span><span class="o">[</span><span class="n">i, :</span><span class="o">]</span><span class="p">,</span>

<span class="w">                </span><span class="n">traj</span><span class="p">.</span><span class="n">quaternions</span><span class="o">[</span><span class="n">i, :</span><span class="o">]</span><span class="p">,</span>

<span class="w">                </span><span class="n">traj</span><span class="p">.</span><span class="n">angular_velocities</span><span class="o">[</span><span class="n">i, :</span><span class="o">]</span><span class="p">,</span>

<span class="w">                </span><span class="n">traj</span><span class="p">.</span><span class="n">angular_accels</span><span class="o">[</span><span class="n">i, :</span><span class="o">]</span><span class="p">,</span>

<span class="w">            </span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nl">stop_at_end</span><span class="p">:</span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">stop</span><span class="p">(</span><span class="n">traj</span><span class="p">.</span><span class="n">positions</span><span class="o">[</span><span class="n">-1, :</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">traj</span><span class="p">.</span><span class="n">quaternions</span><span class="o">[</span><span class="n">-1, :</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">max_stop_iters</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="get_current_state">get_current_state</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">get_current_state</span><span class="p">(</span>
    <span class="bp">self</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
</code></pre></div>

<p>Determines the current dynamics state of the robot</p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>tuple[np.ndarray, np.ndarray, np.ndarray, np.ndarray]</td>
<td>np.ndarray: Current position, shape (3,)<br>np.ndarray: Current orientation (XYZW quaternion), shape (4,)<br>np.ndarray: Current linear velocity, shape (3,)<br>np.ndarray: Current angular velocity, shape (3,)</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">get_current_state</span><span class="p">(</span>

<span class="w">        </span><span class="kr">self</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">tuple</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">,</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">,</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">,</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">]</span><span class="o">:</span>

<span class="w">        </span><span class="s">&quot;&quot;&quot;Determines the current dynamics state of the robot</span>

<span class="s">        Returns:</span>

<span class="s">            tuple[np.ndarray, np.ndarray, np.ndarray, np.ndarray]:</span>

<span class="s">                np.ndarray: Current position, shape (3,)</span>

<span class="s">                np.ndarray: Current orientation (XYZW quaternion), shape (4,)</span>

<span class="s">                np.ndarray: Current linear velocity, shape (3,)</span>

<span class="s">                np.ndarray: Current angular velocity, shape (3,)</span>

<span class="s">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">quat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">self</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="n">getBasePositionAndOrientation</span><span class="p">(</span><span class="kr">self</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>

<span class="w">        </span><span class="n">lin_vel</span><span class="p">,</span><span class="w"> </span><span class="n">ang_vel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">self</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="n">getBaseVelocity</span><span class="p">(</span><span class="kr">self</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>

<span class="w">        </span><span class="kr">self</span><span class="p">.</span><span class="n">traj_log</span><span class="p">.</span><span class="n">log_state</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">quat</span><span class="p">,</span><span class="w"> </span><span class="n">lin_vel</span><span class="p">,</span><span class="w"> </span><span class="n">ang_vel</span><span class="p">,</span><span class="w"> </span><span class="kr">self</span><span class="p">.</span><span class="n">dt</span><span class="p">)</span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">These</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">originally</span><span class="w"> </span><span class="n">tuples</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">convert</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">numpy</span>

<span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">pos</span><span class="p">),</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">quat</span><span class="p">),</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">lin_vel</span><span class="p">),</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">ang_vel</span><span class="p">)</span>
</code></pre></div>

</details>
<h4 id="get_force">get_force</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">get_force</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">cur_pos</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">cur_vel</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">des_pos</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">des_vel</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">des_accel</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>
</code></pre></div>

<p>Calculates the required force to achieve a desired pos/vel/accel</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>cur_pos</td>
<td>npt.ArrayLike</td>
<td>Current position, shape (3,)</td>
<td>None</td>
</tr>
<tr>
<td>cur_vel</td>
<td>npt.ArrayLike</td>
<td>Current velocity, shape (3,)</td>
<td>None</td>
</tr>
<tr>
<td>des_pos</td>
<td>npt.ArrayLike</td>
<td>Desired position, shape (3,)</td>
<td>None</td>
</tr>
<tr>
<td>des_vel</td>
<td>npt.ArrayLike</td>
<td>Desired velocity, shape (3,)</td>
<td>None</td>
</tr>
<tr>
<td>des_accel</td>
<td>npt.ArrayLike</td>
<td>Desired acceleration, shape (3,)</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>np.ndarray</td>
<td>Force, (Fx, Fy, Fz), shape (3,)</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code>    def get_force(

        self,

        cur_pos: npt.ArrayLike,

        cur_vel: npt.ArrayLike,

        des_pos: npt.ArrayLike,

        des_vel: npt.ArrayLike,

        des_accel: npt.ArrayLike,

    ) -&gt; np.ndarray:

        &quot;&quot;&quot;Calculates the required force to achieve a desired pos/vel/accel

        Args:

            cur_pos (npt.ArrayLike): Current position, shape (3,)

            cur_vel (npt.ArrayLike): Current velocity, shape (3,)

            des_pos (npt.ArrayLike): Desired position, shape (3,)

            des_vel (npt.ArrayLike): Desired velocity, shape (3,)

            des_accel (npt.ArrayLike): Desired acceleration, shape (3,)

        Returns:

            np.ndarray: Force, (Fx, Fy, Fz), shape (3,)

        &quot;&quot;&quot;

        M = self.mass <span class="gs">* np.eye(3)</span>

<span class="gs">        pos_err = np.subtract(cur_pos, des_pos)</span>

<span class="gs">        vel_err = np.subtract(cur_vel, des_vel)</span>

<span class="gs">        return M @ np.asarray(des_accel) - self.kv *</span> vel_err - self.kp * pos_err
</code></pre></div>

</details>
<h4 id="get_torque">get_torque</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">get_torque</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">cur_q</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">cur_w</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">des_q</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">des_w</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">des_a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>
</code></pre></div>

<p>Calculates the required torque to achieve a desired orientation/ang vel/ang accel</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>cur_q</td>
<td>npt.ArrayLike</td>
<td>Current orientation (XYZW quaternion), shape (4,)</td>
<td>None</td>
</tr>
<tr>
<td>cur_w</td>
<td>npt.ArrayLike</td>
<td>Current angular velocity (omega), shape (3,)</td>
<td>None</td>
</tr>
<tr>
<td>des_q</td>
<td>npt.ArrayLike</td>
<td>Desired orientation (XYZW quaternion), shape (4,)</td>
<td>None</td>
</tr>
<tr>
<td>des_w</td>
<td>npt.ArrayLike</td>
<td>Desired angular velocity (omega), shape (3,)</td>
<td>None</td>
</tr>
<tr>
<td>des_a</td>
<td>npt.ArrayLike</td>
<td>Desired angular acceleration (alpha), shape (3,)</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>np.ndarray</td>
<td>Torque, (Tx, Ty, Tz), shape (3,)</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code>    def get_torque(

        self,

        cur_q: npt.ArrayLike,

        cur_w: npt.ArrayLike,

        des_q: npt.ArrayLike,

        des_w: npt.ArrayLike,

        des_a: npt.ArrayLike,

    ) -&gt; np.ndarray:

        &quot;&quot;&quot;Calculates the required torque to achieve a desired orientation/ang vel/ang accel

        Args:

            cur_q (npt.ArrayLike): Current orientation (XYZW quaternion), shape (4,)

            cur_w (npt.ArrayLike): Current angular velocity (omega), shape (3,)

            des_q (npt.ArrayLike): Desired orientation (XYZW quaternion), shape (4,)

            des_w (npt.ArrayLike): Desired angular velocity (omega), shape (3,)

            des_a (npt.ArrayLike): Desired angular acceleration (alpha), shape (3,)

        Returns:

            np.ndarray: Torque, (Tx, Ty, Tz), shape (3,)

        &quot;&quot;&quot;

        if np.allclose(cur_q, -1 <span class="gs">* self.last_quat, atol=1e-3):</span>

<span class="gs">            print(&quot;Quaternion flip detected&quot;)</span>

<span class="gs">            self.quat_sign *</span>= -1

        ang_err = quaternion_angular_error(cur_q <span class="gs">* self.quat_sign, des_q)</span>

<span class="gs">        self.last_quat = cur_q</span>

<span class="gs">        ang_vel_err = cur_w - des_w</span>

<span class="gs">        R = quat_to_rmat(cur_q)</span>

<span class="gs">        world_inertia = R @ self.inertia @ R.T</span>

<span class="gs">        # Standard 3D free-body torque equation based on desired ang. accel and current ang. vel</span>

<span class="gs">        # Note: this ignores the m *</span> r x a term

        torque = world_inertia @ des_a + np.cross(cur_w, world_inertia @ cur_w)

        # Add in the proportional and derivative terms

        return torque - self.kw <span class="gs">* ang_vel_err - self.kq *</span> ang_err
</code></pre></div>

</details>
<h4 id="step">step</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">step</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">pos</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">vel</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">orn</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">omega</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">des_pos</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">des_vel</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">des_accel</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">des_orn</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">des_omega</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">des_alpha</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">step_sim</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

<p>Steps the controller and the simulation</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>pos</td>
<td>npt.ArrayLike</td>
<td>Current position, shape (3,)</td>
<td>None</td>
</tr>
<tr>
<td>vel</td>
<td>npt.ArrayLike</td>
<td>Current linear velocity, shape (3,)</td>
<td>None</td>
</tr>
<tr>
<td>orn</td>
<td>npt.ArrayLike</td>
<td>Current orientation (XYZW quaternion), shape (4,)</td>
<td>None</td>
</tr>
<tr>
<td>omega</td>
<td>npt.ArrayLike</td>
<td>Current angular velocity, shape (3,)</td>
<td>None</td>
</tr>
<tr>
<td>des_pos</td>
<td>npt.ArrayLike</td>
<td>Desired position, shape (3,)</td>
<td>None</td>
</tr>
<tr>
<td>des_vel</td>
<td>npt.ArrayLike</td>
<td>Desired linear velocity, shape (3,)</td>
<td>None</td>
</tr>
<tr>
<td>des_accel</td>
<td>npt.ArrayLike</td>
<td>Desired linear acceleration, shape (3,)</td>
<td>None</td>
</tr>
<tr>
<td>des_orn</td>
<td>npt.ArrayLike</td>
<td>Desired orientation (XYZW quaternion), shape (4,)</td>
<td>None</td>
</tr>
<tr>
<td>des_omega</td>
<td>npt.ArrayLike</td>
<td>Desired angular velocity, shape (3,)</td>
<td>None</td>
</tr>
<tr>
<td>des_alpha</td>
<td>npt.ArrayLike</td>
<td>Desired angular acceleration, shape (3,)</td>
<td>None</td>
</tr>
<tr>
<td>step_sim</td>
<td>bool</td>
<td>Whether to step the sim or not (This should almost always be true except for if<br>there are multiple active controllers in the simulation. In that case, the sim must be stepped manually<br>with this flag as False on each controller). Defaults to True.</td>
<td>None</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code>    def step(

        self,

        pos: npt.ArrayLike,

        vel: npt.ArrayLike,

        orn: npt.ArrayLike,

        omega: npt.ArrayLike,

        des_pos: npt.ArrayLike,

        des_vel: npt.ArrayLike,

        des_accel: npt.ArrayLike,

        des_orn: npt.ArrayLike,

        des_omega: npt.ArrayLike,

        des_alpha: npt.ArrayLike,

        step_sim: bool = True,

    ) -&gt; None:

        &quot;&quot;&quot;Steps the controller and the simulation

        Args:

            pos (npt.ArrayLike): Current position, shape (3,)

            vel (npt.ArrayLike): Current linear velocity, shape (3,)

            orn (npt.ArrayLike): Current orientation (XYZW quaternion), shape (4,)

            omega (npt.ArrayLike): Current angular velocity, shape (3,)

            des_pos (npt.ArrayLike): Desired position, shape (3,)

            des_vel (npt.ArrayLike): Desired linear velocity, shape (3,)

            des_accel (npt.ArrayLike): Desired linear acceleration, shape (3,)

            des_orn (npt.ArrayLike): Desired orientation (XYZW quaternion), shape (4,)

            des_omega (npt.ArrayLike): Desired angular velocity, shape (3,)

            des_alpha (npt.ArrayLike): Desired angular acceleration, shape (3,)

            step_sim (bool, optional): Whether to step the sim or not (This should almost always be true except for if

                there are multiple active controllers in the simulation. In that case, the sim must be stepped manually

                with this flag as False on each controller). Defaults to True.

        &quot;&quot;&quot;

        force = self.get_force(pos, vel, des_pos, des_vel, des_accel)

        torque = self.get_torque(orn, omega, des_orn, des_omega, des_alpha)

        # Clamp the maximum force/torque if needed

        if self.max_force is not None:

            force_mag = np.linalg.norm(force)

            if force_mag &gt; self.max_force:

                force = self.max_force <span class="gs">* (force / force_mag)</span>

<span class="gs">        if self.max_torque is not None:</span>

<span class="gs">            torque_mag = np.linalg.norm(torque)</span>

<span class="gs">            if torque_mag &gt; self.max_torque:</span>

<span class="gs">                torque = self.max_torque *</span> (torque / torque_mag)

        self.control_log.log_control(force, torque, self.dt)

        self.client.applyExternalForce(

            self.id, -1, force, list(pos), pybullet.WORLD_FRAME

        )

        self.client.applyExternalTorque(self.id, -1, list(torque), pybullet.WORLD_FRAME)

        if step_sim:

            self.client.stepSimulation()
</code></pre></div>

</details>
<h4 id="stop">stop</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">stop</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">des_pos</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">des_quat</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_array_like</span><span class="o">.</span><span class="n">_SupportsArray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Any</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">_typing</span><span class="o">.</span><span class="n">_nested_sequence</span><span class="o">.</span><span class="n">_NestedSequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]],</span>
    <span class="n">max_iters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

<p>Controls the robot to stop at a desired position/orientation</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>des_pos</td>
<td>npt.ArrayLike</td>
<td>Desired position, shape (3,)</td>
<td>None</td>
</tr>
<tr>
<td>des_quat</td>
<td>npt.ArrayLike</td>
<td>Desired orientation (XYZW quaternion), shape (4,)</td>
<td>None</td>
</tr>
<tr>
<td>max_iters</td>
<td>int</td>
<td>Maximum number of control iterations to allow for stopping.<br>Defaults to None (keep controlling until stopped)</td>
<td>None</td>
</tr>
</tbody>
</table>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">stop</span><span class="p">(</span>

<span class="w">        </span><span class="n">self</span><span class="p">,</span>

<span class="w">        </span><span class="nl">des_pos</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="nl">des_quat</span><span class="p">:</span><span class="w"> </span><span class="n">npt</span><span class="p">.</span><span class="n">ArrayLike</span><span class="p">,</span>

<span class="w">        </span><span class="nl">max_iters</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">int</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span>

<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">None</span><span class="err">:</span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot;Controls the robot to stop at a desired position/orientation</span>

<span class="ss">        Args:</span>

<span class="ss">            des_pos (npt.ArrayLike): Desired position, shape (3,)</span>

<span class="ss">            des_quat (npt.ArrayLike): Desired orientation (XYZW quaternion), shape (4,)</span>

<span class="ss">            max_iters (int, optional): Maximum number of control iterations to allow for stopping.</span>

<span class="ss">                Defaults to None (keep controlling until stopped)</span>

<span class="ss">        &quot;&quot;&quot;</span>

<span class="w">        </span><span class="n">des_vel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="w">        </span><span class="n">des_accel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="w">        </span><span class="n">des_omega</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="w">        </span><span class="n">des_alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="w">        </span><span class="n">iters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="k">True</span><span class="err">:</span>

<span class="w">            </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="n">orn</span><span class="p">,</span><span class="w"> </span><span class="n">lin_vel</span><span class="p">,</span><span class="w"> </span><span class="n">ang_vel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">get_current_state</span><span class="p">()</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">stopping_criteria</span><span class="p">(</span>

<span class="w">                </span><span class="n">pos</span><span class="p">,</span>

<span class="w">                </span><span class="n">orn</span><span class="p">,</span>

<span class="w">                </span><span class="n">lin_vel</span><span class="p">,</span>

<span class="w">                </span><span class="n">ang_vel</span><span class="p">,</span>

<span class="w">                </span><span class="n">des_pos</span><span class="p">,</span>

<span class="w">                </span><span class="n">des_quat</span><span class="p">,</span>

<span class="w">                </span><span class="n">self</span><span class="p">.</span><span class="n">pos_tol</span><span class="p">,</span>

<span class="w">                </span><span class="n">self</span><span class="p">.</span><span class="n">orn_tol</span><span class="p">,</span>

<span class="w">                </span><span class="n">self</span><span class="p">.</span><span class="n">vel_tol</span><span class="p">,</span>

<span class="w">                </span><span class="n">self</span><span class="p">.</span><span class="n">ang_vel_tol</span><span class="p">,</span>

<span class="w">            </span><span class="p">)</span><span class="err">:</span>

<span class="w">                </span><span class="k">return</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">max_iters</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">iters</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nl">max_iters</span><span class="p">:</span>

<span class="w">                </span><span class="k">print</span><span class="p">(</span><span class="ss">&quot;Maximum iterations reached, stopping unsuccessful&quot;</span><span class="p">)</span>

<span class="w">                </span><span class="k">return</span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">step</span><span class="p">(</span>

<span class="w">                </span><span class="n">pos</span><span class="p">,</span>

<span class="w">                </span><span class="n">lin_vel</span><span class="p">,</span>

<span class="w">                </span><span class="n">orn</span><span class="p">,</span>

<span class="w">                </span><span class="n">ang_vel</span><span class="p">,</span>

<span class="w">                </span><span class="n">des_pos</span><span class="p">,</span>

<span class="w">                </span><span class="n">des_vel</span><span class="p">,</span>

<span class="w">                </span><span class="n">des_accel</span><span class="p">,</span>

<span class="w">                </span><span class="n">des_quat</span><span class="p">,</span>

<span class="w">                </span><span class="n">des_omega</span><span class="p">,</span>

<span class="w">                </span><span class="n">des_alpha</span><span class="p">,</span>

<span class="w">            </span><span class="p">)</span>

<span class="w">            </span><span class="n">iters</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span>
</code></pre></div>

</details>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        
<footer class="md-footer">
    
      <nav class="md-footer__inner md-grid" aria-label="Footer">
        
          
          <a href="../constraint_controller/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Constraint Controller" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Previous
                </span>
                Constraint Controller
              </div>
            </div>
          </a>
        
        
          
          <a href="../" class="md-footer__link md-footer__link--next" aria-label="Next: Index" rel="next">
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Next
                </span>
                Index
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
            
            Powered by
            <a href="http://timothycrosley.github.io/portray">portray.</a>
            You too can
            <a href="http://timothycrosley.github.io/portray">
              portray</a>
            your Python project well using automatic documentation.
          </div>
        
      </div>
    </div>
  </footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": [], "search": "../../../../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.078830c0.min.js"></script>
      
    
  </body>
</html>